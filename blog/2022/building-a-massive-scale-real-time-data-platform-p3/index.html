<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta name="google-site-verification" content="R3nPzqP9nO2aTgysGUiU3t-pw3wi1xuUuKVaMrimuck"> <meta name="msvalidate.01" content="04fec5e0d64b1c9bc788e98f81ee2a78"> <meta http-equiv="Permissions-Policy" content="interest-cohort=()"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Part 3 - Building a Massive-Scale Real-Time Data Platform - Memory Management with Apache Ignite | subhadip mitra </title> <meta name="author" content="Subhadip Mitra"> <meta name="description" content="Deep dive into memory management with Apache Ignite for high-performance data platforms. Learn how to handle 2.5M events/second with sub-millisecond latency through practical memory architecture, optimization techniques, and real-world implementation patterns."> <meta name="keywords" content="subhadip, subhadip mitra, subhadeep mitra, subhadip google, google, dikku, personal website, Data Analytics, Quantum Computing, Distributed Systems, Blockchain, Artificial Intelligence, Big Data, ETL Processes, Data Management, Open Source Projects, Technology Blogging, Software Engineering Insights, Data &amp; Analytics Trends, Personal Technology Musings, Approximate Calculations, Quantum Data Management, Real-Time Data Processing, Data Platform Innovations, Cloud Technologies, Machine Learning Models, Technology Consulting"> <meta property="og:site_name" content="subhadip mitra"> <meta property="og:type" content="article"> <meta property="og:title" content="subhadip mitra | Part 3 - Building a Massive-Scale Real-Time Data Platform - Memory Management with Apache Ignite"> <meta property="og:url" content="https://subhadipmitra.com/blog/2022/building-a-massive-scale-real-time-data-platform-p3/"> <meta property="og:description" content="Deep dive into memory management with Apache Ignite for high-performance data platforms. Learn how to handle 2.5M events/second with sub-millisecond latency through practical memory architecture, optimization techniques, and real-world implementation patterns."> <meta property="og:image" content="/assets/img/social_preview.png"> <meta property="og:locale" content="en"> <meta name="twitter:card" content="summary"> <meta name="twitter:title" content="Part 3 - Building a Massive-Scale Real-Time Data Platform - Memory Management with Apache Ignite"> <meta name="twitter:description" content="Deep dive into memory management with Apache Ignite for high-performance data platforms. Learn how to handle 2.5M events/second with sub-millisecond latency through practical memory architecture, optimization techniques, and real-world implementation patterns."> <meta name="twitter:image" content="/assets/img/social_preview.png"> <meta name="twitter:site" content="@bassrehab"> <meta name="twitter:creator" content="@bassrehab"> <script type="application/ld+json">
    {
        "author":
        {
            "@type": "Person",
            "name": "Subhadip Mitra"
        },
        "url": "https://subhadipmitra.com/blog/2022/building-a-massive-scale-real-time-data-platform-p3/",
        "@type": "BlogPosting",
        "description": "Deep dive into memory management with Apache Ignite for high-performance data platforms. Learn how to handle 2.5M events/second with sub-millisecond latency through practical memory architecture, optimization techniques, and real-world implementation patterns.",
        "headline": "Part 3 - Building a Massive-Scale Real-Time Data Platform - Memory Management with Apache Ignite",
        
        "sameAs": ["https://orcid.org/0000-0002-3977-7402", "https://www.researchgate.net/profile/Subhadip-Mitra-3", "https://github.com/bassrehab", "https://www.linkedin.com/in/subhadip-mitra", "https://twitter.com/bassrehab"],
        
        "name": "Subhadip Mitra",
        "@context": "https://schema.org"
    }
  </script> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <script type="text/javascript">!function(t,e,n,a,c,s,r){t[n]=t[n]||function(){(t[n].q=t[n].q||[]).push(arguments)},(s=e.createElement(a)).async=1,s.src="https://www.clarity.ms/tag/"+c,(r=e.getElementsByTagName(a)[0]).parentNode.insertBefore(s,r)}(window,document,"clarity","script","pas45gbkvm");</script> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link defer href="/assets/css/bootstrap-toc.min.css?6f5af0bb9aab25d79b2448143cbeaa88" rel="stylesheet"> <link rel="shortcut icon" href="/assets/img/favicon.png?058310854f7b3c920f894a1d42c3c47b"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://subhadipmitra.com/blog/2022/building-a-massive-scale-real-time-data-platform-p3/"> <script src="/assets/js/theme.js?a5ca4084d3b81624bcfa01156dae2b8e"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>initTheme();</script> </head> <body class="fixed-top-nav sticky-bottom-footer"> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> subhadip mitra </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv </a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">more </a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item " href="/search/">search</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/contact/">contact</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/license/">licenses</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/privacy/">privacy</a> </div> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="row"> <div class="col-sm-3"> <nav id="toc-sidebar" class="sticky-top"></nav> </div> <div class="col-sm-9"> <div class="post"> <header class="post-header"> <h1 class="post-title">Part 3 - Building a Massive-Scale Real-Time Data Platform - Memory Management with Apache Ignite</h1> <p class="post-meta"> November 27, 2022 </p> <p class="post-tags"> <a href="/blog/2022"> <i class="fa-solid fa-calendar fa-sm"></i> 2022 </a>   ·   <a href="/blog/tag/system-design"> <i class="fa-solid fa-hashtag fa-sm"></i> system-design</a>   <a href="/blog/tag/architecture"> <i class="fa-solid fa-hashtag fa-sm"></i> architecture</a>   <a href="/blog/tag/casestudy"> <i class="fa-solid fa-hashtag fa-sm"></i> casestudy</a>     ·   <a href="/blog/category/architecture"> <i class="fa-solid fa-tag fa-sm"></i> architecture</a>   <a href="/blog/category/system-design"> <i class="fa-solid fa-tag fa-sm"></i> system-design</a>   <a href="/blog/category/casetudy"> <i class="fa-solid fa-tag fa-sm"></i> casetudy</a>   </p> </header> <article class="post-content"> <div id="markdown-content"> <p>In Parts 1 and 2, we explored our system architecture and data partitioning strategies. Today, we’ll dive deep into how we managed memory using Apache Ignite to handle 2.5 million events per second while maintaining sub-millisecond response times.</p> <h2 id="memory-management-challenges">Memory Management Challenges</h2> <h3 id="scale-requirements">Scale Requirements</h3> <ol> <li> <strong>Event Processing</strong> <ul> <li>2.5M events/second ingestion</li> <li>Sub-millisecond query latency</li> <li>Real-time aggregations</li> <li>State maintenance</li> </ul> </li> <li> <strong>DPI Data</strong> <ul> <li>350GB/15min processing</li> <li>Complex analysis</li> <li>Pattern detection</li> <li>Historical queries</li> </ul> </li> <li> <strong>Active Dataset</strong> <ul> <li>Multiple event types</li> <li>Rich subscriber data</li> <li>Location information</li> <li>Real-time metrics</li> </ul> </li> </ol> <h2 id="memory-architecture">Memory Architecture</h2> <p><br></p> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/blog/ignite-memory-architecture-480.webp 480w,/assets/img/blog/ignite-memory-architecture-800.webp 800w,/assets/img/blog/ignite-memory-architecture-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/blog/ignite-memory-architecture.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <p><br></p> <h3 id="memory-regions">Memory Regions</h3> <ol> <li> <strong>On-Heap Memory (20%)</strong> <ul> <li>Size: ~100GB per node</li> <li>Usage: Critical metadata</li> <li>Contents: Indexes and query execution</li> <li>GC tuning: ZGC optimized</li> </ul> </li> <li> <strong>Off-Heap Memory (80%)</strong> <ul> <li>Size: ~400GB per node</li> <li>Usage: Event data storage</li> <li>Direct memory allocation</li> <li>Zero-copy operations</li> </ul> </li> </ol> <h3 id="memory-organization">Memory Organization</h3> <ol> <li> <strong>Page Memory</strong> <ul> <li>Page size: 2KB to 2MB</li> <li>Pre-allocated pools</li> <li>NUMA-aware allocation</li> <li>Defragmentation support</li> </ul> </li> <li> <strong>Data Regions</strong> <ul> <li>Hot data region (4 hours)</li> <li>Warm data region (24 hours)</li> <li>Index region (permanent)</li> <li>System region (permanent)</li> </ul> </li> </ol> <h2 id="implementation-strategy">Implementation Strategy</h2> <p><br></p> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/blog/memory-management-flow-480.webp 480w,/assets/img/blog/memory-management-flow-800.webp 800w,/assets/img/blog/memory-management-flow-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/blog/memory-management-flow.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <p><br></p> <h3 id="memory-configuration">Memory Configuration</h3> <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">"org.apache.ignite.configuration.IgniteConfiguration"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"dataStorageConfiguration"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">"org.apache.ignite.configuration.DataStorageConfiguration"</span><span class="nt">&gt;</span>
            <span class="c">&lt;!-- System region configuration --&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"systemRegionInitialSize"</span> 
                      <span class="na">value=</span><span class="s">"#{10L * 1024 * 1024 * 1024}"</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- 10GB --&gt;</span>
            
            <span class="c">&lt;!-- Default region configuration --&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"defaultDataRegionConfiguration"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">"org.apache.ignite.configuration.DataRegionConfiguration"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"name"</span> <span class="na">value=</span><span class="s">"Default_Region"</span><span class="nt">/&gt;</span>
                    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"initialSize"</span> 
                              <span class="na">value=</span><span class="s">"#{20L * 1024 * 1024 * 1024}"</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- 20GB --&gt;</span>
                    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"maxSize"</span> 
                              <span class="na">value=</span><span class="s">"#{50L * 1024 * 1024 * 1024}"</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- 50GB --&gt;</span>
                    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"pageEvictionMode"</span> 
                              <span class="na">value=</span><span class="s">"RANDOM_2_LRU"</span><span class="nt">/&gt;</span>
                    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"metricsEnabled"</span> <span class="na">value=</span><span class="s">"true"</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;/bean&gt;</span>
            <span class="nt">&lt;/property&gt;</span>

            <span class="c">&lt;!-- Custom regions configuration --&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"dataRegionConfigurations"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;list&gt;</span>
                    <span class="c">&lt;!-- Hot data region --&gt;</span>
                    <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">"org.apache.ignite.configuration.DataRegionConfiguration"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"name"</span> <span class="na">value=</span><span class="s">"Hot_Region"</span><span class="nt">/&gt;</span>
                        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"initialSize"</span> 
                                  <span class="na">value=</span><span class="s">"#{200L * 1024 * 1024 * 1024}"</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- 200GB --&gt;</span>
                        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"maxSize"</span> 
                                  <span class="na">value=</span><span class="s">"#{400L * 1024 * 1024 * 1024}"</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- 400GB --&gt;</span>
                        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"pageEvictionMode"</span> 
                                  <span class="na">value=</span><span class="s">"RANDOM_2_LRU"</span><span class="nt">/&gt;</span>
                        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"evictionThreshold"</span> <span class="na">value=</span><span class="s">"0.95"</span><span class="nt">/&gt;</span>
                        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"metricsEnabled"</span> <span class="na">value=</span><span class="s">"true"</span><span class="nt">/&gt;</span>
                    <span class="nt">&lt;/bean&gt;</span>
                    
                    <span class="c">&lt;!-- Index region --&gt;</span>
                    <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">"org.apache.ignite.configuration.DataRegionConfiguration"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"name"</span> <span class="na">value=</span><span class="s">"Index_Region"</span><span class="nt">/&gt;</span>
                        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"initialSize"</span> 
                                  <span class="na">value=</span><span class="s">"#{50L * 1024 * 1024 * 1024}"</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- 50GB --&gt;</span>
                        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"maxSize"</span> 
                                  <span class="na">value=</span><span class="s">"#{100L * 1024 * 1024 * 1024}"</span> <span class="nt">/&gt;</span> <span class="c">&lt;!-- 100GB --&gt;</span>
                        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"persistenceEnabled"</span> <span class="na">value=</span><span class="s">"true"</span><span class="nt">/&gt;</span>
                    <span class="nt">&lt;/bean&gt;</span>
                <span class="nt">&lt;/list&gt;</span>
            <span class="nt">&lt;/property&gt;</span>
        <span class="nt">&lt;/bean&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</code></pre></div></div> <h3 id="memory-manager-implementation">Memory Manager Implementation</h3> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomMemoryManager</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">IgniteCache</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">BinaryObject</span><span class="o">&gt;</span> <span class="n">cache</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">EvictionPolicy</span> <span class="n">evictionPolicy</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">MetricsRegistry</span> <span class="n">metricsRegistry</span><span class="o">;</span>
    
    <span class="c1">// Memory pressure handling</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handleMemoryPressure</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">DataRegionMetrics</span> <span class="n">metrics</span> <span class="o">=</span> <span class="n">getRegionMetrics</span><span class="o">(</span><span class="s">"Hot_Region"</span><span class="o">);</span>
        <span class="kt">double</span> <span class="n">usagePercentage</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="na">getPagesFillFactor</span><span class="o">();</span>
        
        <span class="k">if</span> <span class="o">(</span><span class="n">usagePercentage</span> <span class="o">&gt;</span> <span class="mf">0.9</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// 90% threshold</span>
            <span class="n">triggerEviction</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
    
    <span class="c1">// Custom eviction logic</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">triggerEviction</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// Get events older than 4 hours</span>
        <span class="kt">long</span> <span class="n">cutoffTime</span> <span class="o">=</span> <span class="nc">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()</span> <span class="o">-</span> 
            <span class="nc">TimeUnit</span><span class="o">.</span><span class="na">HOURS</span><span class="o">.</span><span class="na">toMillis</span><span class="o">(</span><span class="mi">4</span><span class="o">);</span>
            
        <span class="nc">SqlQuery</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">BinaryObject</span><span class="o">&gt;</span> <span class="n">query</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SqlQuery</span><span class="o">&lt;&gt;(</span>
            <span class="nc">Event</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="s">"timestamp &lt; ? ORDER BY timestamp ASC LIMIT 10000"</span><span class="o">);</span>
            
        <span class="k">try</span> <span class="o">(</span><span class="nc">QueryCursor</span><span class="o">&lt;</span><span class="nc">Cache</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">BinaryObject</span><span class="o">&gt;&gt;</span> <span class="n">cursor</span> <span class="o">=</span> 
                <span class="n">cache</span><span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="n">query</span><span class="o">.</span><span class="na">setArgs</span><span class="o">(</span><span class="n">cutoffTime</span><span class="o">)))</span> <span class="o">{</span>
            
            <span class="k">for</span> <span class="o">(</span><span class="nc">Cache</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">BinaryObject</span><span class="o">&gt;</span> <span class="n">entry</span> <span class="o">:</span> <span class="n">cursor</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">// Move to warm storage</span>
                <span class="n">moveToWarmStorage</span><span class="o">(</span><span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">(),</span> <span class="n">entry</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>
                <span class="c1">// Remove from hot storage</span>
                <span class="n">cache</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">());</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
    
    <span class="c1">// Warm storage management</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">moveToWarmStorage</span><span class="o">(</span><span class="nc">String</span> <span class="n">key</span><span class="o">,</span> <span class="nc">BinaryObject</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// Compress if needed</span>
        <span class="kt">byte</span><span class="o">[]</span> <span class="n">compressed</span> <span class="o">=</span> <span class="n">compress</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
        <span class="c1">// Store in Cassandra</span>
        <span class="n">cassandraTemplate</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span>
            <span class="s">"INSERT INTO warm_storage (key, data) VALUES (?, ?)"</span><span class="o">,</span>
            <span class="n">key</span><span class="o">,</span> <span class="n">compressed</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <h2 id="memory-optimization-techniques">Memory Optimization Techniques</h2> <h3 id="1-data-layout-optimization">1. Data Layout Optimization</h3> <ul> <li>Field ordering for better packing</li> <li>Padding elimination</li> <li>Object pooling</li> <li>Array pre-allocation</li> </ul> <h3 id="2-access-pattern-optimization">2. Access Pattern Optimization</h3> <ul> <li>NUMA-aware allocation</li> <li>Thread affinity</li> <li>Cache line alignment</li> <li>Sequential access patterns</li> </ul> <h3 id="3-gc-optimization">3. GC Optimization</h3> <ul> <li>ZGC configuration</li> <li>Large pages support</li> <li>GC logging</li> <li>Heap sizing strategy</li> </ul> <h2 id="eviction-strategies">Eviction Strategies</h2> <h3 id="1-time-based-eviction">1. Time-Based Eviction</h3> <ul> <li>Rolling time window</li> <li>Configurable retention</li> <li>Background processing</li> <li>Priority queues</li> </ul> <h3 id="2-size-based-eviction">2. Size-Based Eviction</h3> <ul> <li>Memory thresholds</li> <li>Eviction batches</li> <li>Resource monitoring</li> <li>Backpressure handling</li> </ul> <h2 id="monitoring-and-alerting">Monitoring and Alerting</h2> <h3 id="memory-metrics">Memory Metrics</h3> <ol> <li> <strong>Usage Metrics</strong> <ul> <li>Region utilization</li> <li>Page allocation rates</li> <li>Eviction statistics</li> <li>GC performance</li> </ul> </li> <li> <strong>Performance Metrics</strong> <ul> <li>Access latencies</li> <li>Hit/miss ratios</li> <li>Throughput rates</li> <li>Queue depths</li> </ul> </li> </ol> <h3 id="alert-thresholds">Alert Thresholds</h3> <ol> <li> <strong>Critical Alerts</strong> <ul> <li>Memory usage &gt; 90%</li> <li>GC pause &gt; 500ms</li> <li>Eviction rate spike</li> <li>Error rate increase</li> </ul> </li> <li> <strong>Warning Alerts</strong> <ul> <li>Memory usage &gt; 80%</li> <li>GC pause &gt; 200ms</li> <li>Queue depth increase</li> <li>Throughput drop</li> </ul> </li> </ol> <h2 id="performance-results">Performance Results</h2> <h3 id="latency-profile">Latency Profile</h3> <ul> <li>Read operations: &lt; 1ms (p99)</li> <li>Write operations: &lt; 2ms (p99)</li> <li>Query operations: &lt; 10ms (p99)</li> <li>Scan operations: &lt; 100ms (p99)</li> </ul> <h3 id="throughput-achievements">Throughput Achievements</h3> <ul> <li>Event processing: 2.5M/second</li> <li>Query processing: 100K/second</li> <li>Scan processing: 10K/second</li> <li>Background operations: 1K/second</li> </ul> <h2 id="lessons-learned">Lessons Learned</h2> <ol> <li> <strong>Memory Management</strong> <ul> <li>Pre-allocation crucial</li> <li>NUMA awareness important</li> <li>Monitor everything</li> <li>Plan for growth</li> </ul> </li> <li> <strong>Performance Tuning</strong> <ul> <li>Start with defaults</li> <li>Measure thoroughly</li> <li>Tune incrementally</li> <li>Document changes</li> </ul> </li> <li> <strong>Operational Aspects</strong> <ul> <li>Regular monitoring</li> <li>Proactive maintenance</li> <li>Capacity planning</li> <li>Team training</li> </ul> </li> </ol> <h2 id="looking-ahead">Looking Ahead</h2> <p>In Part 4, we’ll explore how we optimized our Kafka infrastructure to handle the massive throughput requirements while ensuring reliable message delivery and processing.</p> <p>Stay tuned to learn about our Kafka cluster design, configuration tuning, and operational practices.</p> </div> </article> <hr> <div style="background: var(--global-code-bg-color); padding: 2rem;"> <div> <h3>Subscribe to my blog</h3> </div> <p style=" margin-bottom: 1rem;"> Get notified when new articles are published. No spam, unsubscribe anytime. </p> <div id="mc_embed_signup"> <form action="https://subhadipmitra.us13.list-manage.com/subscribe/post?u=1ab948a9588be0b556677c306&amp;id=1cb83ab5a9&amp;f_id=007605e9f0" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank"> <div style="display: flex; gap: 0.5rem;"> <input type="email" name="EMAIL" id="mce-EMAIL" placeholder="Enter your email" required style="width: 100%; padding: 0.5rem 1rem; border-radius: 6px; outline: none;"> <button type="submit" style="background-color: var(--global-theme-color); padding: 0.5rem 1.5rem; color: var(--global-bg-color); font-weight: 500; border-radius: 6px; border: none; cursor: pointer;"> Subscribe </button> </div> <div style="position: absolute; left: -5000px;" aria-hidden="true"> <input type="text" name="b_XXXXX_XXXXX" tabindex="-1"> </div> </form> </div> <p style="font-size: 0.75rem; margin-top: 0.75rem;"> By subscribing, you agree to our <a href="/privacy" style="text-decoration: underline; color: inherit;">Privacy Policy</a> </p> </div> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2022/building-a-massive-scale-real-time-data-platform-p2/">Part 2 - Building a Massive-Scale Real-Time Data Platform - Data Partitioning and Flow</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2022/building-a-massive-scale-real-time-data-platform-p1/">Part 1 - Building a Massive-Scale Real-Time Data Platform - System Overview and Architecture</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/retail-bank-multi-agent-system/">Engineering Multi-Agent Systems - A Retail Banking Case Study</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/telecom-autonomous-multi-agent-genai-system/">Engineering Autonomous Multi-Agent Systems - A Technical Deep Dive into Telecom Customer Service</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2021/designing-a-real-time-data-processing-system/">Designing a Real Time Data Processing System</a> </li> <div id="giscus_thread" style="max-width: 1024px; margin: 0 auto;"> <script>let giscusTheme=determineComputedTheme(),giscusAttributes={src:"https://giscus.app/client.js","data-repo":"bassrehab/bassrehab.github.io","data-repo-id":"R_kgDOLvY8Tg","data-category":"Comments","data-category-id":"DIC_kwDOLvY8Ts4CexzE","data-mapping":"title","data-strict":"0","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"bottom","data-theme":giscusTheme,"data-lang":"en",crossorigin:"anonymous",async:""},giscusScript=document.createElement("script");Object.entries(giscusAttributes).forEach(([t,e])=>giscusScript.setAttribute(t,e)),document.getElementById("giscus_thread").appendChild(giscusScript);</script> <noscript>Please enable JavaScript to view the <a href="http://giscus.app/?ref_noscript" rel="external nofollow noopener" target="_blank">comments powered by giscus.</a> </noscript> </div> </div> </div> </div> </div> <footer class="sticky-bottom mt-5" role="contentinfo"> <div class="container"> © Copyright 2025 Subhadip Mitra. Some Rights Reserved. Last updated: January 07, 2025. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script defer src="/assets/js/bootstrap-toc.min.js?c82ff4de8b0955d6ff14f5b05eed7eb6"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?b7816bd189846d29eded8745f9c4cf77"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.min.js"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-TW7YQ5XPC6"></script> <script>function gtag(){window.dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-TW7YQ5XPC6");</script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>