<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta name="google-site-verification" content="R3nPzqP9nO2aTgysGUiU3t-pw3wi1xuUuKVaMrimuck"> <meta name="msvalidate.01" content="04fec5e0d64b1c9bc788e98f81ee2a78"> <meta http-equiv="Permissions-Policy" content="interest-cohort=()"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Part 4 - Building a Massive-Scale Real-Time Data Platform - Memory Management with Apache Ignite | Subhadip Mitra </title> <meta name="author" content="Subhadip Mitra"> <meta name="description" content="Deep dive into memory management with Apache Ignite for high-performance data platforms. Learn how to handle 2.5M events/second with sub-millisecond latency through practical memory architecture, optimization techniques, and real-world implementation patterns."> <meta name="keywords" content="subhadip-mitra,subhadip,google,google-cloud,data-&amp;-analytics,ai-innovations,enterprise-technology-leadership,digital-transformation,machine-learning-models,cloud-technologies,quantum-computing,technology-consulting,singapore,researcher,llm,genai"> <meta property="og:site_name" content="Subhadip Mitra"> <meta property="og:type" content="article"> <meta property="og:title" content="Subhadip Mitra | Part 4 - Building a Massive-Scale Real-Time Data Platform - Memory Management with Apache Ignite"> <meta property="og:url" content="https://subhadipmitra.com/blog/2022/building-a-massive-scale-real-time-data-platform-p4/"> <meta property="og:description" content="Deep dive into memory management with Apache Ignite for high-performance data platforms. Learn how to handle 2.5M events/second with sub-millisecond latency through practical memory architecture, optimization techniques, and real-world implementation patterns."> <meta property="og:image" content="/assets/img/social_preview.png"> <meta property="og:locale" content="en"> <meta name="twitter:card" content="summary"> <meta name="twitter:title" content="Part 4 - Building a Massive-Scale Real-Time Data Platform - Memory Management with Apache Ignite"> <meta name="twitter:description" content="Deep dive into memory management with Apache Ignite for high-performance data platforms. Learn how to handle 2.5M events/second with sub-millisecond latency through practical memory architecture, optimization techniques, and real-world implementation patterns."> <meta name="twitter:image" content="/assets/img/social_preview.png"> <script type="application/ld+json">
    {
        "author":
        {
            "@type": "Person",
            "name": "Subhadip Mitra"
        },
        "url": "https://subhadipmitra.com/blog/2022/building-a-massive-scale-real-time-data-platform-p4/",
        "@type": "BlogPosting",
        "description": "Deep dive into memory management with Apache Ignite for high-performance data platforms. Learn how to handle 2.5M events/second with sub-millisecond latency through practical memory architecture, optimization techniques, and real-world implementation patterns.",
        "headline": "Part 4 - Building a Massive-Scale Real-Time Data Platform - Memory Management with Apache Ignite",
        
        "name": "Subhadip Mitra",
        "@context": "https://schema.org"
    }
  </script> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300..700&amp;family=Inter+Tight:ital,wght@0,100..900;1,100..900&amp;family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link defer href="/assets/css/bootstrap-toc.min.css?6f5af0bb9aab25d79b2448143cbeaa88" rel="stylesheet"> <link rel="shortcut icon" href="/assets/img/favicon.png?058310854f7b3c920f894a1d42c3c47b"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://subhadipmitra.com/blog/2022/building-a-massive-scale-real-time-data-platform-p4/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> </head> <body class="fixed-top-nav sticky-bottom-footer"> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Subhadip</span> Mitra </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/now/">now </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv </a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">more </a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item " href="/archive/">archive</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/contact/">contact</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/license/">licenses</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/privacy/">privacy</a> </div> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="row"> <div class="col-sm-3"> <nav id="toc-sidebar" class="sticky-top"></nav> </div> <div class="col-sm-9"> <div class="post"> <header class="post-header"> <h1 class="post-title">Part 4 - Building a Massive-Scale Real-Time Data Platform - Memory Management with Apache Ignite</h1> <p class="post-meta"> Created on December 05, 2022 </p> <p class="post-tags"> <a href="/blog/2022"> <i class="fa-solid fa-calendar fa-sm"></i> 2022 </a>   ·   <a href="/blog/tag/system-design"> <i class="fa-solid fa-hashtag fa-sm"></i> system-design</a>   <a href="/blog/tag/architecture"> <i class="fa-solid fa-hashtag fa-sm"></i> architecture</a>   <a href="/blog/tag/casestudy"> <i class="fa-solid fa-hashtag fa-sm"></i> casestudy</a>   <a href="/blog/tag/ignite"> <i class="fa-solid fa-hashtag fa-sm"></i> ignite</a>   <a href="/blog/tag/kafka"> <i class="fa-solid fa-hashtag fa-sm"></i> kafka</a>   ·   <a href="/blog/category/architecture"> <i class="fa-solid fa-tag fa-sm"></i> architecture</a>   <a href="/blog/category/system-design"> <i class="fa-solid fa-tag fa-sm"></i> system-design</a>   <a href="/blog/category/casetudy"> <i class="fa-solid fa-tag fa-sm"></i> casetudy</a> </p> </header> <div class="audio-reader-container"> <div class="audio-reader-compact"> <button class="audio-trigger" id="audio-trigger" aria-label="Open audio player"> <i class="fas fa-headphones"></i> <span>Listen to article</span> <i class="fas fa-chevron-down audio-trigger-icon"></i> </button> <div class="audio-player-expanded" id="audio-player-expanded"> <div class="audio-player-body"> <div class="audio-info-bar"> <i class="fas fa-info-circle"></i> <span>Browser text-to-speech • Quality varies by device</span> </div> <div class="audio-controls-row"> <button class="audio-btn audio-btn-play" id="tts-play" aria-label="Play"> <i class="fas fa-play"></i> <span id="play-text">Play</span> </button> <button class="audio-btn audio-btn-pause" id="tts-pause" style="display: none;" aria-label="Pause"> <i class="fas fa-pause"></i> <span>Pause</span> </button> <button class="audio-btn audio-btn-stop" id="tts-stop" aria-label="Stop"> <i class="fas fa-stop"></i> </button> <div class="audio-speed-control"> <label for="tts-rate" class="audio-speed-label"> <i class="fas fa-gauge-high"></i> <span id="tts-rate-value">1.0x</span> </label> <input id="tts-rate" type="range" min="0.5" max="2" step="0.1" value="1" class="audio-speed-slider"> </div> </div> <div class="audio-voice-row"> <label for="tts-voice" class="audio-voice-label"> <i class="fas fa-microphone"></i> <span>Voice:</span> </label> <select id="tts-voice" class="audio-voice-select"> <option value="">Loading voices...</option> </select> </div> <div class="audio-progress-section"> <div class="audio-progress-info"> <span><i class="fas fa-circle-notch"></i> Progress</span> <span id="tts-progress">0%</span> </div> <div class="progress" style="height: 4px;"> <div class="progress-bar" id="tts-progress-bar" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div> </div> </div> </div> </div> </div> </div> <style>.audio-reader-container{margin:1.5rem 0;font-family:var(--global-font-family,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif)}.audio-reader-compact{position:relative}.audio-trigger{display:inline-flex;align-items:center;gap:.5rem;padding:.5rem 1rem;background:var(--global-code-bg-color,#f8f9fa);border:1px solid var(--global-divider-color,#dee2e6);border-radius:.375rem;color:var(--global-text-color,#212529);font-size:.875rem;font-weight:500;cursor:pointer;transition:all .2s ease;font-family:inherit}.audio-trigger:hover{background:var(--global-bg-color,#fff);border-color:var(--global-theme-color,#0d6efd);color:var(--global-theme-color,#0d6efd);box-shadow:0 .125rem .25rem rgba(0,0,0,0.075)}.audio-trigger i:first-child{font-size:1rem;color:var(--global-theme-color,#0d6efd)}.audio-trigger-icon{font-size:.75rem;margin-left:.25rem;transition:transform .3s ease;color:var(--global-text-color-light,#6c757d)}.audio-trigger.active .audio-trigger-icon{transform:rotate(180deg)}.audio-trigger:focus{outline:2px solid var(--global-theme-color,#0d6efd);outline-offset:2px}.audio-player-expanded{display:none;margin-top:.75rem;background:var(--global-bg-color,#fff);border:1px solid var(--global-divider-color,#dee2e6);border-radius:.5rem;box-shadow:0 .25rem .75rem rgba(0,0,0,0.05);animation:slideDown .3s ease}.audio-player-expanded.show{display:block}@keyframes slideDown{from{opacity:0;transform:translateY(-0.5rem)}to{opacity:1;transform:translateY(0)}}.audio-player-body{padding:1rem}.audio-info-bar{display:flex;align-items:center;gap:.5rem;padding:.625rem .75rem;background:var(--global-code-bg-color,#f8f9fa);border-left:2px solid var(--global-theme-color,#0d6efd);border-radius:.25rem;font-size:.8125rem;color:var(--global-text-color-light,#6c757d);margin-bottom:1rem}.audio-info-bar i{color:var(--global-theme-color,#0d6efd);font-size:.875rem}.audio-controls-row{display:flex;align-items:center;gap:.5rem;margin-bottom:.875rem;flex-wrap:wrap}.audio-btn{display:inline-flex;align-items:center;gap:.375rem;padding:.375rem .875rem;border:1px solid transparent;border-radius:.375rem;font-size:.875rem;font-weight:500;cursor:pointer;transition:all .15s ease;font-family:inherit;color:#fff}.audio-btn i{font-size:.8125rem}.audio-btn span{color:#fff}.audio-btn:hover:not(:disabled){transform:translateY(-1px);box-shadow:0 .125rem .375rem rgba(0,0,0,0.15)}.audio-btn:active:not(:disabled){transform:translateY(0)}.audio-btn:disabled{opacity:.6;cursor:not-allowed}.audio-btn-play{background:var(--global-theme-color,#0d6efd);border-color:var(--global-theme-color,#0d6efd)}.audio-btn-play:hover:not(:disabled){background:color-mix(in srgb,var(--global-theme-color,#0d6efd) 85%,black);border-color:color-mix(in srgb,var(--global-theme-color,#0d6efd) 80%,black)}.audio-btn-play.playing{background:#198754;border-color:#198754}.audio-btn-pause{background:#6c757d;border-color:#6c757d}.audio-btn-pause:hover:not(:disabled){background:#5c636a;border-color:#565e64}.audio-btn-stop{background:transparent;color:#dc3545;border-color:#dc3545;padding:.375rem .625rem}.audio-btn-stop:hover:not(:disabled){background:#dc3545;color:#fff;border-color:#dc3545}.audio-speed-control{display:flex;align-items:center;gap:.5rem;margin-left:auto}.audio-speed-label{display:flex;align-items:center;gap:.375rem;font-size:.8125rem;font-weight:500;color:var(--global-text-color,#212529);margin:0;white-space:nowrap}.audio-speed-label i{color:var(--global-theme-color,#0d6efd);font-size:.875rem}.audio-speed-slider{width:80px;height:4px;-webkit-appearance:none;appearance:none;background:var(--global-divider-color,#dee2e6);border-radius:2px;outline:0}.audio-speed-slider::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;width:14px;height:14px;border-radius:50%;background:var(--global-theme-color,#0d6efd);cursor:pointer;transition:transform .15s ease}.audio-speed-slider::-webkit-slider-thumb:hover{transform:scale(1.2)}.audio-speed-slider::-moz-range-thumb{width:14px;height:14px;border-radius:50%;background:var(--global-theme-color,#0d6efd);border:0;cursor:pointer;transition:transform .15s ease}.audio-speed-slider::-moz-range-thumb:hover{transform:scale(1.2)}.audio-voice-row{display:flex;align-items:center;gap:.75rem;margin-bottom:.875rem}.audio-voice-label{display:flex;align-items:center;gap:.375rem;font-size:.8125rem;font-weight:500;color:var(--global-text-color,#212529);margin:0;white-space:nowrap}.audio-voice-label i{color:var(--global-theme-color,#0d6efd);font-size:.875rem}.audio-voice-select{flex:1;padding:.375rem .75rem;border:1px solid var(--global-divider-color,#dee2e6);border-radius:.375rem;font-size:.8125rem;background:var(--global-bg-color,#fff);color:var(--global-text-color,#212529);cursor:pointer;transition:border-color .15s ease}.audio-voice-select:hover{border-color:var(--global-theme-color,#0d6efd)}.audio-voice-select:focus{outline:0;border-color:var(--global-theme-color,#0d6efd);box-shadow:0 0 0 .2rem rgba(13,110,253,0.25)}.audio-progress-section{margin-top:.75rem;padding-top:.75rem;border-top:1px solid var(--global-divider-color,#e9ecef)}
.audio-progress-info{display:flex;justify-content:space-between;align-items:center;font-size:.8125rem;color:var(--global-text-color-light,#6c757d);margin-bottom:.5rem}.audio-progress-info i{margin-right:.25rem;color:var(--global-theme-color,#0d6efd);font-size:.75rem}.progress{border-radius:2px;overflow:hidden;background:var(--global-divider-color,#e9ecef)}.progress-bar{background:var(--global-theme-color,#0d6efd);transition:width .6s ease}[data-theme="dark"] .audio-trigger,body.dark-mode .audio-trigger{background:rgba(255,255,255,0.05);border-color:var(--global-divider-color,#454545);color:var(--global-text-color,#e9ecef)}[data-theme="dark"] .audio-trigger:hover,body.dark-mode .audio-trigger:hover{background:rgba(255,255,255,0.08)}[data-theme="dark"] .audio-player-expanded,body.dark-mode .audio-player-expanded{background:var(--global-bg-color,#1e1e1e);border-color:var(--global-divider-color,#454545)}[data-theme="dark"] .audio-info-bar,body.dark-mode .audio-info-bar{background:rgba(255,255,255,0.03)}[data-theme="dark"] .audio-voice-select,body.dark-mode .audio-voice-select{background:var(--global-bg-color,#1e1e1e);border-color:var(--global-divider-color,#454545);color:var(--global-text-color,#e9ecef)}[data-theme="dark"] .progress,body.dark-mode .progress{background:rgba(255,255,255,0.1)}@media(max-width:576px){.audio-trigger span{display:none}.audio-controls-row{flex-wrap:wrap}.audio-btn span{display:none}.audio-btn{padding:.5rem .75rem}.audio-btn i{font-size:1rem}.audio-speed-control{width:100%;margin-left:0;margin-top:.5rem}.audio-speed-slider{flex:1}.audio-voice-row{flex-direction:column;align-items:stretch}}@media print{.audio-reader-container{display:none!important}}@media(prefers-reduced-motion:reduce){.audio-trigger,.audio-btn,.progress-bar,.audio-player-expanded{transition:none;animation:none}}</style> <script>
(function() {
  'use strict';
  
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
  } else {
    init();
  }
  
  function init() {
    if (!('speechSynthesis' in window)) {
      document.querySelector('.audio-reader-container').innerHTML = `
        <div class="audio-reader-compact">
          <div class="alert alert-warning d-flex align-items-center" role="alert" style="font-size: 0.875rem;">
            <i class="fas fa-exclamation-triangle me-2"></i>
            <div>Text-to-speech not supported in this browser.</div>
          </div>
        </div>
      `;
      return;
    }

    const synth = window.speechSynthesis;
    let utterance = null;
    let isPaused = false;
    
    const triggerBtn = document.getElementById('audio-trigger');
    const expandedPlayer = document.getElementById('audio-player-expanded');
    const playBtn = document.getElementById('tts-play');
    const pauseBtn = document.getElementById('tts-pause');
    const stopBtn = document.getElementById('tts-stop');
    const voiceSelect = document.getElementById('tts-voice');
    const rateSlider = document.getElementById('tts-rate');
    const rateValue = document.getElementById('tts-rate-value');
    const progressText = document.getElementById('tts-progress');
    const progressBar = document.getElementById('tts-progress-bar');
    const playText = document.getElementById('play-text');

    const possibleSelectors = [
      '.post-content',
      'article .post-content',
      '.post .post-content',
      'article.post',
      '.post',
      'article',
      'main article',
      'main .container',
      'main',
      '.l-main',
      '.content'
    ];
    
    let articleElement = null;
    for (const selector of possibleSelectors) {
      articleElement = document.querySelector(selector);
      if (articleElement) break;
    }
    
    if (!articleElement) {
      console.warn('Audio Reader: Could not find article content');
      return;
    }
    
    const clonedContent = articleElement.cloneNode(true);
    const elementsToRemove = [
      'pre', 'code', 'script', 'style', 'nav', '.audio-reader-container',
      '.citation', '.giscus', '.utterances', '.navigation', '.pagination',
      '.social', '.share', 'header', 'footer', '.header', '.footer', '.sidebar'
    ];
    
    elementsToRemove.forEach(selector => {
      clonedContent.querySelectorAll(selector).forEach(el => el.remove());
    });
    
    const articleText = clonedContent.innerText
      .replace(/\s+/g, ' ')
      .replace(/\n{3,}/g, '\n\n')
      .trim();
    
    if (!articleText || articleText.length < 100) {
      console.warn('Audio Reader: Article too short');
      return;
    }

    // Toggle player
    triggerBtn.addEventListener('click', function() {
      expandedPlayer.classList.toggle('show');
      this.classList.toggle('active');
      localStorage.setItem('audioPlayerExpanded', expandedPlayer.classList.contains('show'));
    });

    // Load voices
    function loadVoices() {
      const voices = synth.getVoices();
      if (voices.length === 0) {
        setTimeout(loadVoices, 100);
        return;
      }
      
      voiceSelect.innerHTML = '<option value="">Default Voice</option>';
      
      const englishVoices = voices.filter(v => v.lang.startsWith('en'));
      const preferredVoices = englishVoices.filter(v => 
        v.name.includes('Google') || v.name.includes('Microsoft') ||
        v.name.includes('Premium') || v.name.includes('Enhanced') || v.name.includes('Natural')
      );
      const standardEnglishVoices = englishVoices.filter(v => !preferredVoices.includes(v));
      const otherVoices = voices.filter(v => !v.lang.startsWith('en'));
      
      preferredVoices.forEach((voice) => {
        const option = document.createElement('option');
        option.value = voices.indexOf(voice);
        option.textContent = `${voice.name} (${voice.lang})`;
        voiceSelect.appendChild(option);
      });
      
      if (standardEnglishVoices.length > 0) {
        const optgroup = document.createElement('optgroup');
        optgroup.label = 'Other English';
        standardEnglishVoices.forEach((voice) => {
          const option = document.createElement('option');
          option.value = voices.indexOf(voice);
          option.textContent = `${voice.name} (${voice.lang})`;
          optgroup.appendChild(option);
        });
        voiceSelect.appendChild(optgroup);
      }
      
      if (otherVoices.length > 0) {
        const optgroup = document.createElement('optgroup');
        optgroup.label = 'Other Languages';
        otherVoices.forEach((voice) => {
          const option = document.createElement('option');
          option.value = voices.indexOf(voice);
          option.textContent = `${voice.name} (${voice.lang})`;
          optgroup.appendChild(option);
        });
        voiceSelect.appendChild(optgroup);
      }
    }

    loadVoices();
    if (synth.addEventListener) {
      synth.addEventListener('voiceschanged', loadVoices);
    }

    function updateProgress(current, total) {
      const percent = Math.min(100, Math.round((current / total) * 100));
      progressText.textContent = `${percent}%`;
      progressBar.style.width = `${percent}%`;
      progressBar.setAttribute('aria-valuenow', percent);
    }

    function updatePlayButton(isPlaying) {
      const icon = playBtn.querySelector('i');
      if (isPlaying) {
        icon.className = 'fas fa-circle-dot';
        playText.textContent = 'Playing';
        playBtn.classList.add('playing');
      } else {
        icon.className = 'fas fa-play';
        playText.textContent = 'Play';
        playBtn.classList.remove('playing');
      }
    }

    function speak() {
      if (isPaused) {
        synth.resume();
        isPaused = false;
        updatePlayButton(true);
        pauseBtn.style.display = 'inline-flex';
        return;
      }

      synth.cancel();
      utterance = new SpeechSynthesisUtterance(articleText);
      
      if (voiceSelect.value) {
        const voices = synth.getVoices();
        utterance.voice = voices[parseInt(voiceSelect.value)];
      }
      
      utterance.rate = parseFloat(rateSlider.value);
      utterance.pitch = 1;
      utterance.volume = 1;
      
      utterance.onstart = function() {
        updatePlayButton(true);
        pauseBtn.style.display = 'inline-flex';
        playBtn.disabled = false;
      };
      
      utterance.onend = function() {
        updatePlayButton(false);
        pauseBtn.style.display = 'none';
        updateProgress(100, 100);
        setTimeout(() => updateProgress(0, 100), 1000);
      };
      
      utterance.onboundary = function(event) {
        updateProgress(event.charIndex, articleText.length);
      };

      utterance.onerror = function(event) {
        if (event.error !== 'interrupted' && event.error !== 'canceled') {
          alert('Playback error. Try a different voice.');
        }
        updatePlayButton(false);
        pauseBtn.style.display = 'none';
      };

      playBtn.disabled = true;
      synth.speak(utterance);
    }

    function pause() {
      if (synth.speaking && !isPaused) {
        synth.pause();
        isPaused = true;
        const icon = playBtn.querySelector('i');
        icon.className = 'fas fa-play';
        playText.textContent = 'Resume';
        playBtn.classList.remove('playing');
        pauseBtn.style.display = 'none';
      }
    }

    function stop() {
      synth.cancel();
      isPaused = false;
      updatePlayButton(false);
      pauseBtn.style.display = 'none';
      updateProgress(0, 100);
    }

    playBtn.addEventListener('click', speak);
    pauseBtn.addEventListener('click', pause);
    stopBtn.addEventListener('click', stop);
    
    rateSlider.addEventListener('input', function(e) {
      rateValue.textContent = `${parseFloat(e.target.value).toFixed(1)}x`;
    });

    window.addEventListener('beforeunload', function() {
      synth.cancel();
    });

    if (localStorage.getItem('audioPlayerExpanded') === 'true') {
      setTimeout(() => {
        expandedPlayer.classList.add('show');
        triggerBtn.classList.add('active');
      }, 100);
    }
  }
})();
</script> <article class="post-content"> <div id="markdown-content"> <p>In Parts 1-3, we explored our system architecture, data partitioning, and memory management. Today, we’ll dive deep into how we optimized Apache Kafka to handle 2.5 million events per second while ensuring reliable message delivery and processing.</p> <h2 id="infrastructure-scale">Infrastructure Scale</h2> <h3 id="cluster-configuration">Cluster Configuration</h3> <ul> <li>24 broker nodes across 3 availability zones</li> <li>Each broker: 144 cores, 256GB RAM</li> <li>RAID10 NVMe storage</li> <li>25Gbps network interfaces</li> <li>Dedicated ZooKeeper ensemble</li> </ul> <h3 id="topic-design">Topic Design</h3> <div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Network Events (1.2M/sec)
</span><span class="err">network.events.${region}.${type}</span> <span class="err">=</span> <span class="err">{</span>
    <span class="py">partitions</span> <span class="p">=</span> <span class="s">600,</span>
    <span class="py">replication.factor</span> <span class="p">=</span> <span class="s">3,</span>
    <span class="py">min.insync.replicas</span> <span class="p">=</span> <span class="s">2,</span>
    <span class="py">retention.ms</span> <span class="p">=</span> <span class="s">604800000  # 7 days</span>
<span class="err">}</span>

<span class="c"># Subscriber Events (800K/sec)
</span><span class="err">subscriber.events.${region}.${type}</span> <span class="err">=</span> <span class="err">{</span>
    <span class="py">partitions</span> <span class="p">=</span> <span class="s">400,</span>
    <span class="py">replication.factor</span> <span class="p">=</span> <span class="s">3,</span>
    <span class="py">min.insync.replicas</span> <span class="p">=</span> <span class="s">2,</span>
    <span class="py">retention.ms</span> <span class="p">=</span> <span class="s">604800000</span>
<span class="err">}</span>

<span class="c"># Location Events (400K/sec)
</span><span class="err">location.updates.${region}</span> <span class="err">=</span> <span class="err">{</span>
    <span class="py">partitions</span> <span class="p">=</span> <span class="s">200,</span>
    <span class="py">replication.factor</span> <span class="p">=</span> <span class="s">3,</span>
    <span class="py">min.insync.replicas</span> <span class="p">=</span> <span class="s">2,</span>
    <span class="py">retention.ms</span> <span class="p">=</span> <span class="s">259200000  # 3 days</span>
<span class="err">}</span>

<span class="c"># DPI Data (350GB/15min)
</span><span class="err">dpi.data.${region}.${window}</span> <span class="err">=</span> <span class="err">{</span>
    <span class="py">partitions</span> <span class="p">=</span> <span class="s">100,</span>
    <span class="py">replication.factor</span> <span class="p">=</span> <span class="s">3,</span>
    <span class="py">min.insync.replicas</span> <span class="p">=</span> <span class="s">2,</span>
    <span class="py">retention.ms</span> <span class="p">=</span> <span class="s">86400000   # 1 day</span>
<span class="err">}</span>
</code></pre></div></div> <h2 id="producer-optimization">Producer Optimization</h2> <h3 id="producer-configuration">Producer Configuration</h3> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">OptimizedProducerConfig</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="nc">Properties</span> <span class="nf">getConfig</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">Properties</span> <span class="n">props</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Properties</span><span class="o">();</span>
        
        <span class="c1">// Basic Configuration</span>
        <span class="n">props</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">ProducerConfig</span><span class="o">.</span><span class="na">BOOTSTRAP_SERVERS_CONFIG</span><span class="o">,</span> 
                 <span class="s">"kafka1:9092,kafka2:9092,kafka3:9092"</span><span class="o">);</span>
        <span class="n">props</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">ProducerConfig</span><span class="o">.</span><span class="na">KEY_SERIALIZER_CLASS_CONFIG</span><span class="o">,</span> 
                 <span class="s">"org.apache.kafka.common.serialization.StringSerializer"</span><span class="o">);</span>
        <span class="n">props</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">ProducerConfig</span><span class="o">.</span><span class="na">VALUE_SERIALIZER_CLASS_CONFIG</span><span class="o">,</span> 
                 <span class="s">"org.apache.kafka.common.serialization.ByteArraySerializer"</span><span class="o">);</span>
        
        <span class="c1">// Performance Optimization</span>
        <span class="n">props</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">ProducerConfig</span><span class="o">.</span><span class="na">BATCH_SIZE_CONFIG</span><span class="o">,</span> <span class="mi">1048576</span><span class="o">);</span>       <span class="c1">// 1MB batch size</span>
        <span class="n">props</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">ProducerConfig</span><span class="o">.</span><span class="na">LINGER_MS_CONFIG</span><span class="o">,</span> <span class="mi">5</span><span class="o">);</span>             <span class="c1">// 5ms linger</span>
        <span class="n">props</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">ProducerConfig</span><span class="o">.</span><span class="na">COMPRESSION_TYPE_CONFIG</span><span class="o">,</span> <span class="s">"lz4"</span><span class="o">);</span>   <span class="c1">// LZ4 compression</span>
        <span class="n">props</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">ProducerConfig</span><span class="o">.</span><span class="na">BUFFER_MEMORY_CONFIG</span><span class="o">,</span> <span class="mi">67108864</span><span class="o">);</span>   <span class="c1">// 64MB buffer</span>
        
        <span class="c1">// Reliability Settings</span>
        <span class="n">props</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">ProducerConfig</span><span class="o">.</span><span class="na">ACKS_CONFIG</span><span class="o">,</span> <span class="s">"1"</span><span class="o">);</span>                <span class="c1">// Leader acknowledgment</span>
        <span class="n">props</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">ProducerConfig</span><span class="o">.</span><span class="na">RETRIES_CONFIG</span><span class="o">,</span> <span class="mi">3</span><span class="o">);</span>               <span class="c1">// Retry count</span>
        <span class="n">props</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">ProducerConfig</span><span class="o">.</span><span class="na">MAX_IN_FLIGHT_REQUESTS_PER_CONNECTION</span><span class="o">,</span> <span class="mi">5</span><span class="o">);</span>
        <span class="n">props</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">ProducerConfig</span><span class="o">.</span><span class="na">ENABLE_IDEMPOTENCE_CONFIG</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span> <span class="c1">// Exactly-once</span>
        
        <span class="k">return</span> <span class="n">props</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <h3 id="batch-processing-implementation">Batch Processing Implementation</h3> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">BatchProducer</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">KafkaProducer</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]&gt;</span> <span class="n">producer</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">topic</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">batchSize</span> <span class="o">=</span> <span class="mi">10000</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">ProducerRecord</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]&gt;&gt;</span> <span class="n">batch</span><span class="o">;</span>
    
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">sendBatch</span><span class="o">(</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Event</span><span class="o">&gt;</span> <span class="n">events</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">CompletableFuture</span><span class="o">&lt;</span><span class="nc">RecordMetadata</span><span class="o">&gt;&gt;</span> <span class="n">futures</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
        
        <span class="k">for</span> <span class="o">(</span><span class="nc">Event</span> <span class="n">event</span> <span class="o">:</span> <span class="n">events</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">ProducerRecord</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]&gt;</span> <span class="n">record</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ProducerRecord</span><span class="o">&lt;&gt;(</span>
                <span class="n">topic</span><span class="o">,</span>
                <span class="n">event</span><span class="o">.</span><span class="na">getPartitionKey</span><span class="o">(),</span>
                <span class="n">event</span><span class="o">.</span><span class="na">serialize</span><span class="o">()</span>
            <span class="o">);</span>
            
            <span class="nc">CompletableFuture</span><span class="o">&lt;</span><span class="nc">RecordMetadata</span><span class="o">&gt;</span> <span class="n">future</span> <span class="o">=</span> 
                <span class="nc">CompletableFuture</span><span class="o">.</span><span class="na">supplyAsync</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
                    <span class="k">try</span> <span class="o">{</span>
                        <span class="k">return</span> <span class="n">producer</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="n">record</span><span class="o">).</span><span class="na">get</span><span class="o">();</span>
                    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">handleError</span><span class="o">(</span><span class="n">record</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
                        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
                    <span class="o">}</span>
                <span class="o">});</span>
                
            <span class="n">futures</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">future</span><span class="o">);</span>
            
            <span class="k">if</span> <span class="o">(</span><span class="n">futures</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">&gt;=</span> <span class="n">batchSize</span><span class="o">)</span> <span class="o">{</span>
                <span class="nc">CompletableFuture</span><span class="o">.</span><span class="na">allOf</span><span class="o">(</span>
                    <span class="n">futures</span><span class="o">.</span><span class="na">toArray</span><span class="o">(</span><span class="k">new</span> <span class="nc">CompletableFuture</span><span class="o">[</span><span class="mi">0</span><span class="o">])</span>
                <span class="o">).</span><span class="na">join</span><span class="o">();</span>
                <span class="n">futures</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <h2 id="consumer-optimization">Consumer Optimization</h2> <h3 id="consumer-configuration">Consumer Configuration</h3> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">OptimizedConsumerConfig</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="nc">Properties</span> <span class="nf">getConfig</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">Properties</span> <span class="n">props</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Properties</span><span class="o">();</span>
        
        <span class="c1">// Basic Configuration</span>
        <span class="n">props</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">ConsumerConfig</span><span class="o">.</span><span class="na">BOOTSTRAP_SERVERS_CONFIG</span><span class="o">,</span> 
                 <span class="s">"kafka1:9092,kafka2:9092,kafka3:9092"</span><span class="o">);</span>
        <span class="n">props</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">ConsumerConfig</span><span class="o">.</span><span class="na">GROUP_ID_CONFIG</span><span class="o">,</span> <span class="s">"event-processor"</span><span class="o">);</span>
        <span class="n">props</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">ConsumerConfig</span><span class="o">.</span><span class="na">AUTO_OFFSET_RESET_CONFIG</span><span class="o">,</span> <span class="s">"earliest"</span><span class="o">);</span>
        
        <span class="c1">// Performance Settings</span>
        <span class="n">props</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">ConsumerConfig</span><span class="o">.</span><span class="na">FETCH_MIN_BYTES_CONFIG</span><span class="o">,</span> <span class="mi">1048576</span><span class="o">);</span>     <span class="c1">// 1MB min fetch</span>
        <span class="n">props</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">ConsumerConfig</span><span class="o">.</span><span class="na">FETCH_MAX_BYTES_CONFIG</span><span class="o">,</span> <span class="mi">52428800</span><span class="o">);</span>    <span class="c1">// 50MB max fetch</span>
        <span class="n">props</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">ConsumerConfig</span><span class="o">.</span><span class="na">MAX_POLL_RECORDS_CONFIG</span><span class="o">,</span> <span class="mi">10000</span><span class="o">);</span>      <span class="c1">// Max records per poll</span>
        <span class="n">props</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">ConsumerConfig</span><span class="o">.</span><span class="na">MAX_PARTITION_FETCH_BYTES_CONFIG</span><span class="o">,</span> <span class="mi">10485760</span><span class="o">);</span> <span class="c1">// 10MB per partition</span>
        
        <span class="c1">// Reliability Settings</span>
        <span class="n">props</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">ConsumerConfig</span><span class="o">.</span><span class="na">ENABLE_AUTO_COMMIT_CONFIG</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>    <span class="c1">// Manual commit</span>
        <span class="n">props</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">ConsumerConfig</span><span class="o">.</span><span class="na">MAX_POLL_INTERVAL_MS_CONFIG</span><span class="o">,</span> <span class="mi">300000</span><span class="o">);</span> <span class="c1">// 5 minutes max processing</span>
        <span class="n">props</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">ConsumerConfig</span><span class="o">.</span><span class="na">SESSION_TIMEOUT_MS_CONFIG</span><span class="o">,</span> <span class="mi">60000</span><span class="o">);</span>    <span class="c1">// 1 minute timeout</span>
        
        <span class="k">return</span> <span class="n">props</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <h3 id="parallel-processing-implementation">Parallel Processing Implementation</h3> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ParallelConsumer</span> <span class="kd">implements</span> <span class="nc">Runnable</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">KafkaConsumer</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]&gt;</span> <span class="n">consumer</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">ExecutorService</span> <span class="n">executor</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">workerThreads</span> <span class="o">=</span> <span class="mi">32</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">volatile</span> <span class="kt">boolean</span> <span class="n">running</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
    
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">while</span> <span class="o">(</span><span class="n">running</span><span class="o">)</span> <span class="o">{</span>
                <span class="nc">ConsumerRecords</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]&gt;</span> <span class="n">records</span> <span class="o">=</span> 
                    <span class="n">consumer</span><span class="o">.</span><span class="na">poll</span><span class="o">(</span><span class="nc">Duration</span><span class="o">.</span><span class="na">ofMillis</span><span class="o">(</span><span class="mi">100</span><span class="o">));</span>
                
                <span class="k">if</span> <span class="o">(!</span><span class="n">records</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
                    <span class="n">processRecordsInParallel</span><span class="o">(</span><span class="n">records</span><span class="o">);</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
            <span class="n">consumer</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
            <span class="n">executor</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
    
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">processRecordsInParallel</span><span class="o">(</span>
            <span class="nc">ConsumerRecords</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]&gt;</span> <span class="n">records</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// Group records by partition</span>
        <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">TopicPartition</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">ConsumerRecord</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[]&gt;&gt;&gt;</span> 
            <span class="n">partitionedRecords</span> <span class="o">=</span> <span class="nc">StreamSupport</span>
                <span class="o">.</span><span class="na">stream</span><span class="o">(</span><span class="n">records</span><span class="o">.</span><span class="na">spliterator</span><span class="o">(),</span> <span class="kc">false</span><span class="o">)</span>
                <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="nc">Collectors</span><span class="o">.</span><span class="na">groupingBy</span><span class="o">(</span><span class="n">record</span> <span class="o">-&gt;</span> 
                    <span class="k">new</span> <span class="nf">TopicPartition</span><span class="o">(</span>
                        <span class="n">record</span><span class="o">.</span><span class="na">topic</span><span class="o">(),</span> 
                        <span class="n">record</span><span class="o">.</span><span class="na">partition</span><span class="o">()</span>
                    <span class="o">)));</span>
        
        <span class="c1">// Process each partition's records in parallel</span>
        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">CompletableFuture</span><span class="o">&lt;</span><span class="nc">Void</span><span class="o">&gt;&gt;</span> <span class="n">futures</span> <span class="o">=</span> 
            <span class="n">partitionedRecords</span><span class="o">.</span><span class="na">entrySet</span><span class="o">().</span><span class="na">stream</span><span class="o">()</span>
                <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">entry</span> <span class="o">-&gt;</span> <span class="nc">CompletableFuture</span><span class="o">.</span><span class="na">runAsync</span><span class="o">(()</span> <span class="o">-&gt;</span> 
                    <span class="n">processPartitionRecords</span><span class="o">(</span><span class="n">entry</span><span class="o">.</span><span class="na">getValue</span><span class="o">()),</span> 
                    <span class="n">executor</span><span class="o">))</span>
                <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="nc">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
        
        <span class="c1">// Wait for all processing to complete</span>
        <span class="nc">CompletableFuture</span><span class="o">.</span><span class="na">allOf</span><span class="o">(</span>
            <span class="n">futures</span><span class="o">.</span><span class="na">toArray</span><span class="o">(</span><span class="k">new</span> <span class="nc">CompletableFuture</span><span class="o">[</span><span class="mi">0</span><span class="o">])</span>
        <span class="o">).</span><span class="na">join</span><span class="o">();</span>
        
        <span class="c1">// Commit offsets</span>
        <span class="n">consumer</span><span class="o">.</span><span class="na">commitSync</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <h2 id="stream-processing-optimization">Stream Processing Optimization</h2> <h3 id="kafka-streams-configuration">Kafka Streams Configuration</h3> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">StreamsConfig</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="nc">Properties</span> <span class="nf">getConfig</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">Properties</span> <span class="n">props</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Properties</span><span class="o">();</span>
        
        <span class="c1">// Basic Settings</span>
        <span class="n">props</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">StreamsConfig</span><span class="o">.</span><span class="na">BOOTSTRAP_SERVERS_CONFIG</span><span class="o">,</span> 
                 <span class="s">"kafka1:9092,kafka2:9092,kafka3:9092"</span><span class="o">);</span>
        <span class="n">props</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">StreamsConfig</span><span class="o">.</span><span class="na">APPLICATION_ID_CONFIG</span><span class="o">,</span> <span class="s">"event-processor"</span><span class="o">);</span>
        
        <span class="c1">// Performance Tuning</span>
        <span class="n">props</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">StreamsConfig</span><span class="o">.</span><span class="na">NUM_STREAM_THREADS_CONFIG</span><span class="o">,</span> <span class="mi">32</span><span class="o">);</span>
        <span class="n">props</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">StreamsConfig</span><span class="o">.</span><span class="na">CACHE_MAX_BYTES_BUFFERING_CONFIG</span><span class="o">,</span> 
                 <span class="mi">134217728</span><span class="o">);</span> <span class="c1">// 128MB cache</span>
        <span class="n">props</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">StreamsConfig</span><span class="o">.</span><span class="na">COMMIT_INTERVAL_MS_CONFIG</span><span class="o">,</span> <span class="mi">100</span><span class="o">);</span>
        <span class="n">props</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">StreamsConfig</span><span class="o">.</span><span class="na">PROCESSING_GUARANTEE_CONFIG</span><span class="o">,</span> 
                 <span class="s">"exactly_once_v2"</span><span class="o">);</span>
        
        <span class="c1">// State Store Settings</span>
        <span class="n">props</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">StreamsConfig</span><span class="o">.</span><span class="na">STATE_DIR_CONFIG</span><span class="o">,</span> <span class="s">"/data/kafka-streams"</span><span class="o">);</span>
        <span class="n">props</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">StreamsConfig</span><span class="o">.</span><span class="na">REPLICATION_FACTOR_CONFIG</span><span class="o">,</span> <span class="mi">3</span><span class="o">);</span>
        
        <span class="k">return</span> <span class="n">props</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <h3 id="stream-processing-implementation">Stream Processing Implementation</h3> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">EventStreamProcessor</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="nc">Topology</span> <span class="nf">createTopology</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">StreamsBuilder</span> <span class="n">builder</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StreamsBuilder</span><span class="o">();</span>
        
        <span class="c1">// Create event streams</span>
        <span class="nc">KStream</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Event</span><span class="o">&gt;</span> <span class="n">events</span> <span class="o">=</span> <span class="n">builder</span>
            <span class="o">.</span><span class="na">stream</span><span class="o">(</span><span class="s">"events"</span><span class="o">,</span> 
                <span class="nc">Consumed</span><span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="nc">Serdes</span><span class="o">.</span><span class="na">String</span><span class="o">(),</span> <span class="n">eventSerde</span><span class="o">));</span>
        
        <span class="c1">// Process network events</span>
        <span class="nc">KStream</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Event</span><span class="o">&gt;</span> <span class="n">networkEvents</span> <span class="o">=</span> <span class="n">events</span>
            <span class="o">.</span><span class="na">filter</span><span class="o">((</span><span class="n">key</span><span class="o">,</span> <span class="n">event</span><span class="o">)</span> <span class="o">-&gt;</span> 
                <span class="n">event</span><span class="o">.</span><span class="na">getType</span><span class="o">()</span> <span class="o">==</span> <span class="nc">EventType</span><span class="o">.</span><span class="na">NETWORK</span><span class="o">)</span>
            <span class="o">.</span><span class="na">mapValues</span><span class="o">(</span><span class="k">this</span><span class="o">::</span><span class="n">enrichNetworkEvent</span><span class="o">)</span>
            <span class="o">.</span><span class="na">repartition</span><span class="o">(</span><span class="mi">32</span><span class="o">);</span> <span class="c1">// Increase parallelism</span>
        
        <span class="c1">// Process subscriber events</span>
        <span class="nc">KStream</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Event</span><span class="o">&gt;</span> <span class="n">subscriberEvents</span> <span class="o">=</span> <span class="n">events</span>
            <span class="o">.</span><span class="na">filter</span><span class="o">((</span><span class="n">key</span><span class="o">,</span> <span class="n">event</span><span class="o">)</span> <span class="o">-&gt;</span> 
                <span class="n">event</span><span class="o">.</span><span class="na">getType</span><span class="o">()</span> <span class="o">==</span> <span class="nc">EventType</span><span class="o">.</span><span class="na">SUBSCRIBER</span><span class="o">)</span>
            <span class="o">.</span><span class="na">mapValues</span><span class="o">(</span><span class="k">this</span><span class="o">::</span><span class="n">enrichSubscriberEvent</span><span class="o">)</span>
            <span class="o">.</span><span class="na">repartition</span><span class="o">(</span><span class="mi">32</span><span class="o">);</span>
        
        <span class="c1">// Join streams and process</span>
        <span class="nc">KStream</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">EnrichedEvent</span><span class="o">&gt;</span> <span class="n">enrichedEvents</span> <span class="o">=</span> 
            <span class="n">networkEvents</span><span class="o">.</span><span class="na">join</span><span class="o">(</span>
                <span class="n">subscriberEvents</span><span class="o">,</span>
                <span class="k">this</span><span class="o">::</span><span class="n">joinEvents</span><span class="o">,</span>
                <span class="nc">JoinWindows</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="nc">Duration</span><span class="o">.</span><span class="na">ofSeconds</span><span class="o">(</span><span class="mi">10</span><span class="o">))</span>
            <span class="o">);</span>
        
        <span class="c1">// Store results</span>
        <span class="n">enrichedEvents</span><span class="o">.</span><span class="na">to</span><span class="o">(</span><span class="s">"enriched-events"</span><span class="o">);</span>
        
        <span class="k">return</span> <span class="n">builder</span><span class="o">.</span><span class="na">build</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <h2 id="monitoring-and-alerting">Monitoring and Alerting</h2> <h3 id="key-metrics">Key Metrics</h3> <ol> <li>Producer Metrics <ul> <li>Batch size avg/max</li> <li>Record send rate</li> <li>Record error rate</li> <li>Buffer pool usage</li> </ul> </li> <li>Consumer Metrics <ul> <li>Record lag</li> <li>Poll rate</li> <li>Processing time</li> <li>Rebalance events</li> </ul> </li> <li>Broker Metrics <ul> <li>Under-replicated partitions</li> <li>Request handler idle %</li> <li>Network processor avg idle %</li> <li>Log flush latency</li> </ul> </li> </ol> <h3 id="monitoring-implementation">Monitoring Implementation</h3> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">KafkaMonitor</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">MetricRegistry</span> <span class="n">metrics</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">AlertManager</span> <span class="n">alertManager</span><span class="o">;</span>
    
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">collectMetrics</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// Producer metrics</span>
        <span class="n">metrics</span><span class="o">.</span><span class="na">gauge</span><span class="o">(</span><span class="s">"kafka.producer.batch.size"</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span>
            <span class="n">getProducerBatchSize</span><span class="o">());</span>
        <span class="n">metrics</span><span class="o">.</span><span class="na">gauge</span><span class="o">(</span><span class="s">"kafka.producer.send.rate"</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span>
            <span class="n">getProducerSendRate</span><span class="o">());</span>
            
        <span class="c1">// Consumer metrics</span>
        <span class="n">metrics</span><span class="o">.</span><span class="na">gauge</span><span class="o">(</span><span class="s">"kafka.consumer.lag"</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span>
            <span class="n">getConsumerLag</span><span class="o">());</span>
        <span class="n">metrics</span><span class="o">.</span><span class="na">gauge</span><span class="o">(</span><span class="s">"kafka.consumer.processing.time"</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span>
            <span class="n">getConsumerProcessingTime</span><span class="o">());</span>
            
        <span class="c1">// Broker metrics</span>
        <span class="n">metrics</span><span class="o">.</span><span class="na">gauge</span><span class="o">(</span><span class="s">"kafka.broker.under.replicated.partitions"</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span>
            <span class="n">getUnderReplicatedPartitions</span><span class="o">());</span>
        <span class="n">metrics</span><span class="o">.</span><span class="na">gauge</span><span class="o">(</span><span class="s">"kafka.broker.request.handler.avg.idle"</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span>
            <span class="n">getRequestHandlerAvgIdle</span><span class="o">());</span>
            
        <span class="c1">// Check thresholds and alert</span>
        <span class="n">checkThresholdsAndAlert</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <h2 id="lessons-learned">Lessons Learned</h2> <h3 id="1-cluster-design-and-sizing">1. Cluster Design and Sizing</h3> <h4 id="infrastructure-planning">Infrastructure Planning</h4> <ul> <li> <strong>Start with 2x Expected Capacity</strong> <ul> <li>Account for peak loads</li> <li>Plan for data growth</li> <li>Consider replication factor</li> <li>Reserve capacity for rebalancing</li> </ul> </li> </ul> <h4 id="implementation-example">Implementation Example</h4> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ClusterCapacityCalculator</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="nc">ClusterRequirements</span> <span class="nf">calculateRequirements</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// Calculate based on event rates</span>
        <span class="kt">long</span> <span class="n">eventsPerSecond</span> <span class="o">=</span> <span class="mi">2_500_000</span><span class="o">;</span> <span class="c1">// 2.5M events/sec</span>
        <span class="kt">int</span> <span class="n">avgEventSize</span> <span class="o">=</span> <span class="mi">1024</span><span class="o">;</span> <span class="c1">// 1KB average</span>
        <span class="kt">double</span> <span class="n">peakLoadFactor</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">;</span> <span class="c1">// 2x peak capacity</span>
        <span class="kt">int</span> <span class="n">replicationFactor</span> <span class="o">=</span> <span class="mi">3</span><span class="o">;</span>
        
        <span class="c1">// Calculate storage requirements</span>
        <span class="kt">long</span> <span class="n">dailyStorage</span> <span class="o">=</span> <span class="n">calculateDailyStorage</span><span class="o">(</span>
            <span class="n">eventsPerSecond</span><span class="o">,</span> 
            <span class="n">avgEventSize</span><span class="o">,</span> 
            <span class="n">replicationFactor</span>
        <span class="o">);</span>
        
        <span class="c1">// Calculate network requirements</span>
        <span class="kt">long</span> <span class="n">networkBandwidth</span> <span class="o">=</span> <span class="n">calculateNetworkBandwidth</span><span class="o">(</span>
            <span class="n">eventsPerSecond</span><span class="o">,</span> 
            <span class="n">avgEventSize</span><span class="o">,</span> 
            <span class="n">replicationFactor</span>
        <span class="o">);</span>
        
        <span class="k">return</span> <span class="k">new</span> <span class="nf">ClusterRequirements</span><span class="o">(</span>
            <span class="n">dailyStorage</span><span class="o">,</span>
            <span class="n">networkBandwidth</span><span class="o">,</span>
            <span class="n">calculateBrokerCount</span><span class="o">(),</span>
            <span class="n">calculatePartitionCount</span><span class="o">()</span>
        <span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <h3 id="2-partition-management">2. Partition Management</h3> <h4 id="key-learnings">Key Learnings</h4> <ul> <li> <strong>Partition Count is Critical</strong> <ul> <li>Start with more partitions than needed</li> <li>Consider future growth</li> <li>Monitor partition balance</li> <li>Plan for repartitioning</li> </ul> </li> </ul> <h4 id="partition-strategy">Partition Strategy</h4> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">PartitionManager</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">calculateOptimalPartitions</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// Formula: (throughput * latency) / batch_size</span>
        <span class="kt">long</span> <span class="n">throughput</span> <span class="o">=</span> <span class="mi">2_500_000</span><span class="o">;</span> <span class="c1">// events per second</span>
        <span class="kt">long</span> <span class="n">latencyMs</span> <span class="o">=</span> <span class="mi">100</span><span class="o">;</span> <span class="c1">// desired latency in ms</span>
        <span class="kt">int</span> <span class="n">batchSize</span> <span class="o">=</span> <span class="mi">10000</span><span class="o">;</span> <span class="c1">// events per batch</span>
        
        <span class="kt">int</span> <span class="n">minPartitions</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="nc">Math</span><span class="o">.</span><span class="na">ceil</span><span class="o">(</span>
            <span class="o">(</span><span class="n">throughput</span> <span class="o">*</span> <span class="n">latencyMs</span><span class="o">)</span> <span class="o">/</span> 
            <span class="o">(</span><span class="n">batchSize</span> <span class="o">*</span> <span class="mi">1000</span><span class="o">)</span>
        <span class="o">);</span>
        
        <span class="c1">// Add 50% headroom</span>
        <span class="k">return</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="o">(</span><span class="n">minPartitions</span> <span class="o">*</span> <span class="mf">1.5</span><span class="o">);</span>
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">monitorPartitionBalance</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">,</span> <span class="nc">Long</span><span class="o">&gt;</span> <span class="n">partitionSizes</span> <span class="o">=</span> <span class="n">getPartitionSizes</span><span class="o">();</span>
        <span class="kt">double</span> <span class="n">avgSize</span> <span class="o">=</span> <span class="n">calculateAverageSize</span><span class="o">(</span><span class="n">partitionSizes</span><span class="o">);</span>
        <span class="kt">double</span> <span class="n">threshold</span> <span class="o">=</span> <span class="mf">0.2</span><span class="o">;</span> <span class="c1">// 20% deviation threshold</span>
        
        <span class="k">for</span> <span class="o">(</span><span class="nc">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">,</span> <span class="nc">Long</span><span class="o">&gt;</span> <span class="n">entry</span> <span class="o">:</span> <span class="n">partitionSizes</span><span class="o">.</span><span class="na">entrySet</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="nc">Math</span><span class="o">.</span><span class="na">abs</span><span class="o">(</span><span class="n">entry</span><span class="o">.</span><span class="na">getValue</span><span class="o">()</span> <span class="o">-</span> <span class="n">avgSize</span><span class="o">)</span> <span class="o">/</span> <span class="n">avgSize</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">triggerRebalancing</span><span class="o">(</span><span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">());</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <h3 id="3-performance-tuning">3. Performance Tuning</h3> <h4 id="critical-areas">Critical Areas</h4> <ul> <li> <strong>Producer Optimization</strong> <ul> <li>Batch size tuning</li> <li>Compression settings</li> <li>Buffer management</li> <li>Retry strategies</li> </ul> </li> </ul> <h4 id="tuning-implementation">Tuning Implementation</h4> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">PerformanceOptimizer</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">optimizeProducer</span><span class="o">(</span><span class="nc">Properties</span> <span class="n">props</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// Start with conservative settings</span>
        <span class="n">props</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">ProducerConfig</span><span class="o">.</span><span class="na">BATCH_SIZE_CONFIG</span><span class="o">,</span> <span class="mi">16384</span><span class="o">);</span> <span class="c1">// 16KB</span>
        
        <span class="c1">// Monitor and adjust</span>
        <span class="k">while</span> <span class="o">(</span><span class="n">monitoring</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">MetricSnapshot</span> <span class="n">snapshot</span> <span class="o">=</span> <span class="n">collectMetrics</span><span class="o">();</span>
            
            <span class="k">if</span> <span class="o">(</span><span class="n">snapshot</span><span class="o">.</span><span class="na">getBatchFillRatio</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mf">0.9</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">// Increase batch size</span>
                <span class="n">increaseBatchSize</span><span class="o">(</span><span class="n">props</span><span class="o">);</span>
            <span class="o">}</span>
            
            <span class="k">if</span> <span class="o">(</span><span class="n">snapshot</span><span class="o">.</span><span class="na">getLatency</span><span class="o">()</span> <span class="o">&gt;</span> <span class="n">targetLatency</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">// Adjust linger time</span>
                <span class="n">adjustLingerTime</span><span class="o">(</span><span class="n">props</span><span class="o">);</span>
            <span class="o">}</span>
            
            <span class="c1">// Document changes</span>
            <span class="n">logConfigChanges</span><span class="o">(</span><span class="n">props</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
    
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">increaseBatchSize</span><span class="o">(</span><span class="nc">Properties</span> <span class="n">props</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">currentSize</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Integer</span><span class="o">)</span> <span class="n">props</span><span class="o">.</span><span class="na">get</span><span class="o">(</span>
            <span class="nc">ProducerConfig</span><span class="o">.</span><span class="na">BATCH_SIZE_CONFIG</span>
        <span class="o">);</span>
        <span class="kt">int</span> <span class="n">newSize</span> <span class="o">=</span> <span class="nc">Math</span><span class="o">.</span><span class="na">min</span><span class="o">(</span><span class="n">currentSize</span> <span class="o">*</span> <span class="mi">2</span><span class="o">,</span> <span class="n">maxBatchSize</span><span class="o">);</span>
        <span class="n">props</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="nc">ProducerConfig</span><span class="o">.</span><span class="na">BATCH_SIZE_CONFIG</span><span class="o">,</span> <span class="n">newSize</span><span class="o">);</span>
        
        <span class="c1">// Log change</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"Increased batch size to: {}"</span><span class="o">,</span> <span class="n">newSize</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <h3 id="4-monitoring-and-alerting">4. Monitoring and Alerting</h3> <h4 id="key-metrics-1">Key Metrics</h4> <ul> <li> <strong>Essential Measurements</strong> <ul> <li>End-to-end latency</li> <li>Throughput rates</li> <li>Error rates</li> <li>Resource utilization</li> </ul> </li> </ul> <h4 id="monitoring-setup">Monitoring Setup</h4> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">KafkaMonitoringSystem</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setupMonitoring</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// Producer metrics</span>
        <span class="n">registerProducerMetrics</span><span class="o">();</span>
        <span class="c1">// Consumer metrics</span>
        <span class="n">registerConsumerMetrics</span><span class="o">();</span>
        <span class="c1">// Broker metrics</span>
        <span class="n">registerBrokerMetrics</span><span class="o">();</span>
        <span class="c1">// Topic metrics</span>
        <span class="n">registerTopicMetrics</span><span class="o">();</span>
        
        <span class="c1">// Setup alerting</span>
        <span class="n">setupAlerts</span><span class="o">();</span>
    <span class="o">}</span>
    
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">registerProducerMetrics</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">metrics</span><span class="o">.</span><span class="na">gauge</span><span class="o">(</span><span class="s">"kafka.producer.send.rate"</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span>
            <span class="n">producerClient</span><span class="o">.</span><span class="na">metrics</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="s">"record-send-rate"</span><span class="o">));</span>
            
        <span class="n">metrics</span><span class="o">.</span><span class="na">gauge</span><span class="o">(</span><span class="s">"kafka.producer.error.rate"</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span>
            <span class="n">producerClient</span><span class="o">.</span><span class="na">metrics</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="s">"record-error-rate"</span><span class="o">));</span>
            
        <span class="n">metrics</span><span class="o">.</span><span class="na">gauge</span><span class="o">(</span><span class="s">"kafka.producer.batch.size"</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span>
            <span class="n">producerClient</span><span class="o">.</span><span class="na">metrics</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="s">"batch-size-avg"</span><span class="o">));</span>
    <span class="o">}</span>
    
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">setupAlerts</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// Critical alerts</span>
        <span class="n">alertManager</span><span class="o">.</span><span class="na">addRule</span><span class="o">(</span>
            <span class="s">"high_error_rate"</span><span class="o">,</span>
            <span class="n">metric</span> <span class="o">-&gt;</span> <span class="n">metric</span><span class="o">.</span><span class="na">getErrorRate</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mf">0.001</span><span class="o">,</span>
            <span class="nc">AlertSeverity</span><span class="o">.</span><span class="na">CRITICAL</span>
        <span class="o">);</span>
        
        <span class="c1">// Warning alerts</span>
        <span class="n">alertManager</span><span class="o">.</span><span class="na">addRule</span><span class="o">(</span>
            <span class="s">"increasing_latency"</span><span class="o">,</span>
            <span class="n">metric</span> <span class="o">-&gt;</span> <span class="n">metric</span><span class="o">.</span><span class="na">getLatency</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="o">,</span>
            <span class="nc">AlertSeverity</span><span class="o">.</span><span class="na">WARNING</span>
        <span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <h3 id="5-failure-handling">5. Failure Handling</h3> <h4 id="recovery-strategies">Recovery Strategies</h4> <ul> <li> <strong>Automated Recovery</strong> <ul> <li>Broker failures</li> <li>Network partitions</li> <li>Consumer failures</li> <li>Producer failures</li> </ul> </li> </ul> <h4 id="implementation-pattern">Implementation Pattern</h4> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">FailureHandler</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handleBrokerFailure</span><span class="o">(</span><span class="nc">String</span> <span class="n">brokerId</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// Step 1: Detect failure</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">isBrokerAlive</span><span class="o">(</span><span class="n">brokerId</span><span class="o">))</span> <span class="o">{</span>
            <span class="c1">// Step 2: Initiate recovery</span>
            <span class="n">startRecoveryProcess</span><span class="o">(</span><span class="n">brokerId</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
    
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">startRecoveryProcess</span><span class="o">(</span><span class="nc">String</span> <span class="n">brokerId</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 1. Reassign partitions</span>
        <span class="n">reassignPartitions</span><span class="o">(</span><span class="n">brokerId</span><span class="o">);</span>
        
        <span class="c1">// 2. Update metadata</span>
        <span class="n">updateMetadata</span><span class="o">();</span>
        
        <span class="c1">// 3. Verify recovery</span>
        <span class="n">verifyRecovery</span><span class="o">(</span><span class="n">brokerId</span><span class="o">);</span>
        
        <span class="c1">// 4. Document incident</span>
        <span class="n">documentFailure</span><span class="o">(</span><span class="n">brokerId</span><span class="o">);</span>
    <span class="o">}</span>
    
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">reassignPartitions</span><span class="o">(</span><span class="nc">String</span> <span class="n">brokerId</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">TopicPartition</span><span class="o">&gt;</span> <span class="n">affectedPartitions</span> <span class="o">=</span> 
            <span class="n">getAffectedPartitions</span><span class="o">(</span><span class="n">brokerId</span><span class="o">);</span>
            
        <span class="k">for</span> <span class="o">(</span><span class="nc">TopicPartition</span> <span class="n">partition</span> <span class="o">:</span> <span class="n">affectedPartitions</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">assignToNewBroker</span><span class="o">(</span><span class="n">partition</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <h3 id="6-operational-procedures">6. Operational Procedures</h3> <h4 id="best-practices">Best Practices</h4> <ul> <li> <strong>Regular Maintenance</strong> <ul> <li>Scheduled updates</li> <li>Performance testing</li> <li>Capacity reviews</li> <li>Configuration audits</li> </ul> </li> </ul> <h4 id="operations-guide">Operations Guide</h4> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">OperationsManager</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">scheduleMaintenance</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// Weekly tasks</span>
        <span class="n">schedule</span><span class="o">(</span><span class="nc">Duration</span><span class="o">.</span><span class="na">ofDays</span><span class="o">(</span><span class="mi">7</span><span class="o">),</span> <span class="k">this</span><span class="o">::</span><span class="n">performHealthCheck</span><span class="o">);</span>
        
        <span class="c1">// Monthly tasks</span>
        <span class="n">schedule</span><span class="o">(</span><span class="nc">Duration</span><span class="o">.</span><span class="na">ofDays</span><span class="o">(</span><span class="mi">30</span><span class="o">),</span> <span class="k">this</span><span class="o">::</span><span class="n">performCapacityReview</span><span class="o">);</span>
        
        <span class="c1">// Quarterly tasks</span>
        <span class="n">schedule</span><span class="o">(</span><span class="nc">Duration</span><span class="o">.</span><span class="na">ofDays</span><span class="o">(</span><span class="mi">90</span><span class="o">),</span> <span class="k">this</span><span class="o">::</span><span class="n">performConfigAudit</span><span class="o">);</span>
    <span class="o">}</span>
    
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">performHealthCheck</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// Check broker health</span>
        <span class="n">checkBrokerHealth</span><span class="o">();</span>
        
        <span class="c1">// Verify replication</span>
        <span class="n">verifyReplication</span><span class="o">();</span>
        
        <span class="c1">// Check consumer lag</span>
        <span class="n">checkConsumerLag</span><span class="o">();</span>
        
        <span class="c1">// Generate report</span>
        <span class="n">generateHealthReport</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <h3 id="7-cost-optimization">7. Cost Optimization</h3> <h4 id="strategies">Strategies</h4> <ul> <li> <strong>Resource Optimization</strong> <ul> <li>Right-sizing instances</li> <li>Storage optimization</li> <li>Network utilization</li> <li>Retention policies</li> </ul> </li> </ul> <h4 id="implementation">Implementation</h4> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CostOptimizer</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">optimizeResources</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// Analyze usage patterns</span>
        <span class="nc">UsagePatterns</span> <span class="n">patterns</span> <span class="o">=</span> <span class="n">analyzeUsage</span><span class="o">();</span>
        
        <span class="c1">// Optimize retention</span>
        <span class="n">optimizeRetention</span><span class="o">(</span><span class="n">patterns</span><span class="o">);</span>
        
        <span class="c1">// Adjust resources</span>
        <span class="n">adjustResources</span><span class="o">(</span><span class="n">patterns</span><span class="o">);</span>
        
        <span class="c1">// Report savings</span>
        <span class="n">reportCostSavings</span><span class="o">();</span>
    <span class="o">}</span>
    
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">optimizeRetention</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">RetentionPolicy</span><span class="o">&gt;</span> <span class="n">policies</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>
        
        <span class="c1">// Hot data</span>
        <span class="n">policies</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"recent_events"</span><span class="o">,</span> 
            <span class="k">new</span> <span class="nf">RetentionPolicy</span><span class="o">(</span><span class="nc">Duration</span><span class="o">.</span><span class="na">ofDays</span><span class="o">(</span><span class="mi">7</span><span class="o">)));</span>
        
        <span class="c1">// Warm data</span>
        <span class="n">policies</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"processed_events"</span><span class="o">,</span> 
            <span class="k">new</span> <span class="nf">RetentionPolicy</span><span class="o">(</span><span class="nc">Duration</span><span class="o">.</span><span class="na">ofDays</span><span class="o">(</span><span class="mi">30</span><span class="o">)));</span>
        
        <span class="c1">// Cold data</span>
        <span class="n">policies</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"archived_events"</span><span class="o">,</span> 
            <span class="k">new</span> <span class="nf">RetentionPolicy</span><span class="o">(</span><span class="nc">Duration</span><span class="o">.</span><span class="na">ofDays</span><span class="o">(</span><span class="mi">90</span><span class="o">)));</span>
        
        <span class="n">applyRetentionPolicies</span><span class="o">(</span><span class="n">policies</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>These lessons and patterns have been crucial in maintaining our high-throughput Kafka cluster. They continue to evolve as we learn more and face new challenges at scale.</p> <p>In Part 5, we’ll explore how we built our DPI data processing pipeline to handle 350GB of data every 15 minutes while maintaining system performance and reliability.</p> </div> </article> <br> <hr> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <ul class="related-articles-list"> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/ai-deception/">AI Meta-Cognition - The Observer Effect Series</a> </li> </ul> <ul class="related-articles-list"> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/building-safer-ai-industry-response-practical-solutions/">Building Safer AI: Industry Response and the Path Forward - (Part 4/4)</a> </li> </ul> <ul class="related-articles-list"> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/alignment-faking-ai-pretends-to-change-values/">Alignment Faking: When AI Pretends to Change - (Part 3/4)</a> </li> </ul> <ul class="related-articles-list"> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/deliberative-alignment-training-ai-not-to-scheme/">Deliberative Alignment: Can We Train AI Not to Scheme? - (Part 2/4)</a> </li> </ul> <ul class="related-articles-list"> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/ai-observer-effect-models-recognize-evaluation/">The Observer Effect in AI: When Models Know They're Being Tested - (Part 1/4)</a> </li> </ul> <br> <div class="newsletter-form-container newsletter-signup"> <p class="newsletter-title">Strategic Insights for Technology Leaders</p> <p>Join my newsletter for exclusive content on leveraging Data, AI, and Cloud to drive digital transformation and achieve breakthrough business results. Stay informed on the latest trends, strategies, and best practices for leading in the age of intelligent systems.</p> <p><a href="/archive/" target="_blank">Read the Blog Archive in the meantime</a></p> <form class="newsletter-form" action="https://app.loops.so/api/newsletter-form/cm614n2d604nlfy1lfo7vgmo5" method="POST" style="justify-content: center"> <input class="newsletter-form-input" name="newsletter-form-input" type="email" placeholder="user@example.com" required=""> <button type="submit" class="newsletter-form-button" style="justify-content: center"> subscribe </button> <button type="button" class="newsletter-loading-button" style="justify-content: center"> Please wait... </button> </form> <div class="newsletter-success" style="justify-content: center"> <p class="newsletter-success-message">You're going to love this! Thanks for subscribing.</p> </div> <div class="newsletter-error" style="justify-content: center"> <p class="newsletter-error-message">Oops! Something went wrong, please try again</p> </div> <button class="newsletter-back-button" type="button" onmouseout='this.style.textDecoration="none"' onmouseover='this.style.textDecoration="underline"'> ← Back </button> </div> <noscript> <style>.newsletter-form-container{display:none}</style> </noscript> <div id="giscus_thread" style="max-width: 1140px; margin: 0 auto;"> <script>
      let giscusTheme = determineComputedTheme();
      let giscusAttributes = {
        src: 'https://giscus.app/client.js',
        'data-repo': 'bassrehab/bassrehab.github.io',
        'data-repo-id': 'R_kgDOLvY8Tg',
        'data-category': 'Comments',
        'data-category-id': 'DIC_kwDOLvY8Ts4CexzE',
        'data-mapping': 'title',
        'data-strict': '0',
        'data-reactions-enabled': '1',
        'data-emit-metadata': '0',
        'data-input-position': 'bottom',
        'data-theme': giscusTheme,
        'data-lang': 'en',
        crossorigin: 'anonymous',
        async: '',
      };

      let giscusScript = document.createElement('script');
      Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value));
      document.getElementById('giscus_thread').appendChild(giscusScript);
    </script> <noscript>Please enable JavaScript to view the <a href="http://giscus.app/?ref_noscript" rel="external nofollow noopener" target="_blank">comments powered by giscus.</a> </noscript> </div> </div> </div> </div> </div> <footer class="modern-footer" role="contentinfo"> <div class="footer-container"> <div class="footer-grid"> <div class="footer-brand"> <h3>Subhadip Mitra</h3> <p> Technical Leader, Inventor, and Researcher building the future of Data &amp; Applied AI. Leading Google Cloud's practice across Southeast Asia. </p> </div> <div class="footer-section"> <h4>Explore</h4> <ul class="footer-links"> <li><a href="/">About</a></li> <li><a href="/now/">What I'm Doing Now</a></li> <li><a href="/blog/">Blog</a></li> <li><a href="/publications/">Publications</a></li> <li><a href="/repositories/">Repositories</a></li> </ul> </div> <div class="footer-section"> <h4>Connect</h4> <ul class="footer-links"> <li><a href="mailto:contact@subhadipmitra.com">Email</a></li> <li><a href="https://calendly.com/subhadipmitra" target="_blank" rel="external nofollow noopener">Schedule a Call</a></li> <li><a href="https://linkedin.com/in/subhadip-mitra" target="_blank" rel="external nofollow noopener">LinkedIn</a></li> <li><a href="https://github.com/bassrehab" target="_blank" rel="external nofollow noopener">GitHub</a></li> </ul> </div> </div> <div class="footer-bottom"> <div class="footer-copyright"> © 2025 Subhadip Mitra. Some Rights Reserved. Last updated: October 15, 2025. </div> <div class="footer-social"> <a href="https://linkedin.com/in/subhadip-mitra" target="_blank" aria-label="LinkedIn" rel="external nofollow noopener"> <i class="fab fa-linkedin-in"></i> </a> <a href="https://github.com/bassrehab" target="_blank" aria-label="GitHub" rel="external nofollow noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/bassrehab" target="_blank" aria-label="Twitter" rel="external nofollow noopener"> <i class="fab fa-twitter"></i> </a> <a href="mailto:contact@subhadipmitra.com" aria-label="Email"> <i class="fas fa-envelope"></i> </a> </div> </div> </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js?a0db7e5d5c70cc3252b3138b0c91dcaf" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script defer src="/assets/js/bootstrap-toc.min.js?c82ff4de8b0955d6ff14f5b05eed7eb6"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?a5bb4e6a542c546dd929b24b8b236dfd"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-TW7YQ5XPC6"></script> <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
      dataLayer.push(arguments);
    }
    gtag('js', new Date());

    gtag('config', 'G-TW7YQ5XPC6');
  </script> <script defer src="/assets/js/google-analytics-setup.js?12374742c4b1801ba82226e617af7e2d"></script> <script defer src="/assets/js/progress-bar.js?2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> <script type="module" src="/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script src="/assets/js/search-setup.js?6c304f7b1992d4b60f7a07956e52f04a"></script> <script src="/assets/js/search-data.js"></script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> <script defer src="/assets/js/newsletter.js?c3d0931971ee96e9df74ba70526c3130"></script> </body> </html>