<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta name="google-site-verification" content="R3nPzqP9nO2aTgysGUiU3t-pw3wi1xuUuKVaMrimuck"> <meta name="msvalidate.01" content="04fec5e0d64b1c9bc788e98f81ee2a78"> <meta http-equiv="Permissions-Policy" content="interest-cohort=()"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Introducing OConsent — Open Consent Protocol | subhadip mitra </title> <meta name="author" content="Subhadip Mitra"> <meta name="description" content="OConsent is a blockchain-based platform that enables transparent processing of personal data, empowering users and data controllers to manage consent and privacy."> <meta name="keywords" content="subhadip, subhadip mitra, subhadeep mitra, subhadip google, google, dikku, personal website, Data Analytics, Quantum Computing, Distributed Systems, Blockchain, Artificial Intelligence, Big Data, ETL Processes, Data Management, Open Source Projects, Technology Blogging, Software Engineering Insights, Data &amp; Analytics Trends, Personal Technology Musings, Approximate Calculations, Quantum Data Management, Real-Time Data Processing, Data Platform Innovations, Cloud Technologies, Machine Learning Models, Technology Consulting"> <meta property="og:site_name" content="subhadip mitra"> <meta property="og:type" content="article"> <meta property="og:title" content="subhadip mitra | Introducing OConsent — Open Consent Protocol"> <meta property="og:url" content="https://subhadipmitra.com/blog/2020/introducing-oconsent-open-consent-protocol/"> <meta property="og:description" content="OConsent is a blockchain-based platform that enables transparent processing of personal data, empowering users and data controllers to manage consent and privacy."> <meta property="og:image" content="/assets/img/social_preview.png"> <meta property="og:locale" content="en"> <meta name="twitter:card" content="summary"> <meta name="twitter:title" content="Introducing OConsent — Open Consent Protocol"> <meta name="twitter:description" content="OConsent is a blockchain-based platform that enables transparent processing of personal data, empowering users and data controllers to manage consent and privacy."> <meta name="twitter:image" content="/assets/img/social_preview.png"> <meta name="twitter:site" content="@bassrehab"> <meta name="twitter:creator" content="@bassrehab"> <script type="application/ld+json">
    {
        "author":
        {
            "@type": "Person",
            "name": "Subhadip Mitra"
        },
        "url": "https://subhadipmitra.com/blog/2020/introducing-oconsent-open-consent-protocol/",
        "@type": "BlogPosting",
        "description": "OConsent is a blockchain-based platform that enables transparent processing of personal data, empowering users and data controllers to manage consent and privacy.",
        "headline": "Introducing OConsent — Open Consent Protocol",
        
        "sameAs": ["https://orcid.org/0000-0002-3977-7402", "https://www.researchgate.net/profile/Subhadip-Mitra-3", "https://github.com/bassrehab", "https://www.linkedin.com/in/subhadip-mitra", "https://twitter.com/bassrehab"],
        
        "name": "Subhadip Mitra",
        "@context": "https://schema.org"
    }
  </script> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link defer href="/assets/css/bootstrap-toc.min.css?6f5af0bb9aab25d79b2448143cbeaa88" rel="stylesheet"> <link rel="shortcut icon" href="/assets/img/favicon.png?058310854f7b3c920f894a1d42c3c47b"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://subhadipmitra.com/blog/2020/introducing-oconsent-open-consent-protocol/"> <script src="/assets/js/theme.js?a5ca4084d3b81624bcfa01156dae2b8e"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>initTheme();</script> </head> <body class="fixed-top-nav sticky-bottom-footer"> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> subhadip mitra </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv </a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">more </a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item " href="/search/">search</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/contact/">contact</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/license/">licenses</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/privacy/">privacy</a> </div> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="row"> <div class="col-sm-3"> <nav id="toc-sidebar" class="sticky-top"></nav> </div> <div class="col-sm-9"> <div class="post"> <header class="post-header"> <h1 class="post-title">Introducing OConsent — Open Consent Protocol</h1> <p class="post-meta"> December 10, 2020 </p> <p class="post-tags"> <a href="/blog/2020"> <i class="fa-solid fa-calendar fa-sm"></i> 2020 </a>   ·   <a href="/blog/tag/system-design"> <i class="fa-solid fa-hashtag fa-sm"></i> system-design</a>   <a href="/blog/tag/privacy"> <i class="fa-solid fa-hashtag fa-sm"></i> privacy</a>   <a href="/blog/tag/consent-management"> <i class="fa-solid fa-hashtag fa-sm"></i> consent-management</a>   <a href="/blog/tag/blockchain"> <i class="fa-solid fa-hashtag fa-sm"></i> blockchain</a>   <a href="/blog/tag/cryptography"> <i class="fa-solid fa-hashtag fa-sm"></i> cryptography</a>     ·   <a href="/blog/category/system-design"> <i class="fa-solid fa-tag fa-sm"></i> system-design</a>   <a href="/blog/category/platform"> <i class="fa-solid fa-tag fa-sm"></i> platform</a>   <a href="/blog/category/cryptography"> <i class="fa-solid fa-tag fa-sm"></i> cryptography</a>   <a href="/blog/category/blockchain"> <i class="fa-solid fa-tag fa-sm"></i> blockchain</a>   </p> </header> <article class="post-content"> <div id="markdown-content"> <p>In the current connected world — Websites, Mobile Apps, IoT Devices collect a large volume of users’ personally identifiable activity data. These collected data is used for varied purposes of analytics, marketing, personalisation of services, etc. Data is assimilated through site cookies, tracking device IDs, embedded JavaScripts, Pixels, etc. to name a few. Many of these tracking and usage of collected data happens behind the scene and is not apparent to an average user. Consequently, many Countries and Regions have formulated legislations (e.g. GDPR, EU) — that allow users to be able to control their personal data, be informed and consent to its processing in an comprehensible and user-friendly manner.</p> <p>Over the last few months I have been working on designing — OConsent — that proposes a protocol and a platform based on Blockchain Technology that enables the transparent processing of personal data throughout its lifecycle from capture, lineage to redaction. The solution intends to help service multiple stakeholders from individual end-users to Data Controllers and Privacy Officers. It intends to offer a holistic and unambiguous view of how and when the data points are captured, accessed and processed. The framework also envisages how different access control policies might be created and enforced through a public blockchain including real time alerts for privacy data breach.</p> <p>In the rest of the blog post, I will take you through the core concepts of OConsent, its working and sample snippets.</p> <p><br></p> <h1 id="oconsent-preview">OConsent Preview</h1> <p><br></p> <p>Following are the key steps of the Open Consent creation -</p> <ol> <li> <p><strong>Agreement Seed Creation</strong>:</p> <ul> <li>A unique identifier (UUID v4) is generated, referred to as the “Agreement Seed.”</li> <li>The Data Controller signs this seed with their private key to initiate the creation of a consent agreement.</li> </ul> </li> <li> <p><strong>JSON-LD Consent Agreement</strong>:</p> <ul> <li>This step involves the creation of a JSON-LD (JavaScript Object Notation for Linked Data) formatted consent agreement.</li> <li>Both the Data Subject (the user) and the Data Controller (the service provider) sign this agreement with their respective private keys.</li> <li>The agreement includes a hash (a cryptographic representation) of its content, ensuring integrity and non-repudiation.</li> </ul> </li> <li> <p><strong>Consent Agreement Hash</strong>:</p> <ul> <li>This is essentially a confirmation step where the hash of the signed agreement is combined with a timestamp hash provided by a Time Stamping Authority, which also signs it with its private key.</li> <li>This ensures the agreement is not only signed but also timestamped to establish exactly when the consent was recorded.</li> </ul> </li> <li> <p><strong>JSON-LD Consent Proof</strong>:</p> <ul> <li>The signed and timestamped hash of the consent agreement is then placed into a JSON-LD structured proof.</li> <li>This proof contains the agreement hash and the timestamp hash, ready for the next step.</li> </ul> </li> <li> <p><strong>Embedding in Blockchain</strong>:</p> <ul> <li>The JSON-LD Consent Proof is ready to be embedded into a local blockchain system.</li> <li>Additionally, it’s “fingerprinted” on a global blockchain, ensuring it can be verified independently anywhere in the world.</li> </ul> </li> <li> <p><strong>Public Key Verification</strong>:</p> <ul> <li>The final step involves storing the public keys of both the Data Subject and the Data Controller on the platform.</li> <li>These keys can be used to verify the signatures on the consent agreement, ensuring that the stakeholders who signed the documents are indeed who they claim to be.</li> </ul> </li> </ol> <p>This process enhances the security and transparency of data consent agreements, leveraging blockchain’s decentralized and immutable characteristics to protect user data and ensure compliance with data privacy laws.</p> <p><br></p> <h2 id="illustrative-programs">Illustrative Programs</h2> <h3 id="python-program-to-generate-json-ld-consent-proof">Python Program to Generate JSON-LD Consent Proof</h3> <p>The below program will generate a consent agreement, sign it with private keys from both the Data Controller and the Data Subject, and then timestamp it using a simulated Time Stamping Authority (NIST in this scenario).</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">cryptography.hazmat.primitives</span> <span class="kn">import</span> <span class="n">hashes</span>
<span class="kn">from</span> <span class="n">cryptography.hazmat.primitives.asymmetric</span> <span class="kn">import</span> <span class="n">padding</span><span class="p">,</span> <span class="n">rsa</span>
<span class="kn">from</span> <span class="n">cryptography.hazmat.primitives.serialization</span> <span class="kn">import</span> <span class="n">Encoding</span><span class="p">,</span> <span class="n">PublicFormat</span>
<span class="kn">import</span> <span class="n">json</span>
<span class="kn">import</span> <span class="n">uuid</span>
<span class="kn">from</span> <span class="n">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="k">class</span> <span class="nc">ConsentProofGenerator</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="c1"># Initialize keys for Data Controller, Data Subject, and Time Stamping Authority (Step 1)
</span>        <span class="n">self</span><span class="p">.</span><span class="n">dc_private_key</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">dc_public_key</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">generate_keys</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">ds_private_key</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">ds_public_key</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">generate_keys</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">tsa_private_key</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">tsa_public_key</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">generate_keys</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">generate_keys</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s"> Generate RSA public and private keys (Step 1) </span><span class="sh">"""</span>
        <span class="n">private_key</span> <span class="o">=</span> <span class="n">rsa</span><span class="p">.</span><span class="nf">generate_private_key</span><span class="p">(</span>
            <span class="n">public_exponent</span><span class="o">=</span><span class="mi">65537</span><span class="p">,</span>
            <span class="n">key_size</span><span class="o">=</span><span class="mi">2048</span>
        <span class="p">)</span>
        <span class="n">public_key</span> <span class="o">=</span> <span class="n">private_key</span><span class="p">.</span><span class="nf">public_key</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">private_key</span><span class="p">,</span> <span class="n">public_key</span>

    <span class="k">def</span> <span class="nf">sign_data</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">private_key</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s"> Sign the data using the private key (Step 3) </span><span class="sh">"""</span>
        <span class="n">signature</span> <span class="o">=</span> <span class="n">private_key</span><span class="p">.</span><span class="nf">sign</span><span class="p">(</span>
            <span class="n">data</span><span class="p">.</span><span class="nf">encode</span><span class="p">(),</span>
            <span class="n">padding</span><span class="p">.</span><span class="nc">PSS</span><span class="p">(</span>
                <span class="n">mgf</span><span class="o">=</span><span class="n">padding</span><span class="p">.</span><span class="nc">MGF1</span><span class="p">(</span><span class="n">hashes</span><span class="p">.</span><span class="nc">SHA256</span><span class="p">()),</span>
                <span class="n">salt_length</span><span class="o">=</span><span class="n">padding</span><span class="p">.</span><span class="n">PSS</span><span class="p">.</span><span class="n">MAX_LENGTH</span>
            <span class="p">),</span>
            <span class="n">hashes</span><span class="p">.</span><span class="nc">SHA256</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">signature</span><span class="p">.</span><span class="nf">hex</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">generate_hash</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s"> Generate SHA-256 hash of the data (Step 4) </span><span class="sh">"""</span>
        <span class="n">digest</span> <span class="o">=</span> <span class="n">hashes</span><span class="p">.</span><span class="nc">Hash</span><span class="p">(</span><span class="n">hashes</span><span class="p">.</span><span class="nc">SHA256</span><span class="p">())</span>
        <span class="n">digest</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="nf">encode</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">digest</span><span class="p">.</span><span class="nf">finalize</span><span class="p">().</span><span class="nf">hex</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">generate_monetization_scope</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s"> Generate sample monetization scope based on assumed AWS S3 data storage (Monetization Scope) </span><span class="sh">"""</span>
        <span class="n">s3_uri</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">generate_s3_uri</span><span class="p">(</span><span class="sh">"</span><span class="s">data-analytics</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">datasets/ml-training-data.csv</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">storage</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">AWS S3</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">data_usage</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="sh">"</span><span class="s">Data analysis</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Machine learning model training</span><span class="sh">"</span><span class="p">],</span>
            <span class="sh">"</span><span class="s">s3_uri</span><span class="sh">"</span><span class="p">:</span> <span class="n">s3_uri</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">generate_s3_uri</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">bucket_name</span><span class="p">,</span> <span class="n">file_path</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s"> Generate an S3 URI for the specified bucket and file path (Monetization Scope) </span><span class="sh">"""</span>
        <span class="k">return</span> <span class="sa">f</span><span class="sh">"</span><span class="s">s3://</span><span class="si">{</span><span class="n">bucket_name</span><span class="si">}</span><span class="s">/</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="sh">"</span>

    <span class="k">def</span> <span class="nf">create_consent_proof</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s"> Generate the JSON-LD Consent Proof including all cryptographic signatures and hashes (Step 5 and 6) </span><span class="sh">"""</span>
        <span class="n">consent_agreement</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">({</span>
            <span class="sh">"</span><span class="s">agreement_seed</span><span class="sh">"</span><span class="p">:</span> <span class="nf">str</span><span class="p">(</span><span class="n">uuid</span><span class="p">.</span><span class="nf">uuid4</span><span class="p">()),</span>  <span class="c1"># Agreement Seed creation (Step 2)
</span>            <span class="sh">"</span><span class="s">data</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Example data content stored in AWS S3</span><span class="sh">"</span>
        <span class="p">},</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

        <span class="c1"># Signatures by Data Controller and Data Subject (Step 3)
</span>        <span class="n">dc_signature</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">sign_data</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">dc_private_key</span><span class="p">,</span> <span class="n">consent_agreement</span><span class="p">)</span>
        <span class="n">ds_signature</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">sign_data</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">ds_private_key</span><span class="p">,</span> <span class="n">consent_agreement</span><span class="p">)</span>

        <span class="c1"># Hash and timestamp (Step 4 and 5)
</span>        <span class="n">consent_agreement_hash</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">generate_hash</span><span class="p">(</span><span class="n">consent_agreement</span> <span class="o">+</span> <span class="n">dc_signature</span> <span class="o">+</span> <span class="n">ds_signature</span><span class="p">)</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">isoformat</span><span class="p">()</span>
        <span class="n">timestamped_data</span> <span class="o">=</span> <span class="n">consent_agreement_hash</span> <span class="o">+</span> <span class="n">timestamp</span>
        <span class="n">timestamp_hash</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">generate_hash</span><span class="p">(</span><span class="n">timestamped_data</span><span class="p">)</span>
        <span class="n">signed_timestamp</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">sign_data</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">tsa_private_key</span><span class="p">,</span> <span class="n">timestamped_data</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">({</span>
            <span class="sh">"</span><span class="s">@context</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">https://w3id.org/oconsent/v1</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">type</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">OConsent - Open Consent Agreement</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">agreement_hash_id</span><span class="sh">"</span><span class="p">:</span> <span class="n">consent_agreement_hash</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">agreement_version</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">1.01</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">linked_agreement_hash_id</span><span class="sh">"</span><span class="p">:</span> <span class="n">uuid</span><span class="p">.</span><span class="nf">uuid4</span><span class="p">().</span><span class="nb">hex</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">metadata</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span>
                <span class="sh">"</span><span class="s">data_subject</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span>
                    <span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Mr. XYZ</span><span class="sh">"</span><span class="p">,</span>
                    <span class="sh">"</span><span class="s">id</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">7a2a83b1694940f38d6a2a8f50e4d979</span><span class="sh">"</span>
                <span class="p">},</span>
                <span class="sh">"</span><span class="s">data_controller</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span>
                    <span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">ABC LLC.</span><span class="sh">"</span><span class="p">,</span>
                    <span class="sh">"</span><span class="s">id</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">478ecb5f2b674ad18976007d64c069de</span><span class="sh">"</span>
                <span class="p">},</span>
                <span class="sh">"</span><span class="s">agreement_date</span><span class="sh">"</span><span class="p">:</span> <span class="n">timestamp</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">is_transferable</span><span class="sh">"</span><span class="p">:</span> <span class="bp">False</span>
            <span class="p">},</span>
            <span class="sh">"</span><span class="s">consent_scope</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="sh">"</span><span class="s">marketing</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span>
                        <span class="sh">"</span><span class="s">data_attributes</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="sh">"</span><span class="s">datasetA:attr1</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">datasetB:attr2</span><span class="sh">"</span><span class="p">],</span>
                        <span class="sh">"</span><span class="s">expiry</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">01/12/2020</span><span class="sh">"</span>
                    <span class="p">},</span>
                    <span class="sh">"</span><span class="s">analytics</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span>
                        <span class="sh">"</span><span class="s">data_attributes</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="sh">"</span><span class="s">datasetB:attr2</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">datasetZ:attr4</span><span class="sh">"</span><span class="p">],</span>
                        <span class="sh">"</span><span class="s">expiry</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">01/11/2020</span><span class="sh">"</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">],</span>
            <span class="sh">"</span><span class="s">monetization_enabled</span><span class="sh">"</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">monetization_scope</span><span class="sh">"</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">generate_monetization_scope</span><span class="p">(),</span>
            <span class="sh">"</span><span class="s">signatures</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span>
                <span class="sh">"</span><span class="s">data_controller</span><span class="sh">"</span><span class="p">:</span> <span class="n">dc_signature</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">data_subject</span><span class="sh">"</span><span class="p">:</span> <span class="n">ds_signature</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">time_stamping_authority</span><span class="sh">"</span><span class="p">:</span> <span class="n">signed_timestamp</span>
            <span class="p">},</span>
            <span class="sh">"</span><span class="s">timestamp_hash</span><span class="sh">"</span><span class="p">:</span> <span class="n">timestamp_hash</span>
        <span class="p">},</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="c1"># Example of using the class
</span><span class="n">generator</span> <span class="o">=</span> <span class="nc">ConsentProofGenerator</span><span class="p">()</span>
<span class="n">json_ld_consent_proof</span> <span class="o">=</span> <span class="n">generator</span><span class="p">.</span><span class="nf">create_consent_proof</span><span class="p">()</span>
<span class="nf">print</span><span class="p">(</span><span class="n">json_ld_consent_proof</span><span class="p">)</span>

</code></pre></div></div> <p><br></p> <h4 id="key-components-of-the-program">Key Components of the Program:</h4> <ol> <li> <strong>Key Generation</strong>: Simulates RSA key pairs for the Data Controller, Data Subject, and Time Stamping Authority.</li> <li> <strong>Signing Data</strong>: Each party signs the agreement, simulating the cryptographic assurance of the data’s integrity and origin.</li> <li> <strong>Hash Generation</strong>: For both the consent data and the timestamped data, ensuring the immutability of records.</li> <li> <strong>JSON-LD Consent Proof</strong>: This is the final output containing the hashes, signatures, and timestamp, ready to be embedded in a public blockchain.</li> </ol> <p><br></p> <h3 id="sample-json-ld-oconsent-agreement">Sample JSON-LD OConsent Agreement</h3> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"@context"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://w3id.org/oconsent/v1"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"OConsent - Open Consent Agreement"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"agreement_hash_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"b2c6209b6a8ed85b4ba4f838dde8a59d724d316c380dfbf62ed71a57ac78f6bc"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"agreement_version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.01"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"linked_agreement_hash_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"7b3784a33886431787e075416d46c965"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"metadata"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"data_subject"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Mr. XYZ"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"7a2a83b1694940f38d6a2a8f50e4d979"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"data_controller"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ABC LLC."</span><span class="p">,</span><span class="w">
      </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"478ecb5f2b674ad18976007d64c069de"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"agreement_date"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2024-05-11T15:04:58.136144"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"is_transferable"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"consent_scope"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"marketing"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"data_attributes"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"datasetA:attr1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"datasetB:attr2"</span><span class="p">],</span><span class="w">
        </span><span class="nl">"expiry"</span><span class="p">:</span><span class="w"> </span><span class="s2">"01/12/2020"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"analytics"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"data_attributes"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"datasetB:attr2"</span><span class="p">,</span><span class="w"> </span><span class="s2">"datasetZ:attr4"</span><span class="p">],</span><span class="w">
        </span><span class="nl">"expiry"</span><span class="p">:</span><span class="w"> </span><span class="s2">"01/11/2020"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"monetization_enabled"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="nl">"monetization_scope"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"storage"</span><span class="p">:</span><span class="w"> </span><span class="s2">"AWS S3"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"data_usage"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"Data analysis"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Machine learning model training"</span><span class="p">],</span><span class="w">
    </span><span class="nl">"s3_uri"</span><span class="p">:</span><span class="w"> </span><span class="s2">"s3://data-analytics/datasets/ml-training-data.csv"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"signatures"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"data_controller"</span><span class="p">:</span><span class="w"> </span><span class="s2">"753527ed1f50f0bc5af3b3fa50e9659d096dc101c336dda830f6a3c01e95ab15047a7427ece03c4dcb1edaa662eda03ca6303a4fe2d5f6bdcaf351f6bcc44943ad435773dd9e910a62c79ca2cd3ff888850a534423c5094f80c0f749cd30c3f4c04d8750d5873ab2430d2ca20557bf2ef07f8e5b5021728355bc79c20cfc462645ad14c8a149b2fd820e95979711d3798eddc083d302d5e4cb3ff88f242b12ee34864004ac23bb53b3c5792c74f3236f47c6c7c9d547aff68afa8257bafcc4d07dc2d4a081fba10cd9a9c6a4330ae56e298bcd452d148fb2f19b1fe0c678601bcccbdd174aec4a1133c777742cfdd19ee2ad6094b3036d9ccaf39974bca34a2b"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"data_subject"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5a40b16b2aa3348d23152b5145c0965ac121c8678c81afc32c6bbb2c0fa9a7f0a831ba8ca2cc2dad8cf9d83ebdfda483535eeb2ec6319d8be447e22dc486fdb124a337f9a86a6c787bbddc799cb84db4f685413e4c9046bce510c9caf57239d7ed1fc179e960f389dfdb43ce2df7261e61949244c9c4bf1c1d52a867cb56f8e06adb267922a020ce5e1e2b7ae112ed618cdbfe655e3f7f54ea673a695e8061fa9b4435eda0e60db75f6124f1b4ba3a309cc5690c5f377c7c98153b3deb1a3719390084eeebb26fbf3f321304e63f841c61bda938a3f4386ee59369f08135895660ae2079040fe909c53c3ba31e6b6e80ade7a1f2697db66f03a098272fc29d24"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"time_stamping_authority"</span><span class="p">:</span><span class="w"> </span><span class="s2">"41a2cf34861def4ea8444afaf6ff6adf1333ae4b2552a21d9d03f0a6e952a256a5ed14e86934e332683387dd19ef8cf225ce333c2a713cc6dae5ba26015b3fd9a4357e3ea9b7cb2238c5ef583ca0b787c01a094a4e9312521e5abf0f51d3008a5c5dedc306fbe5b134d8046dae8bfa95737a4f117a04064d557649820b9cbf0bc44217d3f0a889855ab8327e26e5a2ba02d5b6957298ee4779ae5b544e8adcf09669405e77092ec9e1124ec9f8e5d0e0b04f21df1f20802622da562e89d1c5c805045d637d528cbb2de020bd4c0f4c1d9cce32819c4fdfd2ae11fec04cbdd5876eb8c008f054c1706a3dd5bcaf5733e7713d80d52c8a1150f443266addaff0c6"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"timestamp_hash"</span><span class="p">:</span><span class="w"> </span><span class="s2">"679db11c126e730175257e61fb40fddd91bbfdae0166fc6d41bd1011d709bf60"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <p><br></p> <p><br></p> <h2 id="public-blockchain-embedding-example">Public Blockchain embedding example</h2> <p>Embedding data into Bitcoin and Ethereum blockchains typically involves different approaches due to the differing nature of these platforms. For Bitcoin, data can be embedded using <code class="language-plaintext highlighter-rouge">OP_RETURN</code> in a transaction, which allows a small amount of data to be stored. For Ethereum, we can use a smart contract to store more extensive data.</p> <h4 id="bitcoin-embedding-example">Bitcoin Embedding Example</h4> <p>For Bitcoin, we would use an <code class="language-plaintext highlighter-rouge">OP_RETURN</code> transaction. Following is a simplified Python example using the <code class="language-plaintext highlighter-rouge">bit</code> library to embed the hash of the <code class="language-plaintext highlighter-rouge">json_ld_consent_proof</code>:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">bit</span> <span class="kn">import</span> <span class="n">Key</span>

<span class="k">def</span> <span class="nf">embed_data_in_bitcoin</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">wif</span><span class="p">):</span>
    <span class="n">key</span> <span class="o">=</span> <span class="nc">Key</span><span class="p">(</span><span class="n">wif</span><span class="p">)</span>  <span class="c1"># Load your wallet from WIF
</span>    <span class="n">tx_hash</span> <span class="o">=</span> <span class="n">key</span><span class="p">.</span><span class="nf">send_op_return</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="nf">encode</span><span class="p">(</span><span class="sh">'</span><span class="s">utf-8</span><span class="sh">'</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">tx_hash</span>

<span class="c1"># Example usage
</span><span class="n">wif</span> <span class="o">=</span> <span class="sh">'</span><span class="s">your_wallet_import_format_key_here</span><span class="sh">'</span>  <span class="c1"># You need to replace this with your actual WIF
</span><span class="n">data</span> <span class="o">=</span> <span class="sh">'</span><span class="s">hash_of_json_ld_consent_proof</span><span class="sh">'</span>  <span class="c1"># Replace with the actual hash of your JSON data
</span><span class="n">transaction_hash</span> <span class="o">=</span> <span class="nf">embed_data_in_bitcoin</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">wif</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Transaction Hash: </span><span class="si">{</span><span class="n">transaction_hash</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div> <p><strong>Note</strong>: The <code class="language-plaintext highlighter-rouge">'your_wallet_import_format_key_here'</code> is your actual wallet import format key. Also, the <code class="language-plaintext highlighter-rouge">bit</code> library must be installed (<code class="language-plaintext highlighter-rouge">pip install bit</code>). This program sends a real transaction and would require actual Bitcoin to execute.</p> <p><br> <br></p> <h3 id="ethereum-embedding-example">Ethereum Embedding Example</h3> <p>For Ethereum, a smart contract can be used to store strings. Following is an example using <code class="language-plaintext highlighter-rouge">web3.py</code> to interact with a smart contract:</p> <pre><code class="language-solidity">// Solidity Contract Example
pragma solidity ^0.8.0;

contract DataStorage {
    string public data;

    function storeData(string memory _data) public {
        data = _data;
    }

    function getData() public view returns (string memory) {
        return data;
    }
}
</code></pre> <p>And the corresponding Python script to interact with this contract:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">web3</span> <span class="kn">import</span> <span class="n">Web3</span>

<span class="k">def</span> <span class="nf">store_data_in_ethereum</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">contract_address</span><span class="p">,</span> <span class="n">account_address</span><span class="p">,</span> <span class="n">private_key</span><span class="p">):</span>
    <span class="n">web3</span> <span class="o">=</span> <span class="nc">Web3</span><span class="p">(</span><span class="n">Web3</span><span class="p">.</span><span class="nc">HTTPProvider</span><span class="p">(</span><span class="sh">'</span><span class="s">https://your_ethereum_node_url</span><span class="sh">'</span><span class="p">))</span>  <span class="c1"># Connect to an Ethereum node
</span>    <span class="n">web3</span><span class="p">.</span><span class="n">eth</span><span class="p">.</span><span class="n">defaultAccount</span> <span class="o">=</span> <span class="n">account_address</span>  <span class="c1"># Set the default account
</span>
    <span class="c1"># Load the contract
</span>    <span class="n">abi</span> <span class="o">=</span> <span class="p">[{</span><span class="sh">"</span><span class="s">inputs</span><span class="sh">"</span><span class="p">:[{</span><span class="sh">"</span><span class="s">internalType</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">string</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">_data</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">type</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">string</span><span class="sh">"</span><span class="p">}],</span><span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">storeData</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">outputs</span><span class="sh">"</span><span class="p">:[],</span><span class="sh">"</span><span class="s">stateMutability</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">nonpayable</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">type</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">function</span><span class="sh">"</span><span class="p">},{</span><span class="sh">"</span><span class="s">inputs</span><span class="sh">"</span><span class="p">:[],</span><span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">getData</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">outputs</span><span class="sh">"</span><span class="p">:[{</span><span class="sh">"</span><span class="s">internalType</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">string</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">:</span><span class="sh">""</span><span class="p">,</span><span class="sh">"</span><span class="s">type</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">string</span><span class="sh">"</span><span class="p">}],</span><span class="sh">"</span><span class="s">stateMutability</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">view</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">type</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">function</span><span class="sh">"</span><span class="p">}]</span>
    <span class="n">contract</span> <span class="o">=</span> <span class="n">web3</span><span class="p">.</span><span class="n">eth</span><span class="p">.</span><span class="nf">contract</span><span class="p">(</span><span class="n">address</span><span class="o">=</span><span class="n">contract_address</span><span class="p">,</span> <span class="n">abi</span><span class="o">=</span><span class="n">abi</span><span class="p">)</span>

    <span class="c1"># Store data
</span>    <span class="n">txn</span> <span class="o">=</span> <span class="n">contract</span><span class="p">.</span><span class="n">functions</span><span class="p">.</span><span class="nf">storeData</span><span class="p">(</span><span class="n">data</span><span class="p">).</span><span class="nf">buildTransaction</span><span class="p">({</span>
        <span class="sh">'</span><span class="s">chainId</span><span class="sh">'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">gas</span><span class="sh">'</span><span class="p">:</span> <span class="mi">2000000</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">gasPrice</span><span class="sh">'</span><span class="p">:</span> <span class="n">web3</span><span class="p">.</span><span class="nf">toWei</span><span class="p">(</span><span class="sh">'</span><span class="s">10</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">gwei</span><span class="sh">'</span><span class="p">),</span>
        <span class="sh">'</span><span class="s">nonce</span><span class="sh">'</span><span class="p">:</span> <span class="n">web3</span><span class="p">.</span><span class="n">eth</span><span class="p">.</span><span class="nf">getTransactionCount</span><span class="p">(</span><span class="n">web3</span><span class="p">.</span><span class="n">eth</span><span class="p">.</span><span class="n">defaultAccount</span><span class="p">),</span>
    <span class="p">})</span>

    <span class="c1"># Sign and send the transaction
</span>    <span class="n">signed_txn</span> <span class="o">=</span> <span class="n">web3</span><span class="p">.</span><span class="n">eth</span><span class="p">.</span><span class="n">account</span><span class="p">.</span><span class="nf">sign_transaction</span><span class="p">(</span><span class="n">txn</span><span class="p">,</span> <span class="n">private_key</span><span class="p">)</span>
    <span class="n">tx_token</span> <span class="o">=</span> <span class="n">web3</span><span class="p">.</span><span class="n">eth</span><span class="p">.</span><span class="nf">sendRawTransaction</span><span class="p">(</span><span class="n">signed_txn</span><span class="p">.</span><span class="n">rawTransaction</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">web3</span><span class="p">.</span><span class="nf">toHex</span><span class="p">(</span><span class="n">tx_token</span><span class="p">)</span>

<span class="c1"># Example usage
</span><span class="n">contract_address</span> <span class="o">=</span> <span class="sh">'</span><span class="s">your_contract_address_here</span><span class="sh">'</span>
<span class="n">account_address</span> <span class="o">=</span> <span class="sh">'</span><span class="s">your_account_address_here</span><span class="sh">'</span>
<span class="n">private_key</span> <span class="o">=</span> <span class="sh">'</span><span class="s">your_private_key_here</span><span class="sh">'</span>
<span class="n">data</span> <span class="o">=</span> <span class="sh">'</span><span class="s">hash_or_string_of_json_ld_consent_proof</span><span class="sh">'</span>
<span class="n">transaction_token</span> <span class="o">=</span> <span class="nf">store_data_in_ethereum</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">contract_address</span><span class="p">,</span> <span class="n">account_address</span><span class="p">,</span> <span class="n">private_key</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Transaction Token: </span><span class="si">{</span><span class="n">transaction_token</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div> <p><strong>Note</strong>: Placeholders like <code class="language-plaintext highlighter-rouge">'your_ethereum_node_url'</code>, <code class="language-plaintext highlighter-rouge">'your_contract_address_here'</code>, <code class="language-plaintext highlighter-rouge">'your_account_address_here'</code>, and <code class="language-plaintext highlighter-rouge">'your_private_key_here'</code> should be replaced with your actual values. Also, the <code class="language-plaintext highlighter-rouge">web3.py</code> library must be installed (<code class="language-plaintext highlighter-rouge">pip install web3</code>).</p> <hr> <h2 id="generating-users-data">Generating User’s Data</h2> <p>Below describes at a high level how a user who is keen to share (and / or monetize) their data may install a Google Chrome browser extension, and allow anonymized tracking. The file data is anaonymized, and uploaded to AWS S3. The hash of the data is returned - uniquely identifying the dataset, alongwith the S3 URI.</p> <p><strong>1. Manifest.json (Extension Configuration):</strong></p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"manifest_version"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Privacy-Aware Website Tracking"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Tracks anonymized website behavior with user consent."</span><span class="p">,</span><span class="w">
  </span><span class="nl">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.0.0"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"activeTab"</span><span class="p">,</span><span class="w"> </span><span class="s2">"webNavigation"</span><span class="p">,</span><span class="w"> </span><span class="s2">"storage"</span><span class="p">,</span><span class="w"> </span><span class="s2">"identity"</span><span class="p">],</span><span class="w">
  </span><span class="nl">"background"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"service_worker"</span><span class="p">:</span><span class="w"> </span><span class="s2">"background.js"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"content_scripts"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"matches"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"&lt;all_urls&gt;"</span><span class="p">],</span><span class="w">
      </span><span class="nl">"js"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"content.js"</span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <p><strong>2. background.js (Service Worker):</strong></p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Handle user login (e.g., using Chrome Identity API)</span>
<span class="nx">chrome</span><span class="p">.</span><span class="nx">identity</span><span class="p">.</span><span class="nf">getAuthToken</span><span class="p">({</span> <span class="na">interactive</span><span class="p">:</span> <span class="kc">true</span> <span class="p">},</span> <span class="nf">function </span><span class="p">(</span><span class="nx">token</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// ... store token securely ...</span>
<span class="p">});</span>

<span class="c1">// Listen for web navigation events</span>
<span class="nx">chrome</span><span class="p">.</span><span class="nx">webNavigation</span><span class="p">.</span><span class="nx">onCompleted</span><span class="p">.</span><span class="nf">addListener</span><span class="p">((</span><span class="nx">details</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// Send a message to the content script to start tracking</span>
  <span class="nx">chrome</span><span class="p">.</span><span class="nx">tabs</span><span class="p">.</span><span class="nf">sendMessage</span><span class="p">(</span><span class="nx">details</span><span class="p">.</span><span class="nx">tabId</span><span class="p">,</span> <span class="p">{</span> <span class="na">action</span><span class="p">:</span> <span class="dl">"</span><span class="s2">startTracking</span><span class="dl">"</span> <span class="p">});</span>
<span class="p">});</span>

<span class="c1">// Receive anonymized data from content script</span>
<span class="nx">chrome</span><span class="p">.</span><span class="nx">runtime</span><span class="p">.</span><span class="nx">onMessage</span><span class="p">.</span><span class="nf">addListener</span><span class="p">(</span><span class="k">async </span><span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="nx">sender</span><span class="p">,</span> <span class="nx">sendResponse</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">action</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">data</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Sign data with user's private key (retrieved securely)</span>
    <span class="kd">const</span> <span class="nx">signedData</span> <span class="o">=</span> <span class="k">await</span> <span class="nf">signData</span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>

    <span class="c1">// Upload signed data to S3</span>
    <span class="kd">const</span> <span class="p">{</span> <span class="nx">hash</span><span class="p">,</span> <span class="nx">s3Uri</span> <span class="p">}</span> <span class="o">=</span> <span class="k">await</span> <span class="nf">uploadToS3</span><span class="p">(</span><span class="nx">signedData</span><span class="p">);</span>

    <span class="c1">// Send response back to content script</span>
    <span class="nf">sendResponse</span><span class="p">({</span> <span class="nx">hash</span><span class="p">,</span> <span class="nx">s3Uri</span> <span class="p">});</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div></div> <p><strong>3. content.js (Content Script):</strong></p> <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">trackingData</span> <span class="o">=</span> <span class="p">[];</span>
<span class="kd">let</span> <span class="nx">isTracking</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

<span class="nx">chrome</span><span class="p">.</span><span class="nx">runtime</span><span class="p">.</span><span class="nx">onMessage</span><span class="p">.</span><span class="nf">addListener</span><span class="p">((</span><span class="nx">message</span><span class="p">,</span> <span class="nx">sender</span><span class="p">,</span> <span class="nx">sendResponse</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">action</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">startTracking</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">isTracking</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="nf">startTracking</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="kd">function</span> <span class="nf">startTracking</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// ... Capture anonymized website interaction data ...</span>

  <span class="c1">// Periodically send data to background script</span>
  <span class="nf">setInterval</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">isTracking</span> <span class="o">&amp;&amp;</span> <span class="nx">trackingData</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">chrome</span><span class="p">.</span><span class="nx">runtime</span><span class="p">.</span><span class="nf">sendMessage</span><span class="p">({</span> <span class="na">action</span><span class="p">:</span> <span class="dl">"</span><span class="s2">data</span><span class="dl">"</span><span class="p">,</span> <span class="na">data</span><span class="p">:</span> <span class="nx">trackingData</span> <span class="p">},</span> <span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="c1">// Handle response from background script (e.g., display hash and S3 URI)</span>
      <span class="p">});</span>
      <span class="nx">trackingData</span> <span class="o">=</span> <span class="p">[];</span> <span class="c1">// Clear data after sending</span>
    <span class="p">}</span>
  <span class="p">},</span> <span class="mi">5000</span><span class="p">);</span> <span class="c1">// Adjust interval as needed</span>
<span class="p">}</span>
</code></pre></div></div> <p><br></p> <hr> <h2 id="time-leased-sharing-of-the-users-data">Time-leased sharing of the User’s Data</h2> <p>Time-leased data sharing empowers users with greater control over their personal information while enabling organizations to derive valuable insights. This innovative model introduces a concept where users explicitly grant access to their anonymized data for a predetermined duration.</p> <p>Time-leased data sharing leverages blockchain technology and smart contracts to create a transparent, secure, and tamper-proof framework for data exchange. It allows users to define the terms of data usage, including the specific data points shared, the intended purpose, and the duration of access. By doing so, users retain ownership and control over their data, ensuring that it’s not exploited beyond their consent.</p> <p>Below is a sample approach that leverages smart contracts to enforce the temporal control.</p> <p><br></p> <p><strong>Smart Contract Structure and Logic</strong></p> <p>The core components of a smart contract for this purpose would typically include:</p> <ul> <li> <strong>Data Hash Storage:</strong> A variable (e.g., <code class="language-plaintext highlighter-rouge">bytes32 dataHash</code>) to securely store the hash of the anonymized data file. This hash serves as a unique identifier for the data without revealing its content.</li> <li> <strong>Expiration Timestamp:</strong> A variable (e.g., <code class="language-plaintext highlighter-rouge">uint256 expirationTime</code>) to store the Unix timestamp representing the date and time when the data sharing agreement expires.</li> <li> <strong>Data Validity Function:</strong> A function (e.g., <code class="language-plaintext highlighter-rouge">isDataValid()</code>) that compares the current block timestamp (accessible within the smart contract) with the stored <code class="language-plaintext highlighter-rouge">expirationTime</code>. It returns <code class="language-plaintext highlighter-rouge">true</code> if the data is still valid (current time is before expiration) and <code class="language-plaintext highlighter-rouge">false</code> if it has expired.</li> <li> <strong>Optional Revocation Mechanism:</strong> Additional functions or events can be included to explicitly revoke access to the data before the expiration time, either by the data owner or through some other agreed-upon condition.</li> </ul> <p><br></p> <p><strong>Interaction with S3 and the Chrome Extension</strong></p> <ol> <li> <p><strong>Data Upload and Hashing:</strong> The Chrome extension anonymizes the user’s data, calculates its hash (e.g., SHA-256), and uploads the data to the S3 bucket.</p> </li> <li> <p><strong>Smart Contract Deployment:</strong></p> <ul> <li>The extension sends a transaction to the blockchain to deploy the smart contract.</li> <li>The transaction includes the data hash and the chosen expiration timestamp as arguments to the contract’s constructor.</li> </ul> </li> <li> <p><strong>Data Access:</strong></p> <ul> <li>When someone (e.g., a data analyst or a third-party application) wants to access the data from S3, they first interact with the smart contract.</li> <li>They provide the data hash and call the <code class="language-plaintext highlighter-rouge">isDataValid()</code> function.</li> <li>The smart contract returns <code class="language-plaintext highlighter-rouge">true</code> if the data is still valid, allowing the user to proceed and download it from S3.</li> <li>If the smart contract returns <code class="language-plaintext highlighter-rouge">false</code>, the data is considered expired, and access is denied.</li> </ul> </li> </ol> <p><br></p> <p><strong>Code Example (Solidity):</strong></p> <pre><code class="language-solidity">pragma solidity ^0.8.0;

contract DataLease {
    // ... (same as previous example) ...

    event DataExpired(bytes32 dataHash);

    function revokeAccess() public {
        require(msg.sender == owner, "Only the owner can revoke access");
        expirationTime = block.timestamp;
        emit DataExpired(dataHash);
    }
}
</code></pre> <h2 id="looking-forward-">Looking forward ..</h2> <p>In conclusion, OConsent represents a significant step towards a more transparent and user-centric approach to data sharing. By leveraging blockchain technology and focusing on user empowerment, it addresses key challenges in consent management and privacy protection. While still evolving, OConsent demonstrates the potential of decentralized solutions to reshape the data landscape. The protocol’s future development and adoption will be crucial in determining its broader impact on promoting a more equitable and transparent data economy.</p> <p>OConsent now has a dedicated home at https://oconsent.io. The Original Paper is available at https://arxiv.org/abs/2201.01326</p> <blockquote> <p>If the idea of OConsent excites you — please join us to spread the word on twitter/theoconsent or contribute towards its development on github/oconsent by initiating a pull request or write to us at hi@oconsent.io</p> </blockquote> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/etlc-context-new-paradigm/">Introducing ETL-C (Extract, Transform, Load, Contextualize) - a new data processing paradigm</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/genetic-algorithm-inspired-data-platforms-part-1/">Evolutionary Bytes - Harnessing Genetic Algorithms for Smarter Data Platforms (Part 1/2)</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/quantum-data-platform/">Data at Quantum Speed - The Promise and Potential of QDP</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/etl-llm-part-2/">(Part 2/3) Rethinking ETLs - How Large Language Models (LLM) can enhance Data Transformation and Integration</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2021/designing-a-real-time-data-processing-system/">Designing a Real Time Data Processing System</a> </li> <div id="giscus_thread" style="max-width: 1024px; margin: 0 auto;"> <script>let giscusTheme=determineComputedTheme(),giscusAttributes={src:"https://giscus.app/client.js","data-repo":"bassrehab/bassrehab.github.io","data-repo-id":"R_kgDOLvY8Tg","data-category":"Comments","data-category-id":"DIC_kwDOLvY8Ts4CexzE","data-mapping":"title","data-strict":"0","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"bottom","data-theme":giscusTheme,"data-lang":"en",crossorigin:"anonymous",async:""},giscusScript=document.createElement("script");Object.entries(giscusAttributes).forEach(([t,e])=>giscusScript.setAttribute(t,e)),document.getElementById("giscus_thread").appendChild(giscusScript);</script> <noscript>Please enable JavaScript to view the <a href="http://giscus.app/?ref_noscript" rel="external nofollow noopener" target="_blank">comments powered by giscus.</a> </noscript> </div> </div> </div> </div> </div> <footer class="sticky-bottom mt-5" role="contentinfo"> <div class="container"> © Copyright 2024 Subhadip Mitra. Some Rights Reserved. Last updated: July 24, 2024. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script defer src="/assets/js/bootstrap-toc.min.js?c82ff4de8b0955d6ff14f5b05eed7eb6"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?b7816bd189846d29eded8745f9c4cf77"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.min.js"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-TW7YQ5XPC6"></script> <script>function gtag(){window.dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-TW7YQ5XPC6");</script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>