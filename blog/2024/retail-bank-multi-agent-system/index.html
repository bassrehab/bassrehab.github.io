<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta name="google-site-verification" content="R3nPzqP9nO2aTgysGUiU3t-pw3wi1xuUuKVaMrimuck"> <meta name="msvalidate.01" content="04fec5e0d64b1c9bc788e98f81ee2a78"> <meta http-equiv="Permissions-Policy" content="interest-cohort=()"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Engineering Multi-Agent Systems - A Retail Banking Case Study | Subhadip Mitra </title> <meta name="author" content="Subhadip Mitra"> <meta name="description" content="Explore a detailed technical implementation of a multi-agent system for retail banking credit assessment. Learn about agent architecture, distributed systems patterns, error handling, compliance requirements, and performance optimization through actual code examples and system diagrams. Ideal for software architects and engineers building scalable financial systems."> <meta name="keywords" content="subhadip-mitra,subhadip,google,google-cloud,data-&amp;-analytics,ai-innovations,enterprise-technology-leadership,digital-transformation,machine-learning-models,cloud-technologies,quantum-computing,technology-consulting,singapore,researcher,llm,genai"> <meta property="og:site_name" content="Subhadip Mitra"> <meta property="og:type" content="article"> <meta property="og:title" content="Subhadip Mitra | Engineering Multi-Agent Systems - A Retail Banking Case Study"> <meta property="og:url" content="https://subhadipmitra.com/blog/2024/retail-bank-multi-agent-system/"> <meta property="og:description" content="Explore a detailed technical implementation of a multi-agent system for retail banking credit assessment. Learn about agent architecture, distributed systems patterns, error handling, compliance requirements, and performance optimization through actual code examples and system diagrams. Ideal for software architects and engineers building scalable financial systems."> <meta property="og:image" content="https://subhadipmitra.com/assets/img/og/retail-bank-multi-agent-system.png"> <meta property="og:image:width" content="1200"> <meta property="og:image:height" content="630"> <meta property="og:locale" content="en"> <meta property="og:logo" content="https://subhadipmitra.com/assets/img/prof_pic.jpg"> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:title" content="Engineering Multi-Agent Systems - A Retail Banking Case Study"> <meta name="twitter:description" content="Explore a detailed technical implementation of a multi-agent system for retail banking credit assessment. Learn about agent architecture, distributed systems patterns, error handling, compliance requirements, and performance optimization through actual code examples and system diagrams. Ideal for software architects and engineers building scalable financial systems."> <meta name="twitter:image" content="https://subhadipmitra.com/assets/img/og/retail-bank-multi-agent-system.png"> <meta property="article:published_time" content="2024-12-28T12:15:13+00:00"> <meta property="article:author" content="Subhadip Mitra"> <meta property="article:tag" content="architecture"> <meta property="article:tag" content="casestudy"> <meta property="article:section" content="architecture"> <meta property="article:section" content="casetudy"> <script type="application/ld+json">
      {
          "@context": "https://schema.org",
          "@type": "BlogPosting",
          "mainEntityOfPage": {
              "@type": "WebPage",
              "@id": "https://subhadipmitra.com/blog/2024/retail-bank-multi-agent-system/"
          },
          "headline": "Engineering Multi-Agent Systems - A Retail Banking Case Study",
          "description": "Explore a detailed technical implementation of a multi-agent system for retail banking credit assessment. Learn about agent architecture, distributed systems patterns, error handling, compliance requirements, and performance optimization through actual code examples and system diagrams. Ideal for software architects and engineers building scalable financial systems.",
          "url": "https://subhadipmitra.com/blog/2024/retail-bank-multi-agent-system/",
          "datePublished": "2024-12-28T12:15:13+00:00",
          
          "dateModified": "2024-12-28T12:15:13+00:00",
          
          "wordCount": 6400,
          "timeRequired": "PT33M",
          
          "image": "https://subhadipmitra.com/assets/img/social_preview.png",
          
          
          "keywords": "architecture, casestudy",
          
          
          "articleSection": "architecture",
          
          "author": {
              "@type": "Person",
              "name": "Subhadip Mitra",
              "url": "https://subhadipmitra.com",
              "jobTitle": "Data and Analytics Manager, Site Lead Southeast Asia",
              "worksFor": {
                  "@type": "Organization",
                  "name": "Google Cloud"
              },
              "sameAs": [
                  "https://linkedin.com/in/subhadip-mitra",
                  "https://github.com/bassrehab",
                  "https://twitter.com/bassrehab"
              ]
          },
          "publisher": {
              "@type": "Organization",
              "name": "Subhadip Mitra",
              "url": "https://subhadipmitra.com",
              "logo": {
                  "@type": "ImageObject",
                  "url": "https://subhadipmitra.com/assets/img/prof_pic.jpg"
              }
          },
          "isPartOf": {
              "@type": "Blog",
              "name": "binary breakthroughs",
              "url": "https://subhadipmitra.com/blog/"
          }
          
      }
    </script> <script type="application/ld+json">
      {
          "@context": "https://schema.org",
          "@type": "BreadcrumbList",
          "itemListElement": [
              {
                  "@type": "ListItem",
                  "position": 1,
                  "name": "Home",
                  "item": "https://subhadipmitra.com"
              },
              {
                  "@type": "ListItem",
                  "position": 2,
                  "name": "Blog",
                  "item": "https://subhadipmitra.com/blog/"
              },
              
              {
                  "@type": "ListItem",
                  "position": 3,
                  "name": "Architecture",
                  "item": "https://subhadipmitra.com/blog/category/architecture"
              },
              {
                  "@type": "ListItem",
                  "position": 4,
                  "name": "Engineering Multi-Agent Systems - A Retail Banking Case Study",
                  "item": "https://subhadipmitra.com/blog/2024/retail-bank-multi-agent-system/"
              }
              
          ]
      }
    </script> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300..700&amp;family=Inter+Tight:ital,wght@0,100..900;1,100..900&amp;family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link defer href="/assets/css/bootstrap-toc.min.css?6f5af0bb9aab25d79b2448143cbeaa88" rel="stylesheet"> <link rel="shortcut icon" href="/assets/img/favicon.png?058310854f7b3c920f894a1d42c3c47b"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://subhadipmitra.com/blog/2024/retail-bank-multi-agent-system/"> <script src="/assets/js/theme.js?33a804e644f2507dbddc853404eccc7a"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> </head> <body class="fixed-top-nav sticky-bottom-footer"> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Subhadip</span> Mitra </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/now/">now </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications </a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories </a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">more </a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item " href="/contact/">contact</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/reading-list/">reading list</a> <a class="dropdown-item " href="/archive/">archive</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="https://upir.subhadipmitra.com" rel="external nofollow noopener" target="_blank">docs: UPIR</a> <a class="dropdown-item " href="https://ai-metacognition-toolkit.subhadipmitra.com/" rel="external nofollow noopener" target="_blank">docs: AI Metacognition</a> <a class="dropdown-item " href="https://symmetry.subhadipmitra.com/" rel="external nofollow noopener" target="_blank">symmetry</a> </div> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="row"> <div class="col-sm-3"> <div id="toc-wrapper" class="toc-wrapper sticky-top"> <div class="toc-header"> <span class="toc-title">Contents</span> <button class="toc-toggle" aria-label="Toggle table of contents" title="Hide contents"> <i class="fas fa-chevron-up"></i> </button> </div> <nav id="toc-sidebar" class="toc-nav"></nav> </div> </div> <div class="col-sm-9"> <div class="post"> <header class="post-header"> <h1 class="post-title">Engineering Multi-Agent Systems - A Retail Banking Case Study</h1> <p class="post-meta"> Created on December 28, 2024 </p> <p class="post-tags"> <a href="/blog/2024"> <i class="fa-solid fa-calendar fa-sm"></i> 2024 </a>   ·   <a href="/blog/tag/architecture"> <i class="fa-solid fa-hashtag fa-sm"></i> architecture</a>   <a href="/blog/tag/casestudy"> <i class="fa-solid fa-hashtag fa-sm"></i> casestudy</a>   ·   <a href="/blog/category/architecture"> <i class="fa-solid fa-tag fa-sm"></i> architecture</a>   <a href="/blog/category/casetudy"> <i class="fa-solid fa-tag fa-sm"></i> casetudy</a> </p> </header> <div class="audio-reader-container"> <div class="audio-reader-compact"> <button class="audio-trigger" id="audio-trigger" aria-label="Open audio player"> <i class="fas fa-headphones"></i> <span>Listen to article</span> <i class="fas fa-chevron-down audio-trigger-icon"></i> </button> <div class="audio-player-expanded" id="audio-player-expanded"> <div class="audio-player-body"> <div class="audio-info-bar"> <i class="fas fa-info-circle"></i> <span>Browser text-to-speech • Quality varies by device</span> </div> <div class="audio-controls-row"> <button class="audio-btn audio-btn-play" id="tts-play" aria-label="Play"> <i class="fas fa-play"></i> <span id="play-text">Play</span> </button> <button class="audio-btn audio-btn-pause" id="tts-pause" style="display: none" aria-label="Pause"> <i class="fas fa-pause"></i> <span>Pause</span> </button> <button class="audio-btn audio-btn-stop" id="tts-stop" aria-label="Stop"> <i class="fas fa-stop"></i> </button> <div class="audio-speed-control"> <label for="tts-rate" class="audio-speed-label"> <i class="fas fa-gauge-high"></i> <span id="tts-rate-value">1.0x</span> </label> <input id="tts-rate" type="range" min="0.5" max="2" step="0.1" value="1" class="audio-speed-slider"> </div> </div> <div class="audio-voice-row"> <label for="tts-voice" class="audio-voice-label"> <i class="fas fa-microphone"></i> <span>Voice:</span> </label> <select id="tts-voice" class="audio-voice-select"> <option value="">Loading voices...</option> </select> </div> <div class="audio-progress-section"> <div class="audio-progress-info"> <span><i class="fas fa-circle-notch"></i> Progress</span> <span id="tts-progress">0%</span> </div> <div class="progress" style="height: 4px"> <div class="progress-bar" id="tts-progress-bar" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div> </div> </div> </div> </div> </div> </div> <style>.audio-reader-container{margin:1.5rem 0;font-family:var(--global-font-family,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif)}.audio-reader-compact{position:relative}.audio-trigger{display:inline-flex;align-items:center;gap:.5rem;padding:.5rem 1rem;background:var(--global-code-bg-color,#f8f9fa);border:1px solid var(--global-divider-color,#dee2e6);border-radius:.375rem;color:var(--global-text-color,#212529);font-size:.875rem;font-weight:500;cursor:pointer;transition:all .2s ease;font-family:inherit}.audio-trigger:hover{background:var(--global-bg-color,#fff);border-color:var(--global-theme-color,#0d6efd);color:var(--global-theme-color,#0d6efd);box-shadow:0 .125rem .25rem rgba(0,0,0,0.075)}.audio-trigger i:first-child{font-size:1rem;color:var(--global-theme-color,#0d6efd)}.audio-trigger-icon{font-size:.75rem;margin-left:.25rem;transition:transform .3s ease;color:var(--global-text-color-light,#6c757d)}.audio-trigger.active .audio-trigger-icon{transform:rotate(180deg)}.audio-trigger:focus{outline:2px solid var(--global-theme-color,#0d6efd);outline-offset:2px}.audio-player-expanded{display:none;margin-top:.75rem;background:var(--global-bg-color,#fff);border:1px solid var(--global-divider-color,#dee2e6);border-radius:.5rem;box-shadow:0 .25rem .75rem rgba(0,0,0,0.05);animation:slideDown .3s ease}.audio-player-expanded.show{display:block}@keyframes slideDown{from{opacity:0;transform:translateY(-0.5rem)}to{opacity:1;transform:translateY(0)}}.audio-player-body{padding:1rem}.audio-info-bar{display:flex;align-items:center;gap:.5rem;padding:.625rem .75rem;background:var(--global-code-bg-color,#f8f9fa);border-left:2px solid var(--global-theme-color,#0d6efd);border-radius:.25rem;font-size:.8125rem;color:var(--global-text-color-light,#6c757d);margin-bottom:1rem}.audio-info-bar i{color:var(--global-theme-color,#0d6efd);font-size:.875rem}.audio-controls-row{display:flex;align-items:center;gap:.5rem;margin-bottom:.875rem;flex-wrap:wrap}.audio-btn{display:inline-flex;align-items:center;gap:.375rem;padding:.375rem .875rem;border:1px solid transparent;border-radius:.375rem;font-size:.875rem;font-weight:500;cursor:pointer;transition:all .15s ease;font-family:inherit;color:#fff}.audio-btn i{font-size:.8125rem}.audio-btn span{color:#fff}.audio-btn:hover:not(:disabled){transform:translateY(-1px);box-shadow:0 .125rem .375rem rgba(0,0,0,0.15)}.audio-btn:active:not(:disabled){transform:translateY(0)}.audio-btn:disabled{opacity:.6;cursor:not-allowed}.audio-btn-play{background:var(--global-theme-color,#0d6efd);border-color:var(--global-theme-color,#0d6efd)}.audio-btn-play:hover:not(:disabled){background:color-mix(in srgb,var(--global-theme-color,#0d6efd) 85%,black);border-color:color-mix(in srgb,var(--global-theme-color,#0d6efd) 80%,black)}.audio-btn-play.playing{background:#198754;border-color:#198754}.audio-btn-pause{background:#6c757d;border-color:#6c757d}.audio-btn-pause:hover:not(:disabled){background:#5c636a;border-color:#565e64}.audio-btn-stop{background:transparent;color:#dc3545;border-color:#dc3545;padding:.375rem .625rem}.audio-btn-stop:hover:not(:disabled){background:#dc3545;color:#fff;border-color:#dc3545}.audio-speed-control{display:flex;align-items:center;gap:.5rem;margin-left:auto}.audio-speed-label{display:flex;align-items:center;gap:.375rem;font-size:.8125rem;font-weight:500;color:var(--global-text-color,#212529);margin:0;white-space:nowrap}.audio-speed-label i{color:var(--global-theme-color,#0d6efd);font-size:.875rem}.audio-speed-slider{width:80px;height:4px;-webkit-appearance:none;appearance:none;background:var(--global-divider-color,#dee2e6);border-radius:2px;outline:0}.audio-speed-slider::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;width:14px;height:14px;border-radius:50%;background:var(--global-theme-color,#0d6efd);cursor:pointer;transition:transform .15s ease}.audio-speed-slider::-webkit-slider-thumb:hover{transform:scale(1.2)}.audio-speed-slider::-moz-range-thumb{width:14px;height:14px;border-radius:50%;background:var(--global-theme-color,#0d6efd);border:0;cursor:pointer;transition:transform .15s ease}.audio-speed-slider::-moz-range-thumb:hover{transform:scale(1.2)}.audio-voice-row{display:flex;align-items:center;gap:.75rem;margin-bottom:.875rem}.audio-voice-label{display:flex;align-items:center;gap:.375rem;font-size:.8125rem;font-weight:500;color:var(--global-text-color,#212529);margin:0;white-space:nowrap}.audio-voice-label i{color:var(--global-theme-color,#0d6efd);font-size:.875rem}.audio-voice-select{flex:1;padding:.375rem .75rem;border:1px solid var(--global-divider-color,#dee2e6);border-radius:.375rem;font-size:.8125rem;background:var(--global-bg-color,#fff);color:var(--global-text-color,#212529);cursor:pointer;transition:border-color .15s ease}.audio-voice-select:hover{border-color:var(--global-theme-color,#0d6efd)}.audio-voice-select:focus{outline:0;border-color:var(--global-theme-color,#0d6efd);box-shadow:0 0 0 .2rem rgba(13,110,253,0.25)}.audio-progress-section{margin-top:.75rem;padding-top:.75rem;border-top:1px solid var(--global-divider-color,#e9ecef)}
.audio-progress-info{display:flex;justify-content:space-between;align-items:center;font-size:.8125rem;color:var(--global-text-color-light,#6c757d);margin-bottom:.5rem}.audio-progress-info i{margin-right:.25rem;color:var(--global-theme-color,#0d6efd);font-size:.75rem}.progress{border-radius:2px;overflow:hidden;background:var(--global-divider-color,#e9ecef)}.progress-bar{background:var(--global-theme-color,#0d6efd);transition:width .6s ease}[data-theme="dark"] .audio-trigger,body.dark-mode .audio-trigger{background:rgba(255,255,255,0.05);border-color:var(--global-divider-color,#454545);color:var(--global-text-color,#e9ecef)}[data-theme="dark"] .audio-trigger:hover,body.dark-mode .audio-trigger:hover{background:rgba(255,255,255,0.08)}[data-theme="dark"] .audio-player-expanded,body.dark-mode .audio-player-expanded{background:var(--global-bg-color,#1e1e1e);border-color:var(--global-divider-color,#454545)}[data-theme="dark"] .audio-info-bar,body.dark-mode .audio-info-bar{background:rgba(255,255,255,0.03)}[data-theme="dark"] .audio-voice-select,body.dark-mode .audio-voice-select{background:var(--global-bg-color,#1e1e1e);border-color:var(--global-divider-color,#454545);color:var(--global-text-color,#e9ecef)}[data-theme="dark"] .progress,body.dark-mode .progress{background:rgba(255,255,255,0.1)}@media(max-width:576px){.audio-trigger span{display:none}.audio-controls-row{flex-wrap:wrap}.audio-btn span{display:none}.audio-btn{padding:.5rem .75rem}.audio-btn i{font-size:1rem}.audio-speed-control{width:100%;margin-left:0;margin-top:.5rem}.audio-speed-slider{flex:1}.audio-voice-row{flex-direction:column;align-items:stretch}}@media print{.audio-reader-container{display:none!important}}@media(prefers-reduced-motion:reduce){.audio-trigger,.audio-btn,.progress-bar,.audio-player-expanded{transition:none;animation:none}}</style> <script>
  (function () {
    "use strict";

    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", init);
    } else {
      init();
    }

    function init() {
      if (!("speechSynthesis" in window)) {
        document.querySelector(".audio-reader-container").innerHTML = `
        <div class="audio-reader-compact">
          <div class="alert alert-warning d-flex align-items-center" role="alert" style="font-size: 0.875rem;">
            <i class="fas fa-exclamation-triangle me-2"></i>
            <div>Text-to-speech not supported in this browser.</div>
          </div>
        </div>
      `;
        return;
      }

      const synth = window.speechSynthesis;
      let utterance = null;
      let isPaused = false;

      const triggerBtn = document.getElementById("audio-trigger");
      const expandedPlayer = document.getElementById("audio-player-expanded");
      const playBtn = document.getElementById("tts-play");
      const pauseBtn = document.getElementById("tts-pause");
      const stopBtn = document.getElementById("tts-stop");
      const voiceSelect = document.getElementById("tts-voice");
      const rateSlider = document.getElementById("tts-rate");
      const rateValue = document.getElementById("tts-rate-value");
      const progressText = document.getElementById("tts-progress");
      const progressBar = document.getElementById("tts-progress-bar");
      const playText = document.getElementById("play-text");

      const possibleSelectors = [
        ".post-content",
        "article .post-content",
        ".post .post-content",
        "article.post",
        ".post",
        "article",
        "main article",
        "main .container",
        "main",
        ".l-main",
        ".content",
      ];

      let articleElement = null;
      for (const selector of possibleSelectors) {
        articleElement = document.querySelector(selector);
        if (articleElement) break;
      }

      if (!articleElement) {
        console.warn("Audio Reader: Could not find article content");
        return;
      }

      const clonedContent = articleElement.cloneNode(true);
      const elementsToRemove = [
        "pre",
        "code",
        "script",
        "style",
        "nav",
        ".audio-reader-container",
        ".citation",
        ".giscus",
        ".utterances",
        ".navigation",
        ".pagination",
        ".social",
        ".share",
        "header",
        "footer",
        ".header",
        ".footer",
        ".sidebar",
      ];

      elementsToRemove.forEach((selector) => {
        clonedContent.querySelectorAll(selector).forEach((el) => el.remove());
      });

      const articleText = clonedContent.innerText
        .replace(/\s+/g, " ")
        .replace(/\n{3,}/g, "\n\n")
        .trim();

      if (!articleText || articleText.length < 100) {
        console.warn("Audio Reader: Article too short");
        return;
      }

      // Toggle player
      triggerBtn.addEventListener("click", function () {
        expandedPlayer.classList.toggle("show");
        this.classList.toggle("active");
        localStorage.setItem("audioPlayerExpanded", expandedPlayer.classList.contains("show"));
      });

      // Load voices
      function loadVoices() {
        const voices = synth.getVoices();
        if (voices.length === 0) {
          setTimeout(loadVoices, 100);
          return;
        }

        voiceSelect.innerHTML = '<option value="">Default Voice</option>';

        const englishVoices = voices.filter((v) => v.lang.startsWith("en"));
        const preferredVoices = englishVoices.filter(
          (v) =>
            v.name.includes("Google") ||
            v.name.includes("Microsoft") ||
            v.name.includes("Premium") ||
            v.name.includes("Enhanced") ||
            v.name.includes("Natural")
        );
        const standardEnglishVoices = englishVoices.filter((v) => !preferredVoices.includes(v));
        const otherVoices = voices.filter((v) => !v.lang.startsWith("en"));

        preferredVoices.forEach((voice) => {
          const option = document.createElement("option");
          option.value = voices.indexOf(voice);
          option.textContent = `${voice.name} (${voice.lang})`;
          voiceSelect.appendChild(option);
        });

        if (standardEnglishVoices.length > 0) {
          const optgroup = document.createElement("optgroup");
          optgroup.label = "Other English";
          standardEnglishVoices.forEach((voice) => {
            const option = document.createElement("option");
            option.value = voices.indexOf(voice);
            option.textContent = `${voice.name} (${voice.lang})`;
            optgroup.appendChild(option);
          });
          voiceSelect.appendChild(optgroup);
        }

        if (otherVoices.length > 0) {
          const optgroup = document.createElement("optgroup");
          optgroup.label = "Other Languages";
          otherVoices.forEach((voice) => {
            const option = document.createElement("option");
            option.value = voices.indexOf(voice);
            option.textContent = `${voice.name} (${voice.lang})`;
            optgroup.appendChild(option);
          });
          voiceSelect.appendChild(optgroup);
        }
      }

      loadVoices();
      if (synth.addEventListener) {
        synth.addEventListener("voiceschanged", loadVoices);
      }

      function updateProgress(current, total) {
        const percent = Math.min(100, Math.round((current / total) * 100));
        progressText.textContent = `${percent}%`;
        progressBar.style.width = `${percent}%`;
        progressBar.setAttribute("aria-valuenow", percent);
      }

      function updatePlayButton(isPlaying) {
        const icon = playBtn.querySelector("i");
        if (isPlaying) {
          icon.className = "fas fa-circle-dot";
          playText.textContent = "Playing";
          playBtn.classList.add("playing");
        } else {
          icon.className = "fas fa-play";
          playText.textContent = "Play";
          playBtn.classList.remove("playing");
        }
      }

      function speak() {
        if (isPaused) {
          synth.resume();
          isPaused = false;
          updatePlayButton(true);
          pauseBtn.style.display = "inline-flex";
          return;
        }

        synth.cancel();
        utterance = new SpeechSynthesisUtterance(articleText);

        if (voiceSelect.value) {
          const voices = synth.getVoices();
          utterance.voice = voices[parseInt(voiceSelect.value)];
        }

        utterance.rate = parseFloat(rateSlider.value);
        utterance.pitch = 1;
        utterance.volume = 1;

        utterance.onstart = function () {
          updatePlayButton(true);
          pauseBtn.style.display = "inline-flex";
          playBtn.disabled = false;
        };

        utterance.onend = function () {
          updatePlayButton(false);
          pauseBtn.style.display = "none";
          updateProgress(100, 100);
          setTimeout(() => updateProgress(0, 100), 1000);
        };

        utterance.onboundary = function (event) {
          updateProgress(event.charIndex, articleText.length);
        };

        utterance.onerror = function (event) {
          if (event.error !== "interrupted" && event.error !== "canceled") {
            alert("Playback error. Try a different voice.");
          }
          updatePlayButton(false);
          pauseBtn.style.display = "none";
        };

        playBtn.disabled = true;
        synth.speak(utterance);
      }

      function pause() {
        if (synth.speaking && !isPaused) {
          synth.pause();
          isPaused = true;
          const icon = playBtn.querySelector("i");
          icon.className = "fas fa-play";
          playText.textContent = "Resume";
          playBtn.classList.remove("playing");
          pauseBtn.style.display = "none";
        }
      }

      function stop() {
        synth.cancel();
        isPaused = false;
        updatePlayButton(false);
        pauseBtn.style.display = "none";
        updateProgress(0, 100);
      }

      playBtn.addEventListener("click", speak);
      pauseBtn.addEventListener("click", pause);
      stopBtn.addEventListener("click", stop);

      rateSlider.addEventListener("input", function (e) {
        rateValue.textContent = `${parseFloat(e.target.value).toFixed(1)}x`;
      });

      window.addEventListener("beforeunload", function () {
        synth.cancel();
      });

      if (localStorage.getItem("audioPlayerExpanded") === "true") {
        setTimeout(() => {
          expandedPlayer.classList.add("show");
          triggerBtn.classList.add("active");
        }, 100);
      }
    }
  })();
</script> <article class="post-content"> <div id="markdown-content"> <blockquote> <p>Note: this blog post covers traditional software agents and doesn’t cover generative AI or autonomous agents. For a GenAI Agents System design case study, refer to <a href="https://subhadipmitra.com/blog/2025/telecom-autonomous-multi-agent-genai-system/">this post</a>.</p> </blockquote> <p>Modern retail banking systems face complex challenges that demand sophisticated technical solutions. In this deep dive, we’ll explore how multi-agent architectures solve real problems in credit assessment systems, using a production-grade implementation as our guide.</p> <h2 id="the-credit-assessment-challenge">The Credit Assessment Challenge</h2> <p>A bank’s credit assessment system needs to:</p> <ul> <li>Process thousands of applications simultaneously</li> <li>Integrate with multiple external systems</li> <li>Maintain strict compliance and audit trails</li> <li>Provide real-time decisions when possible</li> <li>Scale during high-demand periods (like tax season)</li> <li>Handle system failures gracefully</li> </ul> <p>Traditional monolithic architectures struggle with these requirements. Let’s explore how a multi-agent system addresses these challenges.</p> <h2 id="system-architecture">System Architecture</h2> <p>Our credit assessment system uses specialized agents that each handle specific aspects of the loan application process:</p> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/blog/agents-fsi-system-architecture-480.webp 480w,/assets/img/blog/agents-fsi-system-architecture-800.webp 800w,/assets/img/blog/agents-fsi-system-architecture-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/blog/agents-fsi-system-architecture.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <p><br></p> <h3 id="key-components">Key Components</h3> <ol> <li> <p>Income Verification Agent</p> <ul> <li>Processes bank statements and pay stubs</li> <li>Verifies employment information</li> <li>Calculates income stability metrics</li> </ul> </li> <li> <p>Credit Bureau Agent</p> <ul> <li>Manages rate-limited API access to credit bureaus</li> <li>Normalizes data from multiple bureaus</li> <li>Maintains score history and change tracking</li> </ul> </li> <li> <p>Fraud Detection Agent</p> <ul> <li>Runs ML models for fraud detection</li> <li>Performs velocity checks</li> <li>Manages investigation workflows</li> </ul> </li> <li> <p>Risk Assessment Agent</p> <ul> <li>Calculates debt-to-income ratios</li> <li>Evaluates borrower risk profiles</li> <li>Applies regulatory rules</li> </ul> </li> </ol> <h2 id="implementation-deep-dive">Implementation Deep Dive</h2> <p>Let’s examine how these components work together in practice.</p> <h3 id="application-flow">Application Flow</h3> <p>The diagram below shows how a typical application flows through the system:</p> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/blog/credit-assessment-process-flow-480.webp 480w,/assets/img/blog/credit-assessment-process-flow-800.webp 800w,/assets/img/blog/credit-assessment-process-flow-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/blog/credit-assessment-process-flow.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <p><br></p> <h3 id="code-implementation">Code Implementation</h3> <p>Below is a sample representative implementation.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="n">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">List</span>
<span class="kn">from</span> <span class="n">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span> <span class="n">enum</span> <span class="kn">import</span> <span class="n">Enum</span>
<span class="kn">import</span> <span class="n">asyncio</span>
<span class="kn">import</span> <span class="n">aiohttp</span>
<span class="kn">import</span> <span class="n">aioredis</span>
<span class="kn">import</span> <span class="n">logging</span>
<span class="kn">import</span> <span class="n">json</span>

<span class="k">class</span> <span class="nc">CreditDecision</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">APPROVED</span> <span class="o">=</span> <span class="sh">"</span><span class="s">approved</span><span class="sh">"</span>
    <span class="n">DECLINED</span> <span class="o">=</span> <span class="sh">"</span><span class="s">declined</span><span class="sh">"</span>
    <span class="n">REFER</span> <span class="o">=</span> <span class="sh">"</span><span class="s">refer_to_underwriter</span><span class="sh">"</span>
    <span class="n">ERROR</span> <span class="o">=</span> <span class="sh">"</span><span class="s">error</span><span class="sh">"</span>

<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">LoanApplication</span><span class="p">:</span>
    <span class="n">application_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">customer_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">loan_amount</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">term_months</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">purpose</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">submitted_at</span><span class="p">:</span> <span class="n">datetime</span>
    <span class="n">income_docs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">status</span><span class="p">:</span> <span class="nb">str</span>

<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">CreditAssessment</span><span class="p">:</span>
    <span class="n">credit_score</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">delinquencies</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">total_debt</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">monthly_obligations</span><span class="p">:</span> <span class="nb">float</span>

<span class="k">class</span> <span class="nc">IncomeVerificationAgent</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">redis_client</span><span class="p">:</span> <span class="n">aioredis</span><span class="p">.</span><span class="n">Redis</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">redis</span> <span class="o">=</span> <span class="n">redis_client</span>
        <span class="n">self</span><span class="p">.</span><span class="n">cache_ttl</span> <span class="o">=</span> <span class="mi">3600</span>  <span class="c1"># 1 hour
</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">verify_income</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">application</span><span class="p">:</span> <span class="n">LoanApplication</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="n">cache_key</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="s">income::</span><span class="si">{</span><span class="n">application</span><span class="p">.</span><span class="n">customer_id</span><span class="si">}</span><span class="sh">"</span>

        <span class="c1"># Check cache first
</span>        <span class="n">cached</span> <span class="o">=</span> <span class="k">await</span> <span class="n">self</span><span class="p">.</span><span class="n">redis</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">cache_key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cached</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">json</span><span class="p">.</span><span class="nf">loads</span><span class="p">(</span><span class="n">cached</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Process bank statements using OCR and ML
</span>            <span class="n">income_data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">self</span><span class="p">.</span><span class="nf">_process_bank_statements</span><span class="p">(</span>
                <span class="n">application</span><span class="p">.</span><span class="n">income_docs</span>
            <span class="p">)</span>

            <span class="c1"># Verify against employer records
</span>            <span class="n">employer_data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">self</span><span class="p">.</span><span class="nf">_verify_employment</span><span class="p">(</span>
                <span class="n">application</span><span class="p">.</span><span class="n">customer_id</span>
            <span class="p">)</span>

            <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
                <span class="sh">"</span><span class="s">monthly_income</span><span class="sh">"</span><span class="p">:</span> <span class="n">income_data</span><span class="p">[</span><span class="sh">"</span><span class="s">average_monthly_income</span><span class="sh">"</span><span class="p">],</span>
                <span class="sh">"</span><span class="s">income_stability</span><span class="sh">"</span><span class="p">:</span> <span class="n">income_data</span><span class="p">[</span><span class="sh">"</span><span class="s">stability_score</span><span class="sh">"</span><span class="p">],</span>
                <span class="sh">"</span><span class="s">employment_verified</span><span class="sh">"</span><span class="p">:</span> <span class="n">employer_data</span><span class="p">[</span><span class="sh">"</span><span class="s">verified</span><span class="sh">"</span><span class="p">],</span>
                <span class="sh">"</span><span class="s">employer</span><span class="sh">"</span><span class="p">:</span> <span class="n">employer_data</span><span class="p">[</span><span class="sh">"</span><span class="s">employer_name</span><span class="sh">"</span><span class="p">],</span>
                <span class="sh">"</span><span class="s">length_of_employment</span><span class="sh">"</span><span class="p">:</span> <span class="n">employer_data</span><span class="p">[</span><span class="sh">"</span><span class="s">years_employed</span><span class="sh">"</span><span class="p">]</span>
            <span class="p">}</span>

            <span class="c1"># Cache the result
</span>            <span class="k">await</span> <span class="n">self</span><span class="p">.</span><span class="n">redis</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span>
                <span class="n">cache_key</span><span class="p">,</span>
                <span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">result</span><span class="p">),</span>
                <span class="n">ex</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">cache_ttl</span>
            <span class="p">)</span>

            <span class="k">return</span> <span class="n">result</span>

        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Income verification failed: </span><span class="si">{</span><span class="nf">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">raise</span>

<span class="k">class</span> <span class="nc">FraudDetectionAgent</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">model_endpoint</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">model_endpoint</span> <span class="o">=</span> <span class="n">model_endpoint</span>
        <span class="n">self</span><span class="p">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">aiohttp</span><span class="p">.</span><span class="nc">ClientSession</span><span class="p">()</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">check_fraud</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">application</span><span class="p">:</span> <span class="n">LoanApplication</span><span class="p">,</span>
                         <span class="n">income_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Prepare features for fraud detection
</span>            <span class="n">features</span> <span class="o">=</span> <span class="p">{</span>
                <span class="sh">"</span><span class="s">customer_id</span><span class="sh">"</span><span class="p">:</span> <span class="n">application</span><span class="p">.</span><span class="n">customer_id</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">loan_amount</span><span class="sh">"</span><span class="p">:</span> <span class="n">application</span><span class="p">.</span><span class="n">loan_amount</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">income</span><span class="sh">"</span><span class="p">:</span> <span class="n">income_data</span><span class="p">[</span><span class="sh">"</span><span class="s">monthly_income</span><span class="sh">"</span><span class="p">],</span>
                <span class="sh">"</span><span class="s">purpose</span><span class="sh">"</span><span class="p">:</span> <span class="n">application</span><span class="p">.</span><span class="n">purpose</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">application_timestamp</span><span class="sh">"</span><span class="p">:</span> <span class="n">application</span><span class="p">.</span><span class="n">submitted_at</span><span class="p">.</span><span class="nf">isoformat</span><span class="p">()</span>
            <span class="p">}</span>

            <span class="c1"># Call fraud detection model
</span>            <span class="k">async</span> <span class="k">with</span> <span class="n">self</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span>
                <span class="n">self</span><span class="p">.</span><span class="n">model_endpoint</span><span class="p">,</span>
                <span class="n">json</span><span class="o">=</span><span class="n">features</span>
            <span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
                <span class="n">prediction</span> <span class="o">=</span> <span class="k">await</span> <span class="n">response</span><span class="p">.</span><span class="nf">json</span><span class="p">()</span>

            <span class="k">return</span> <span class="p">{</span>
                <span class="sh">"</span><span class="s">fraud_score</span><span class="sh">"</span><span class="p">:</span> <span class="n">prediction</span><span class="p">[</span><span class="sh">"</span><span class="s">fraud_probability</span><span class="sh">"</span><span class="p">],</span>
                <span class="sh">"</span><span class="s">risk_flags</span><span class="sh">"</span><span class="p">:</span> <span class="n">prediction</span><span class="p">[</span><span class="sh">"</span><span class="s">risk_flags</span><span class="sh">"</span><span class="p">],</span>
                <span class="sh">"</span><span class="s">velocity_check</span><span class="sh">"</span><span class="p">:</span> <span class="n">prediction</span><span class="p">[</span><span class="sh">"</span><span class="s">velocity_check_result</span><span class="sh">"</span><span class="p">]</span>
            <span class="p">}</span>

        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Fraud check failed: </span><span class="si">{</span><span class="nf">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">raise</span>

<span class="k">class</span> <span class="nc">CreditAssessmentOrchestrator</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span>
                 <span class="n">income_agent</span><span class="p">:</span> <span class="n">IncomeVerificationAgent</span><span class="p">,</span>
                 <span class="n">fraud_agent</span><span class="p">:</span> <span class="n">FraudDetectionAgent</span><span class="p">,</span>
                 <span class="n">redis_client</span><span class="p">:</span> <span class="n">aioredis</span><span class="p">.</span><span class="n">Redis</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">income_agent</span> <span class="o">=</span> <span class="n">income_agent</span>
        <span class="n">self</span><span class="p">.</span><span class="n">fraud_agent</span> <span class="o">=</span> <span class="n">fraud_agent</span>
        <span class="n">self</span><span class="p">.</span><span class="n">redis</span> <span class="o">=</span> <span class="n">redis_client</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">process_application</span><span class="p">(</span><span class="n">self</span><span class="p">,</span>
                                <span class="n">application</span><span class="p">:</span> <span class="n">LoanApplication</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CreditDecision</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Start timing for SLA tracking
</span>            <span class="n">start_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">()</span>

            <span class="c1"># Step 1: Verify Income
</span>            <span class="n">income_data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">self</span><span class="p">.</span><span class="n">income_agent</span><span class="p">.</span><span class="nf">verify_income</span><span class="p">(</span><span class="n">application</span><span class="p">)</span>

            <span class="c1"># Quick fail if income is insufficient
</span>            <span class="k">if</span> <span class="n">income_data</span><span class="p">[</span><span class="sh">"</span><span class="s">monthly_income</span><span class="sh">"</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.4</span> <span class="o">&lt;</span> \
               <span class="n">self</span><span class="p">.</span><span class="nf">_calculate_monthly_payment</span><span class="p">(</span><span class="n">application</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">CreditDecision</span><span class="p">.</span><span class="n">DECLINED</span>

            <span class="c1"># Step 2: Fraud Check
</span>            <span class="n">fraud_result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">self</span><span class="p">.</span><span class="n">fraud_agent</span><span class="p">.</span><span class="nf">check_fraud</span><span class="p">(</span>
                <span class="n">application</span><span class="p">,</span> <span class="n">income_data</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">fraud_result</span><span class="p">[</span><span class="sh">"</span><span class="s">fraud_score</span><span class="sh">"</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.7</span><span class="p">:</span>
                <span class="k">await</span> <span class="n">self</span><span class="p">.</span><span class="nf">_trigger_fraud_investigation</span><span class="p">(</span><span class="n">application</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">CreditDecision</span><span class="p">.</span><span class="n">DECLINED</span>

            <span class="c1"># Step 3: Credit Bureau Check
</span>            <span class="n">credit_result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">self</span><span class="p">.</span><span class="nf">_check_credit_bureau</span><span class="p">(</span>
                <span class="n">application</span><span class="p">.</span><span class="n">customer_id</span>
            <span class="p">)</span>

            <span class="c1"># Step 4: Calculate debt-to-income ratio
</span>            <span class="n">dti</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_calculate_dti</span><span class="p">(</span>
                <span class="n">income_data</span><span class="p">[</span><span class="sh">"</span><span class="s">monthly_income</span><span class="sh">"</span><span class="p">],</span>
                <span class="n">credit_result</span><span class="p">[</span><span class="sh">"</span><span class="s">monthly_obligations</span><span class="sh">"</span><span class="p">]</span>
            <span class="p">)</span>

            <span class="c1"># Final decision logic
</span>            <span class="n">decision</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_make_decision</span><span class="p">(</span>
                <span class="n">credit_score</span><span class="o">=</span><span class="n">credit_result</span><span class="p">[</span><span class="sh">"</span><span class="s">credit_score</span><span class="sh">"</span><span class="p">],</span>
                <span class="n">fraud_score</span><span class="o">=</span><span class="n">fraud_result</span><span class="p">[</span><span class="sh">"</span><span class="s">fraud_score</span><span class="sh">"</span><span class="p">],</span>
                <span class="n">dti</span><span class="o">=</span><span class="n">dti</span><span class="p">,</span>
                <span class="n">income_stability</span><span class="o">=</span><span class="n">income_data</span><span class="p">[</span><span class="sh">"</span><span class="s">income_stability</span><span class="sh">"</span><span class="p">]</span>
            <span class="p">)</span>

            <span class="c1"># Log decision for audit
</span>            <span class="k">await</span> <span class="n">self</span><span class="p">.</span><span class="nf">_log_decision</span><span class="p">(</span>
                <span class="n">application</span><span class="p">,</span> <span class="n">decision</span><span class="p">,</span> <span class="n">start_time</span><span class="p">,</span>
                <span class="n">income_data</span><span class="p">,</span> <span class="n">fraud_result</span><span class="p">,</span> <span class="n">credit_result</span>
            <span class="p">)</span>

            <span class="k">return</span> <span class="n">decision</span>

        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span>
                <span class="sa">f</span><span class="sh">"</span><span class="s">Application processing failed: </span><span class="si">{</span><span class="nf">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="sh">"</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">CreditDecision</span><span class="p">.</span><span class="n">ERROR</span>

    <span class="k">def</span> <span class="nf">_calculate_monthly_payment</span><span class="p">(</span><span class="n">self</span><span class="p">,</span>
                                 <span class="n">application</span><span class="p">:</span> <span class="n">LoanApplication</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="c1"># Implement actual payment calculation logic
</span>        <span class="n">rate</span> <span class="o">=</span> <span class="mf">0.05</span>  <span class="c1"># Example annual interest rate
</span>        <span class="n">monthly_rate</span> <span class="o">=</span> <span class="n">rate</span> <span class="o">/</span> <span class="mi">12</span>
        <span class="n">term</span> <span class="o">=</span> <span class="n">application</span><span class="p">.</span><span class="n">term_months</span>

        <span class="nf">return </span><span class="p">(</span><span class="n">application</span><span class="p">.</span><span class="n">loan_amount</span> <span class="o">*</span> <span class="n">monthly_rate</span> <span class="o">*</span>
                <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">monthly_rate</span><span class="p">)</span><span class="o">**</span><span class="n">term</span><span class="p">)</span> <span class="o">/</span> \
               <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">monthly_rate</span><span class="p">)</span><span class="o">**</span><span class="n">term</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_calculate_dti</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">monthly_income</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                      <span class="n">obligations</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">obligations</span> <span class="o">/</span> <span class="n">monthly_income</span>

    <span class="k">def</span> <span class="nf">_make_decision</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">credit_score</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                      <span class="n">fraud_score</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                      <span class="n">dti</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                      <span class="n">income_stability</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CreditDecision</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">credit_score</span> <span class="o">&gt;=</span> <span class="mi">700</span> <span class="ow">and</span> <span class="n">fraud_score</span> <span class="o">&lt;</span> <span class="mf">0.3</span> <span class="ow">and</span> \
           <span class="n">dti</span> <span class="o">&lt;</span> <span class="mf">0.43</span> <span class="ow">and</span> <span class="n">income_stability</span> <span class="o">&gt;</span> <span class="mf">0.8</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CreditDecision</span><span class="p">.</span><span class="n">APPROVED</span>
        <span class="k">elif</span> <span class="n">credit_score</span> <span class="o">&lt;</span> <span class="mi">580</span> <span class="ow">or</span> <span class="n">fraud_score</span> <span class="o">&gt;</span> <span class="mf">0.7</span> <span class="ow">or</span> <span class="n">dti</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CreditDecision</span><span class="p">.</span><span class="n">DECLINED</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CreditDecision</span><span class="p">.</span><span class="n">REFER</span>

</code></pre></div></div> <p>The heart of our system is the <code class="language-plaintext highlighter-rouge">CreditAssessmentOrchestrator</code>. Here’s how it processes applications:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">async</span> <span class="k">def</span> <span class="nf">process_application</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">application</span><span class="p">:</span> <span class="n">LoanApplication</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CreditDecision</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Start timing for SLA tracking
</span>        <span class="n">start_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">()</span>

        <span class="c1"># Step 1: Verify Income
</span>        <span class="n">income_data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">self</span><span class="p">.</span><span class="n">income_agent</span><span class="p">.</span><span class="nf">verify_income</span><span class="p">(</span><span class="n">application</span><span class="p">)</span>

        <span class="c1"># Quick fail if income is insufficient
</span>        <span class="k">if</span> <span class="n">income_data</span><span class="p">[</span><span class="sh">"</span><span class="s">monthly_income</span><span class="sh">"</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.4</span> <span class="o">&lt;</span> \
           <span class="n">self</span><span class="p">.</span><span class="nf">_calculate_monthly_payment</span><span class="p">(</span><span class="n">application</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">CreditDecision</span><span class="p">.</span><span class="n">DECLINED</span>
</code></pre></div></div> <p>This code demonstrates several key patterns:</p> <ul> <li>Async processing for improved throughput</li> <li>Early rejection for obvious failures</li> <li>SLA monitoring</li> <li>Structured error handling</li> </ul> <h3 id="state-management">State Management</h3> <p>State management is crucial in credit assessment. Our <code class="language-plaintext highlighter-rouge">IncomeVerificationAgent</code> shows how to handle this:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">async</span> <span class="k">def</span> <span class="nf">verify_income</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">application</span><span class="p">:</span> <span class="n">LoanApplication</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
    <span class="n">cache_key</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="s">income::</span><span class="si">{</span><span class="n">application</span><span class="p">.</span><span class="n">customer_id</span><span class="si">}</span><span class="sh">"</span>

    <span class="c1"># Check cache first
</span>    <span class="n">cached</span> <span class="o">=</span> <span class="k">await</span> <span class="n">self</span><span class="p">.</span><span class="n">redis</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">cache_key</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cached</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">json</span><span class="p">.</span><span class="nf">loads</span><span class="p">(</span><span class="n">cached</span><span class="p">)</span>
</code></pre></div></div> <p>This implementation:</p> <ul> <li>Uses Redis for distributed caching</li> <li>Implements TTL for regulatory compliance</li> <li>Maintains audit trails</li> <li>Handles race conditions</li> </ul> <h2 id="production-considerations">Production Considerations</h2> <h3 id="scaling-characteristics">Scaling Characteristics</h3> <p>Our production system handles varying load profiles:</p> <ul> <li>Normal operation: 100-200 applications/minute</li> <li>Peak periods (tax season): 500-600 applications/minute</li> <li>Batch processing: Up to 10,000 applications/hour</li> </ul> <p>Key scaling strategies:</p> <ol> <li>Horizontal scaling of stateless agents</li> <li>Redis cluster for state management</li> <li>Partitioned queues for better throughput</li> <li>Read replicas for reporting queries</li> </ol> <h3 id="performance-optimizations">Performance Optimizations</h3> <p>Real-world performance improvements implemented:</p> <ol> <li> <p>Smart Batching</p> <ul> <li>Group credit bureau checks by provider</li> <li>Batch document processing jobs</li> <li>Combine similar ML model inferences</li> </ul> </li> <li> <p>Caching Strategy</p> <ul> <li>Cache income verification results (1-hour TTL)</li> <li>Cache credit scores (24-hour TTL)</li> <li>No caching of fraud checks (real-time requirement)</li> </ul> </li> <li> <p>Resource Management</p> <ul> <li>Connection pooling for external APIs</li> <li>Managed thread pools for CPU-intensive tasks</li> <li>Rate limiting for external service calls</li> <li>Dynamic queue sizing based on load</li> </ul> </li> </ol> <h3 id="error-handling-in-production">Error Handling in Production</h3> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/blog/credit-system-failure-handling-480.webp 480w,/assets/img/blog/credit-system-failure-handling-800.webp 800w,/assets/img/blog/credit-system-failure-handling-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/blog/credit-system-failure-handling.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <p><br></p> <p>When dealing with financial transactions, error handling becomes critical. Our system implements several layers of protection:</p> <ol> <li>Circuit Breakers</li> </ol> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">CreditBureauService</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">failure_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">self</span><span class="p">.</span><span class="n">last_failure</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">self</span><span class="p">.</span><span class="n">circuit_open</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">check_credit</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">customer_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">circuit_open</span><span class="p">:</span>
            <span class="nf">if </span><span class="p">(</span><span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">self</span><span class="p">.</span><span class="n">last_failure</span><span class="p">).</span><span class="n">seconds</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="p">:</span>
                <span class="k">raise</span> <span class="nc">CircuitBreakerError</span><span class="p">(</span><span class="sh">"</span><span class="s">Credit bureau service unavailable</span><span class="sh">"</span><span class="p">)</span>
            <span class="n">self</span><span class="p">.</span><span class="n">circuit_open</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="k">await</span> <span class="n">self</span><span class="p">.</span><span class="nf">_make_bureau_call</span><span class="p">(</span><span class="n">customer_id</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">failure_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">self</span><span class="p">.</span><span class="n">last_failure</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">failure_count</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
                <span class="n">self</span><span class="p">.</span><span class="n">circuit_open</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">raise</span>
</code></pre></div></div> <ol> <li> <p>Retry Mechanisms</p> <ul> <li>Exponential backoff for transient failures</li> <li>Different strategies for different error types: <ul> <li>Retry immediately for timeouts</li> <li>Delay for rate limiting</li> <li>No retry for validation errors</li> </ul> </li> </ul> </li> <li> <p>Dead Letter Queues</p> <ul> <li>Failed applications are moved to analysis queues</li> <li>Automated recovery for known error patterns</li> <li>Manual review triggers for unknown failures</li> </ul> </li> </ol> <h2 id="compliance-and-audit-requirements">Compliance and Audit Requirements</h2> <p>Financial systems require stringent compliance measures. Our architecture addresses these through:</p> <h3 id="1-comprehensive-logging">1. Comprehensive Logging</h3> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">AuditLog</span><span class="p">:</span>
    <span class="n">timestamp</span><span class="p">:</span> <span class="n">datetime</span>
    <span class="n">application_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">action</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">agent_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">input_data</span><span class="p">:</span> <span class="n">Dict</span>
    <span class="n">output_data</span><span class="p">:</span> <span class="n">Dict</span>
    <span class="n">processing_time</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">error_details</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>

<span class="k">class</span> <span class="nc">AuditLogger</span><span class="p">:</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">log_action</span><span class="p">(</span><span class="n">self</span><span class="p">,</span>
                        <span class="n">application</span><span class="p">:</span> <span class="n">LoanApplication</span><span class="p">,</span>
                        <span class="n">action</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                        <span class="n">input_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
                        <span class="n">output_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
                        <span class="n">error</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">Exception</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="n">log_entry</span> <span class="o">=</span> <span class="nc">AuditLog</span><span class="p">(</span>
            <span class="n">timestamp</span><span class="o">=</span><span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">(),</span>
            <span class="n">application_id</span><span class="o">=</span><span class="n">application</span><span class="p">.</span><span class="n">application_id</span><span class="p">,</span>
            <span class="n">action</span><span class="o">=</span><span class="n">action</span><span class="p">,</span>
            <span class="n">agent_id</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">agent_id</span><span class="p">,</span>
            <span class="n">input_data</span><span class="o">=</span><span class="n">input_data</span><span class="p">,</span>
            <span class="n">output_data</span><span class="o">=</span><span class="n">output_data</span><span class="p">,</span>
            <span class="n">processing_time</span><span class="o">=</span><span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">self</span><span class="p">.</span><span class="n">start_time</span><span class="p">,</span>
            <span class="n">error_details</span><span class="o">=</span><span class="nf">str</span><span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="k">if</span> <span class="n">error</span> <span class="k">else</span> <span class="bp">None</span>
        <span class="p">)</span>
        <span class="k">await</span> <span class="n">self</span><span class="p">.</span><span class="nf">_persist_log</span><span class="p">(</span><span class="n">log_entry</span><span class="p">)</span>
</code></pre></div></div> <h3 id="2-data-retention">2. Data Retention</h3> <ul> <li>Configurable retention periods by data type</li> <li>Automated archival processes</li> <li>Secure data disposal workflows</li> </ul> <h3 id="3-access-controls">3. Access Controls</h3> <ul> <li>Role-based access for different agent types</li> <li>Audit trails for all data access</li> <li>Encryption for sensitive data fields</li> </ul> <h2 id="monitoring-and-observability">Monitoring and Observability</h2> <p>In production, visibility into system behavior is crucial. Our monitoring setup includes:</p> <ol> <li> <p>Business Metrics</p> <ul> <li>Application approval rates</li> <li>Average decision time</li> <li>Agent processing rates</li> <li>Queue depths</li> </ul> </li> <li> <p>Technical Metrics</p> <ul> <li>External API latencies</li> <li>Cache hit rates</li> <li>Database IOPS</li> <li>Memory utilization</li> </ul> </li> <li> <p>Alerting Rules</p> </li> </ol> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">MetricsCollector</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">metrics</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">track_decision_time</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">start_time</span><span class="p">:</span> <span class="n">datetime</span><span class="p">):</span>
        <span class="n">processing_time</span> <span class="o">=</span> <span class="p">(</span><span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">).</span><span class="nf">total_seconds</span><span class="p">()</span>
        <span class="k">await</span> <span class="n">self</span><span class="p">.</span><span class="nf">push_metric</span><span class="p">(</span><span class="sh">'</span><span class="s">decision_time</span><span class="sh">'</span><span class="p">,</span> <span class="n">processing_time</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">processing_time</span> <span class="o">&gt;</span> <span class="mi">30</span><span class="p">:</span>  <span class="c1"># SLA threshold
</span>            <span class="k">await</span> <span class="n">self</span><span class="p">.</span><span class="nf">alert_slow_processing</span><span class="p">(</span><span class="n">processing_time</span><span class="p">)</span>
</code></pre></div></div> <h2 id="performance-testing-and-benchmarking">Performance Testing and Benchmarking</h2> <p>Before deploying our multi-agent credit assessment system, we conducted extensive performance testing. Here’s what we learned:</p> <h3 id="load-testing-results">Load Testing Results</h3> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">PerformanceTester</span><span class="p">:</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">run_load_test</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">concurrent_users</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">duration_seconds</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
        <span class="n">test_results</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">async</span> <span class="k">def</span> <span class="nf">simulate_user</span><span class="p">():</span>
            <span class="k">while</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span> <span class="o">&lt;</span> <span class="n">duration_seconds</span><span class="p">:</span>
                <span class="n">application</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">generate_test_application</span><span class="p">()</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
                    <span class="n">decision</span> <span class="o">=</span> <span class="k">await</span> <span class="n">self</span><span class="p">.</span><span class="n">orchestrator</span><span class="p">.</span><span class="nf">process_application</span><span class="p">(</span><span class="n">application</span><span class="p">)</span>
                    <span class="n">elapsed</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>
                    <span class="n">test_results</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                        <span class="sh">'</span><span class="s">success</span><span class="sh">'</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                        <span class="sh">'</span><span class="s">latency</span><span class="sh">'</span><span class="p">:</span> <span class="n">elapsed</span><span class="p">,</span>
                        <span class="sh">'</span><span class="s">decision</span><span class="sh">'</span><span class="p">:</span> <span class="n">decision</span>
                    <span class="p">})</span>
                <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">test_results</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                        <span class="sh">'</span><span class="s">success</span><span class="sh">'</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                        <span class="sh">'</span><span class="s">error</span><span class="sh">'</span><span class="p">:</span> <span class="nf">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                    <span class="p">})</span>
                <span class="k">await</span> <span class="n">asyncio</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="n">random</span><span class="p">.</span><span class="nf">uniform</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>

        <span class="n">users</span> <span class="o">=</span> <span class="p">[</span><span class="nf">simulate_user</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">concurrent_users</span><span class="p">)]</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="p">.</span><span class="nf">gather</span><span class="p">(</span><span class="o">*</span><span class="n">users</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="nf">analyze_results</span><span class="p">(</span><span class="n">test_results</span><span class="p">)</span>
</code></pre></div></div> <p>Key findings from our load tests:</p> <ol> <li> <p>Throughput Characteristics</p> <ul> <li>Baseline: 100 requests/second with 95th percentile latency &lt; 500ms</li> <li>Max throughput: 350 requests/second before degradation</li> <li>Memory usage grows linearly until 250 requests/second</li> <li>Redis becomes bottleneck at 400 requests/second</li> </ul> </li> <li> <p>Latency Breakdown</p> <ul> <li>Credit bureau API: 35% of total latency</li> <li>Document processing: 25% of total latency</li> <li>Fraud detection: 20% of total latency</li> <li>Database operations: 15% of total latency</li> <li>Other operations: 5% of total latency</li> </ul> </li> </ol> <h3 id="bottleneck-analysis">Bottleneck Analysis</h3> <p>We identified several bottlenecks during testing:</p> <ol> <li>Document Processing Agent</li> </ol> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">DocumentProcessingOptimization</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">thread_pool</span> <span class="o">=</span> <span class="nc">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="nf">cpu_count</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">batch_size</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="n">self</span><span class="p">.</span><span class="n">processing_queue</span> <span class="o">=</span> <span class="n">asyncio</span><span class="p">.</span><span class="nc">Queue</span><span class="p">()</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">process_documents</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">documents</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
        <span class="c1"># Batch documents for efficient processing
</span>        <span class="n">batches</span> <span class="o">=</span> <span class="p">[</span><span class="n">documents</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="n">self</span><span class="p">.</span><span class="n">batch_size</span><span class="p">]</span>
                  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nf">len</span><span class="p">(</span><span class="n">documents</span><span class="p">),</span> <span class="n">self</span><span class="p">.</span><span class="n">batch_size</span><span class="p">)]</span>

        <span class="k">async</span> <span class="k">def</span> <span class="nf">process_batch</span><span class="p">(</span><span class="n">batch</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Use thread pool for CPU-intensive OCR
</span>                <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="p">.</span><span class="nf">get_event_loop</span><span class="p">().</span><span class="nf">run_in_executor</span><span class="p">(</span>
                    <span class="n">self</span><span class="p">.</span><span class="n">thread_pool</span><span class="p">,</span>
                    <span class="n">self</span><span class="p">.</span><span class="n">_process_batch</span><span class="p">,</span>
                    <span class="n">batch</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="n">results</span>
            <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logging</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Batch processing failed: </span><span class="si">{</span><span class="nf">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
                <span class="k">raise</span>

        <span class="c1"># Process batches concurrently
</span>        <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span><span class="nf">process_batch</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span> <span class="k">for</span> <span class="n">batch</span> <span class="ow">in</span> <span class="n">batches</span><span class="p">]</span>
        <span class="k">return</span> <span class="k">await</span> <span class="n">asyncio</span><span class="p">.</span><span class="nf">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">)</span>
</code></pre></div></div> <ol> <li>Credit Bureau Integration</li> </ol> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">CreditBureauOptimization</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">rate_limiter</span> <span class="o">=</span> <span class="nc">AsyncRateLimiter</span><span class="p">(</span>
            <span class="n">rate</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>  <span class="c1"># requests per second
</span>            <span class="n">burst</span><span class="o">=</span><span class="mi">20</span>   <span class="c1"># burst capacity
</span>        <span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">cache</span> <span class="o">=</span> <span class="nc">TTLCache</span><span class="p">(</span>
            <span class="n">maxsize</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>
            <span class="n">ttl</span><span class="o">=</span><span class="mi">86400</span>  <span class="c1"># 24 hours
</span>        <span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_credit_report</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">customer_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="c1"># Check cache first
</span>        <span class="n">cache_key</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="s">credit_report:</span><span class="si">{</span><span class="n">customer_id</span><span class="si">}</span><span class="sh">"</span>
        <span class="k">if</span> <span class="n">cache_key</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">cache</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">cache</span><span class="p">[</span><span class="n">cache_key</span><span class="p">]</span>

        <span class="k">async</span> <span class="k">with</span> <span class="n">self</span><span class="p">.</span><span class="n">rate_limiter</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">report</span> <span class="o">=</span> <span class="k">await</span> <span class="n">self</span><span class="p">.</span><span class="nf">_fetch_credit_report</span><span class="p">(</span><span class="n">customer_id</span><span class="p">)</span>
                <span class="n">self</span><span class="p">.</span><span class="n">cache</span><span class="p">[</span><span class="n">cache_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">report</span>
                <span class="k">return</span> <span class="n">report</span>
            <span class="k">except</span> <span class="n">RateLimitExceeded</span><span class="p">:</span>
                <span class="c1"># Implement fallback strategy
</span>                <span class="k">return</span> <span class="k">await</span> <span class="n">self</span><span class="p">.</span><span class="nf">_get_fallback_credit_data</span><span class="p">(</span><span class="n">customer_id</span><span class="p">)</span>
</code></pre></div></div> <h3 id="memory-profiling">Memory Profiling</h3> <p>We used memory profiling to optimize agent resource usage:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">MemoryOptimizedAgent</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">object_pool</span> <span class="o">=</span> <span class="nc">ObjectPool</span><span class="p">(</span>
            <span class="n">max_size</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
            <span class="n">cleanup_interval</span><span class="o">=</span><span class="mi">300</span>
        <span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">process_large_document</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">document</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">):</span>
        <span class="k">async</span> <span class="k">with</span> <span class="n">self</span><span class="p">.</span><span class="n">object_pool</span><span class="p">.</span><span class="nf">acquire</span><span class="p">()</span> <span class="k">as</span> <span class="n">processor</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Process document with pooled resources
</span>                <span class="k">return</span> <span class="k">await</span> <span class="n">processor</span><span class="p">.</span><span class="nf">process</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="c1"># Ensure cleanup of large objects
</span>                <span class="k">await</span> <span class="n">processor</span><span class="p">.</span><span class="nf">cleanup</span><span class="p">()</span>

<span class="nd">@memory_profile</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">profile_agent_memory</span><span class="p">():</span>
    <span class="n">agent</span> <span class="o">=</span> <span class="nc">MemoryOptimizedAgent</span><span class="p">()</span>
    <span class="n">large_docs</span> <span class="o">=</span> <span class="nf">generate_test_documents</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>

    <span class="c1"># Monitor memory usage during processing
</span>    <span class="n">memory_samples</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">large_docs</span><span class="p">:</span>
        <span class="n">mem_before</span> <span class="o">=</span> <span class="nf">get_memory_usage</span><span class="p">()</span>
        <span class="k">await</span> <span class="n">agent</span><span class="p">.</span><span class="nf">process_large_document</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
        <span class="n">mem_after</span> <span class="o">=</span> <span class="nf">get_memory_usage</span><span class="p">()</span>
        <span class="n">memory_samples</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">mem_after</span> <span class="o">-</span> <span class="n">mem_before</span><span class="p">)</span>

    <span class="k">return</span> <span class="nf">analyze_memory_pattern</span><span class="p">(</span><span class="n">memory_samples</span><span class="p">)</span>
</code></pre></div></div> <h3 id="database-optimization">Database Optimization</h3> <p>We optimized database access patterns:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">DatabaseOptimization</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">pool</span> <span class="o">=</span> <span class="nc">ConnectionPool</span><span class="p">(</span>
            <span class="n">min_size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
            <span class="n">max_size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
            <span class="n">cleanup_timeout</span><span class="o">=</span><span class="mi">60</span>
        <span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">bulk_insert_applications</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">applications</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Application</span><span class="p">]):</span>
        <span class="k">async</span> <span class="k">with</span> <span class="n">self</span><span class="p">.</span><span class="n">pool</span><span class="p">.</span><span class="nf">acquire</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">async</span> <span class="k">with</span> <span class="n">conn</span><span class="p">.</span><span class="nf">transaction</span><span class="p">():</span>
                <span class="c1"># Use COPY command for efficient bulk insert
</span>                <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">conn</span><span class="p">.</span><span class="nf">copy_records_to_table</span><span class="p">(</span>
                    <span class="sh">'</span><span class="s">applications</span><span class="sh">'</span><span class="p">,</span>
                    <span class="n">records</span><span class="o">=</span><span class="p">[</span><span class="n">app</span><span class="p">.</span><span class="nf">to_record</span><span class="p">()</span> <span class="k">for</span> <span class="n">app</span> <span class="ow">in</span> <span class="n">applications</span><span class="p">],</span>
                    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">id</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">customer_id</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">data</span><span class="sh">'</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="n">result</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_application_batch</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">async</span> <span class="k">with</span> <span class="n">self</span><span class="p">.</span><span class="n">pool</span><span class="p">.</span><span class="nf">acquire</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="c1"># Use cursor-based pagination
</span>            <span class="k">return</span> <span class="k">await</span> <span class="n">conn</span><span class="p">.</span><span class="nf">fetch</span><span class="p">(</span><span class="sh">"""</span><span class="s">
                SELECT * FROM applications
                WHERE status = </span><span class="sh">'</span><span class="s">pending</span><span class="sh">'</span><span class="s">
                ORDER BY submitted_at
                LIMIT $1
            </span><span class="sh">"""</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">)</span>
</code></pre></div></div> <h2 id="agent-communication-patterns">Agent Communication Patterns</h2> <p>Understanding how agents communicate effectively is crucial for system reliability. Let’s explore the key communication patterns we’ve implemented:</p> <h3 id="1-event-based-communication">1. Event-Based Communication</h3> <p>We use a message broker for asynchronous communication between agents:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span> <span class="n">enum</span> <span class="kn">import</span> <span class="n">Enum</span>
<span class="kn">from</span> <span class="n">typing</span> <span class="kn">import</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span>

<span class="k">class</span> <span class="nc">EventType</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">INCOME_VERIFIED</span> <span class="o">=</span> <span class="sh">"</span><span class="s">income_verified</span><span class="sh">"</span>
    <span class="n">FRAUD_DETECTED</span> <span class="o">=</span> <span class="sh">"</span><span class="s">fraud_detected</span><span class="sh">"</span>
    <span class="n">CREDIT_CHECKED</span> <span class="o">=</span> <span class="sh">"</span><span class="s">credit_checked</span><span class="sh">"</span>
    <span class="n">DOC_PROCESSED</span> <span class="o">=</span> <span class="sh">"</span><span class="s">doc_processed</span><span class="sh">"</span>
    <span class="n">APPLICATION_UPDATED</span> <span class="o">=</span> <span class="sh">"</span><span class="s">application_updated</span><span class="sh">"</span>

<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Event</span><span class="p">:</span>
    <span class="n">event_type</span><span class="p">:</span> <span class="n">EventType</span>
    <span class="n">payload</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
    <span class="n">application_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">correlation_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">timestamp</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">producer</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="sh">"</span><span class="s">1.0</span><span class="sh">"</span>
    <span class="n">retry_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">class</span> <span class="nc">EventPublisher</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">redis_client</span><span class="p">:</span> <span class="n">aioredis</span><span class="p">.</span><span class="n">Redis</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">redis</span> <span class="o">=</span> <span class="n">redis_client</span>
        <span class="n">self</span><span class="p">.</span><span class="n">event_validators</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">EventType</span><span class="p">.</span><span class="n">INCOME_VERIFIED</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">_validate_income_event</span><span class="p">,</span>
            <span class="n">EventType</span><span class="p">.</span><span class="n">FRAUD_DETECTED</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">_validate_fraud_event</span>
        <span class="p">}</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">publish</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">Event</span><span class="p">,</span> <span class="n">channel</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Version compatibility check
</span>            <span class="k">if</span> <span class="ow">not</span> <span class="k">await</span> <span class="n">self</span><span class="p">.</span><span class="nf">_check_version_compatibility</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
                <span class="k">raise</span> <span class="nc">VersionIncompatibleError</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Event version </span><span class="si">{</span><span class="n">event</span><span class="p">.</span><span class="n">version</span><span class="si">}</span><span class="s"> not supported</span><span class="sh">"</span><span class="p">)</span>

            <span class="c1"># Validate event structure
</span>            <span class="k">if</span> <span class="n">event</span><span class="p">.</span><span class="n">event_type</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">event_validators</span><span class="p">:</span>
                <span class="k">await</span> <span class="n">self</span><span class="p">.</span><span class="n">event_validators</span><span class="p">[</span><span class="n">event</span><span class="p">.</span><span class="n">event_type</span><span class="p">](</span><span class="n">event</span><span class="p">)</span>

            <span class="c1"># Publish event
</span>            <span class="k">await</span> <span class="n">self</span><span class="p">.</span><span class="n">redis</span><span class="p">.</span><span class="nf">publish</span><span class="p">(</span>
                <span class="n">channel</span><span class="p">,</span>
                <span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">dataclasses</span><span class="p">.</span><span class="nf">asdict</span><span class="p">(</span><span class="n">event</span><span class="p">))</span>
            <span class="p">)</span>

            <span class="c1"># Store event for audit
</span>            <span class="k">await</span> <span class="n">self</span><span class="p">.</span><span class="nf">_store_event</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">True</span>

        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Failed to publish event: </span><span class="si">{</span><span class="nf">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">_store_event</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">Event</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Store event in time-series database for audit</span><span class="sh">"""</span>
        <span class="n">event_key</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="s">event:</span><span class="si">{</span><span class="n">event</span><span class="p">.</span><span class="n">correlation_id</span><span class="si">}</span><span class="s">:</span><span class="si">{</span><span class="n">event</span><span class="p">.</span><span class="n">timestamp</span><span class="si">}</span><span class="sh">"</span>
        <span class="k">await</span> <span class="n">self</span><span class="p">.</span><span class="n">redis</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span>
            <span class="n">event_key</span><span class="p">,</span>
            <span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">dataclasses</span><span class="p">.</span><span class="nf">asdict</span><span class="p">(</span><span class="n">event</span><span class="p">)),</span>
            <span class="n">ex</span><span class="o">=</span><span class="mi">86400</span>  <span class="c1"># 24 hour retention
</span>        <span class="p">)</span>
</code></pre></div></div> <h3 id="2-request-response-pattern">2. Request-Response Pattern</h3> <p>For synchronous operations, we implement a request-response pattern with timeouts:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">AgentCommunicator</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">timeout</span>
        <span class="n">self</span><span class="p">.</span><span class="n">pending_requests</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">asyncio</span><span class="p">.</span><span class="n">Future</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">request</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">target_agent</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                     <span class="n">request_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                     <span class="n">payload</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="n">request_id</span> <span class="o">=</span> <span class="nf">str</span><span class="p">(</span><span class="n">uuid</span><span class="p">.</span><span class="nf">uuid4</span><span class="p">())</span>

        <span class="c1"># Create future for response
</span>        <span class="n">future</span> <span class="o">=</span> <span class="n">asyncio</span><span class="p">.</span><span class="nc">Future</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">pending_requests</span><span class="p">[</span><span class="n">request_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">future</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Send request
</span>            <span class="k">await</span> <span class="n">self</span><span class="p">.</span><span class="nf">_send_request</span><span class="p">(</span><span class="n">target_agent</span><span class="p">,</span> <span class="n">request_id</span><span class="p">,</span> <span class="n">request_type</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>

            <span class="c1"># Wait for response with timeout
</span>            <span class="k">return</span> <span class="k">await</span> <span class="n">asyncio</span><span class="p">.</span><span class="nf">wait_for</span><span class="p">(</span><span class="n">future</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">timeout</span><span class="p">)</span>

        <span class="k">except</span> <span class="n">asyncio</span><span class="p">.</span><span class="nb">TimeoutError</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">self</span><span class="p">.</span><span class="n">pending_requests</span><span class="p">[</span><span class="n">request_id</span><span class="p">]</span>
            <span class="k">raise</span> <span class="nc">RequestTimeoutError</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Request to </span><span class="si">{</span><span class="n">target_agent</span><span class="si">}</span><span class="s"> timed out</span><span class="sh">"</span><span class="p">)</span>

        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">self</span><span class="p">.</span><span class="n">pending_requests</span><span class="p">[</span><span class="n">request_id</span><span class="p">]</span>
            <span class="k">raise</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">handle_response</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">request_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">response</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
        <span class="k">if</span> <span class="n">request_id</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">pending_requests</span><span class="p">:</span>
            <span class="n">future</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">pending_requests</span><span class="p">.</span><span class="nf">pop</span><span class="p">(</span><span class="n">request_id</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">future</span><span class="p">.</span><span class="nf">done</span><span class="p">():</span>
                <span class="n">future</span><span class="p">.</span><span class="nf">set_result</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</code></pre></div></div> <h3 id="3-broadcast-patterns">3. Broadcast Patterns</h3> <p>For system-wide updates and status changes:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">SystemBroadcaster</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">redis_client</span><span class="p">:</span> <span class="n">aioredis</span><span class="p">.</span><span class="n">Redis</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">redis</span> <span class="o">=</span> <span class="n">redis_client</span>
        <span class="n">self</span><span class="p">.</span><span class="n">broadcast_channels</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">system_status</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">system:status</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">config_updates</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">system:config</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">agent_health</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">system:health</span><span class="sh">'</span>
        <span class="p">}</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">broadcast_status</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">status</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
        <span class="sh">"""</span><span class="s">Broadcast system status to all agents</span><span class="sh">"""</span>
        <span class="n">message</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">timestamp</span><span class="sh">'</span><span class="p">:</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">(),</span>
            <span class="sh">'</span><span class="s">status</span><span class="sh">'</span><span class="p">:</span> <span class="n">status</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">broadcast_id</span><span class="sh">'</span><span class="p">:</span> <span class="nf">str</span><span class="p">(</span><span class="n">uuid</span><span class="p">.</span><span class="nf">uuid4</span><span class="p">())</span>
        <span class="p">}</span>

        <span class="k">await</span> <span class="n">self</span><span class="p">.</span><span class="n">redis</span><span class="p">.</span><span class="nf">publish</span><span class="p">(</span>
            <span class="n">self</span><span class="p">.</span><span class="n">broadcast_channels</span><span class="p">[</span><span class="sh">'</span><span class="s">system_status</span><span class="sh">'</span><span class="p">],</span>
            <span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">broadcast_config_update</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
        <span class="sh">"""</span><span class="s">Broadcast configuration changes</span><span class="sh">"""</span>
        <span class="k">await</span> <span class="n">self</span><span class="p">.</span><span class="n">redis</span><span class="p">.</span><span class="nf">publish</span><span class="p">(</span>
            <span class="n">self</span><span class="p">.</span><span class="n">broadcast_channels</span><span class="p">[</span><span class="sh">'</span><span class="s">config_updates</span><span class="sh">'</span><span class="p">],</span>
            <span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">({</span>
                <span class="sh">'</span><span class="s">timestamp</span><span class="sh">'</span><span class="p">:</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">(),</span>
                <span class="sh">'</span><span class="s">config</span><span class="sh">'</span><span class="p">:</span> <span class="n">config</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">version</span><span class="sh">'</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="sh">'</span><span class="s">version</span><span class="sh">'</span><span class="p">]</span>
            <span class="p">})</span>
        <span class="p">)</span>
</code></pre></div></div> <h3 id="4-subscription-management">4. Subscription Management</h3> <p>Handling agent subscriptions and message filtering:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">MessageSubscriber</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">agent_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">agent_id</span> <span class="o">=</span> <span class="n">agent_id</span>
        <span class="n">self</span><span class="p">.</span><span class="n">subscriptions</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">self</span><span class="p">.</span><span class="n">filters</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Callable</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">subscribe</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">channel</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                       <span class="n">handler</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
                       <span class="n">filters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Callable</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Subscribe to a channel with optional message filters</span><span class="sh">"""</span>
        <span class="n">self</span><span class="p">.</span><span class="n">subscriptions</span><span class="p">[</span><span class="n">channel</span><span class="p">]</span> <span class="o">=</span> <span class="n">handler</span>
        <span class="k">if</span> <span class="n">filters</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">filters</span><span class="p">[</span><span class="n">channel</span><span class="p">]</span> <span class="o">=</span> <span class="n">filters</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">handle_message</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">channel</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
        <span class="k">if</span> <span class="n">channel</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">subscriptions</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Apply filters if any
</span>        <span class="k">if</span> <span class="n">channel</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">filters</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">filter_fn</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">filters</span><span class="p">[</span><span class="n">channel</span><span class="p">]:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nf">filter_fn</span><span class="p">(</span><span class="n">message</span><span class="p">):</span>
                    <span class="k">return</span>

        <span class="c1"># Handle message
</span>        <span class="k">await</span> <span class="n">self</span><span class="p">.</span><span class="n">subscriptions</span><span class="p">[</span><span class="n">channel</span><span class="p">](</span><span class="n">message</span><span class="p">)</span>
</code></pre></div></div> <h3 id="5-ordered-message-delivery">5. Ordered Message Delivery</h3> <p>Ensuring correct message ordering when needed:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">OrderedMessageHandler</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">message_queues</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">asyncio</span><span class="p">.</span><span class="n">Queue</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">self</span><span class="p">.</span><span class="n">sequence_numbers</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">handle_ordered_message</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">application_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                                   <span class="n">sequence_number</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                                   <span class="n">message</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
        <span class="sh">"""</span><span class="s">Handle messages in sequence order for a given application</span><span class="sh">"""</span>
        <span class="k">if</span> <span class="n">application_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">message_queues</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">message_queues</span><span class="p">[</span><span class="n">application_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">asyncio</span><span class="p">.</span><span class="nc">Queue</span><span class="p">()</span>
            <span class="n">self</span><span class="p">.</span><span class="n">sequence_numbers</span><span class="p">[</span><span class="n">application_id</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">current_seq</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">sequence_numbers</span><span class="p">[</span><span class="n">application_id</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">sequence_number</span> <span class="o">==</span> <span class="n">current_seq</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># Process message immediately
</span>            <span class="k">await</span> <span class="n">self</span><span class="p">.</span><span class="nf">_process_message</span><span class="p">(</span><span class="n">application_id</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
            <span class="n">self</span><span class="p">.</span><span class="n">sequence_numbers</span><span class="p">[</span><span class="n">application_id</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># Process any queued messages
</span>            <span class="k">while</span> <span class="ow">not</span> <span class="n">self</span><span class="p">.</span><span class="n">message_queues</span><span class="p">[</span><span class="n">application_id</span><span class="p">].</span><span class="nf">empty</span><span class="p">():</span>
                <span class="n">queued_seq</span><span class="p">,</span> <span class="n">queued_msg</span> <span class="o">=</span> \
                    <span class="k">await</span> <span class="n">self</span><span class="p">.</span><span class="n">message_queues</span><span class="p">[</span><span class="n">application_id</span><span class="p">].</span><span class="nf">get</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">queued_seq</span> <span class="o">==</span> <span class="n">self</span><span class="p">.</span><span class="n">sequence_numbers</span><span class="p">[</span><span class="n">application_id</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">await</span> <span class="n">self</span><span class="p">.</span><span class="nf">_process_message</span><span class="p">(</span><span class="n">application_id</span><span class="p">,</span> <span class="n">queued_msg</span><span class="p">)</span>
                    <span class="n">self</span><span class="p">.</span><span class="n">sequence_numbers</span><span class="p">[</span><span class="n">application_id</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Put it back if it's not the next in sequence
</span>                    <span class="k">await</span> <span class="n">self</span><span class="p">.</span><span class="n">message_queues</span><span class="p">[</span><span class="n">application_id</span><span class="p">].</span><span class="nf">put</span><span class="p">(</span>
                        <span class="p">(</span><span class="n">queued_seq</span><span class="p">,</span> <span class="n">queued_msg</span><span class="p">)</span>
                    <span class="p">)</span>
                    <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Queue out-of-order message
</span>            <span class="k">await</span> <span class="n">self</span><span class="p">.</span><span class="n">message_queues</span><span class="p">[</span><span class="n">application_id</span><span class="p">].</span><span class="nf">put</span><span class="p">(</span>
                <span class="p">(</span><span class="n">sequence_number</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
            <span class="p">)</span>
</code></pre></div></div> <h3 id="6-dead-letter-handling">6. Dead Letter Handling</h3> <p>Managing failed messages and retry logic:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">DeadLetterQueue</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">redis_client</span><span class="p">:</span> <span class="n">aioredis</span><span class="p">.</span><span class="n">Redis</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">redis</span> <span class="o">=</span> <span class="n">redis_client</span>
        <span class="n">self</span><span class="p">.</span><span class="n">max_retries</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="n">self</span><span class="p">.</span><span class="n">retry_delays</span> <span class="o">=</span> <span class="p">[</span><span class="mi">60</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">900</span><span class="p">]</span>  <span class="c1"># Progressive delays in seconds
</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">handle_failed_message</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
                                  <span class="n">error</span><span class="p">:</span> <span class="nb">Exception</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Handle failed message processing</span><span class="sh">"""</span>
        <span class="n">retry_count</span> <span class="o">=</span> <span class="n">message</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">retry_count</span><span class="sh">'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">retry_count</span> <span class="o">&gt;=</span> <span class="n">self</span><span class="p">.</span><span class="n">max_retries</span><span class="p">:</span>
            <span class="c1"># Move to dead letter queue for manual review
</span>            <span class="k">await</span> <span class="n">self</span><span class="p">.</span><span class="nf">_move_to_dlq</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Schedule retry
</span>        <span class="n">delay</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">retry_delays</span><span class="p">[</span><span class="n">retry_count</span><span class="p">]</span>
        <span class="k">await</span> <span class="n">self</span><span class="p">.</span><span class="nf">_schedule_retry</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">delay</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">_schedule_retry</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">delay</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Schedule message for retry after delay</span><span class="sh">"""</span>
        <span class="n">message</span><span class="p">[</span><span class="sh">'</span><span class="s">retry_count</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">message</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">retry_count</span><span class="sh">'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">message</span><span class="p">[</span><span class="sh">'</span><span class="s">last_error_time</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>

        <span class="n">retry_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span> <span class="o">+</span> <span class="n">delay</span>
        <span class="k">await</span> <span class="n">self</span><span class="p">.</span><span class="n">redis</span><span class="p">.</span><span class="nf">zadd</span><span class="p">(</span>
            <span class="sh">'</span><span class="s">message:retry_queue</span><span class="sh">'</span><span class="p">,</span>
            <span class="p">{</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">message</span><span class="p">):</span> <span class="n">retry_time</span><span class="p">}</span>
        <span class="p">)</span>
</code></pre></div></div> <p>These communication patterns form the backbone of our multi-agent system, ensuring reliable, ordered, and traceable message delivery between components. The implementation includes:</p> <ul> <li>Event validation and versioning</li> <li>Timeout handling and retries</li> <li>Message ordering guarantees</li> <li>Dead letter queuing</li> <li>Broadcast capabilities</li> <li>Subscription management</li> </ul> <p>Each pattern addresses specific needs in the credit assessment workflow while maintaining system reliability and traceability.</p> <ol> <li> <p>Agent Design Principles</p> <ul> <li>Start with coarse-grained agents and split as responsibilities become clearer</li> <li>Use feature flags to control agent behavior during testing</li> <li>Build comprehensive logging into each agent from the start</li> <li>Plan for version compatibility between agents</li> </ul> </li> <li> <p>Testing Challenges</p> <ul> <li>Simulating credit bureau responses requires extensive test data</li> <li>Fraud detection testing needs specialized synthetic data generation</li> <li>Integration testing requires careful orchestration of multiple external services</li> <li>Performance testing must account for variable API response times</li> </ul> </li> <li> <p>Development Workflow</p> <ul> <li>Use contract testing between agents</li> <li>Implement feature flags for gradual rollout capability</li> <li>Build comprehensive integration test suites</li> <li>Create detailed agent interaction documentation</li> </ul> </li> <li> <p>Early Performance Findings</p> <ul> <li>Document processing is more CPU-intensive than initially estimated</li> <li>Redis cache sizing needs careful consideration</li> <li>Credit bureau API quotas require sophisticated rate limiting</li> <li>Fraud check latency varies significantly by case complexity</li> </ul> </li> </ol> <h2 id="future-improvements">Future Improvements</h2> <p>Several enhancements are possible, some of them can be (perhaps, we will cover them in the next post):</p> <ol> <li> <p>Machine Learning Integration</p> <ul> <li>Real-time model retraining</li> <li>A/B testing framework</li> <li>Feature store integration</li> </ul> </li> <li> <p>Scalability</p> <ul> <li>Global deployment support</li> <li>Cross-region failover</li> <li>Enhanced load balancing</li> </ul> </li> <li> <p>Developer Experience</p> <ul> <li>Improved testing frameworks</li> <li>Better deployment automation</li> <li>Enhanced monitoring tools</li> </ul> </li> </ol> <h2 id="conclusion">Conclusion</h2> <p>Building a multi-agent system for credit assessment requires careful consideration of both technical and business requirements. The architecture presented here has proven robust in production, handling millions of credit applications while maintaining high availability and consistency.</p> <p>Remember that this implementation is specific to retail banking - your use case may require different trade-offs and design decisions. Focus on your specific requirements while borrowing the patterns that make sense for your context.</p> </div> </article> <div class="citation-section"> <div class="citation-header"> <h3>Citation</h3> <p class="citation-intro">If you found this article useful, please cite it using one of the formats below:</p> </div> <div class="citation-content"> <div class="citation-format"> <h4>APA Format</h4> <div class="citation-text"> <p> Mitra, Subhadip. (2024, December). <em>Engineering Multi-Agent Systems - A Retail Banking Case Study</em>. Retrieved from https://subhadipmitra.com/blog/2024/retail-bank-multi-agent-system/ </p> </div> </div> <div class="citation-format"> <h4>BibTeX Entry</h4> <div class="language-bibtex highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">@article</span><span class="p">{</span><span class="nl">mitra2024engineering-multi-agent-systems-a-retail-banking-case-study</span><span class="p">,</span>
  <span class="na">title</span>   <span class="p">=</span> <span class="s">{Engineering Multi-Agent Systems - A Retail Banking Case Study}</span><span class="p">,</span>
  <span class="na">author</span>  <span class="p">=</span> <span class="s">{Mitra, Subhadip}</span><span class="p">,</span>
  <span class="na">year</span>    <span class="p">=</span> <span class="s">{2024}</span><span class="p">,</span>
  <span class="na">month</span>   <span class="p">=</span> <span class="s">{Dec}</span><span class="p">,</span>
  <span class="na">url</span>     <span class="p">=</span> <span class="s">{https://subhadipmitra.com/blog/2024/retail-bank-multi-agent-system/}</span>
<span class="p">}</span>
</code></pre></div></div> </div> </div> </div> <style>.post-footer-featured{margin-top:6rem;padding-top:0}.newsletter-featured{background:var(--global-card-bg-color,#fff);border:2px solid var(--global-theme-color,#b509ac);border-radius:24px;padding:3rem;margin-bottom:3rem}.showcase-label-newsletter{display:inline-flex;align-items:center;gap:.5rem;font-size:.875rem;letter-spacing:.15em;text-transform:uppercase;color:var(--global-theme-color,#b509ac);font-weight:700;margin-bottom:1rem}.newsletter-featured h2{font-size:2rem;font-weight:900;margin:0 0 1rem 0;letter-spacing:-0.02em;line-height:1.1;color:var(--global-text-color,#000)}.newsletter-featured p{font-size:1.125rem;color:var(--global-text-color-light,#666);margin-bottom:1.5rem;line-height:1.6}.newsletter-form-featured{display:flex;gap:.75rem;margin-bottom:1rem}.newsletter-form-featured input{flex:1;padding:.875rem 1.25rem;background:var(--global-bg-color,#fff);color:var(--global-text-color,#000);border:1px solid var(--global-divider-color,#e5e5e5);border-radius:12px;font-size:1rem;transition:all .3s}.newsletter-form-featured input:focus{outline:0;border-color:var(--global-theme-color,#b509ac);box-shadow:0 0 0 3px rgba(181,9,172,0.1)}.newsletter-form-featured button{padding:.875rem 2rem;background:var(--global-theme-color,#b509ac);color:white;border:0;border-radius:12px;font-weight:700;font-size:1rem;cursor:pointer;transition:all .3s;white-space:nowrap}.newsletter-form-featured button:hover{transform:translateY(-4px);box-shadow:0 12px 40px rgba(181,9,172,0.3)}.newsletter-links{display:flex;gap:1rem;flex-wrap:wrap;align-items:center;font-size:.875rem;color:var(--global-text-color-light,#666)}.newsletter-links a{color:var(--global-theme-color,#b509ac);text-decoration:none;font-weight:600;transition:opacity .3s}.newsletter-links a:hover{opacity:.7}.share-section-featured{text-align:center;padding:2rem 0 3rem 0;border-bottom:1px solid var(--global-divider-color,#e5e5e5)}.share-section-featured .share-label{font-size:.875rem;text-transform:uppercase;letter-spacing:.1em;color:var(--global-text-color-light,#666);font-weight:600;margin-bottom:1.25rem}.share-buttons-featured{display:flex;gap:1rem;justify-content:center;align-items:center}.share-link-featured{display:inline-flex;align-items:center;gap:.5rem;font-weight:600;color:var(--global-text-color,#000);text-decoration:none;font-size:.875rem;padding:.5rem 1rem;background:var(--global-code-bg-color,#f8f9fa);border:1px solid var(--global-divider-color,#e5e5e5);border-radius:8px;transition:all .2s ease;white-space:nowrap;cursor:pointer}.share-link-featured:hover{background:var(--global-theme-color,#b509ac);border-color:var(--global-theme-color,#b509ac);color:white;transform:translateY(-2px)}.share-link-featured:hover svg{fill:white}.share-link-featured svg{width:16px;height:16px;flex-shrink:0;transition:fill .2s ease}.related-posts-section{margin-top:3rem;padding-top:0}.related-posts-section h3{font-size:1.75rem;font-weight:800;margin-bottom:2rem;color:var(--global-text-color,#000);text-align:center}@media(max-width:768px){.newsletter-featured{padding:2rem}.newsletter-featured h2{font-size:1.5rem}.newsletter-form-featured{flex-direction:column}.share-buttons-featured{flex-wrap:wrap;gap:.5rem}}</style> <div class="post-footer-featured"> <div class="newsletter-featured"> <div class="showcase-label-newsletter"> <svg width="16" height="16" viewbox="0 0 24 24" fill="currentColor"> <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path> </svg> Strategic Insights </div> <h2>Get More Like This</h2> <p> Join technical leaders from Google, Amazon, and Fortune 500s. Get strategic insights on Data, AI, and Cloud transformation delivered to your inbox. </p> <form class="newsletter-form-featured" action="https://app.loops.so/api/newsletter-form/cm614n2d604nlfy1lfo7vgmo5" method="POST"> <input type="email" name="email" placeholder="your@email.com" required> <button type="submit">Subscribe</button> </form> <div class="newsletter-links"> <span>Free insights • No spam • Unsubscribe anytime</span> <span>•</span> <a href="/archive/">Browse the archive →</a> </div> </div> <div class="share-section-featured"> <div class="share-label">Share This Article</div> <div class="share-buttons-featured"> <a href="https://twitter.com/intent/tweet?text=Engineering%20Multi-Agent%20Systems%20-%20A%20Retail%20Banking%20Case%20Study&amp;url=https://subhadipmitra.com/blog/2024/retail-bank-multi-agent-system/&amp;via=bassrehab" class="share-link-featured" target="_blank" rel="noopener noreferrer" title="Share on X"> <svg viewbox="0 0 24 24" fill="currentColor"> <path d="M13.6823 10.6218L20.2391 3H18.6854L12.9921 9.61788L8.44486 3H3.2002L10.0765 13.0074L3.2002 21H4.75404L10.7663 14.0113L15.5685 21H20.8131L13.6819 10.6218H13.6823ZM11.5541 13.0956L10.8574 12.0991L5.31391 4.16971H7.70053L12.1742 10.5689L12.8709 11.5655L18.6861 19.8835H16.2995L11.5541 13.096V13.0956Z"></path> </svg> <span>X</span> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://subhadipmitra.com/blog/2024/retail-bank-multi-agent-system/" class="share-link-featured" target="_blank" rel="noopener noreferrer" title="Share on LinkedIn"> <svg viewbox="0 0 24 24" fill="currentColor"> <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"></path> </svg> <span>LinkedIn</span> </a> <a href="https://www.reddit.com/submit?url=https://subhadipmitra.com/blog/2024/retail-bank-multi-agent-system/&amp;title=Engineering%20Multi-Agent%20Systems%20-%20A%20Retail%20Banking%20Case%20Study" class="share-link-featured" target="_blank" rel="noopener noreferrer" title="Share on Reddit"> <svg viewbox="0 0 24 24" fill="currentColor"> <path d="M12 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 0 1-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 0 1 .042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 0 1 4.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 0 1 .14-.197.35.35 0 0 1 .238-.042l2.906.617a1.214 1.214 0 0 1 1.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327 0 0 0-.231.094.33.33 0 0 0 0 .463c.842.842 2.484.913 2.961.913.477 0 2.105-.056 2.961-.913a.361.361 0 0 0 .029-.463.33.33 0 0 0-.464 0c-.547.533-1.684.73-2.512.73-.828 0-1.979-.196-2.512-.73a.326.326 0 0 0-.232-.095z"></path> </svg> <span>Reddit</span> </a> <a href="https://news.ycombinator.com/submitlink?u=https://subhadipmitra.com/blog/2024/retail-bank-multi-agent-system/&amp;t=Engineering%20Multi-Agent%20Systems%20-%20A%20Retail%20Banking%20Case%20Study" class="share-link-featured" target="_blank" rel="noopener noreferrer" title="Share on Hacker News"> <svg viewbox="0 0 24 24" fill="currentColor"> <path d="M0 0v24h24V0H0zm12.3 12.6l-3.6-7.2H10l2.4 5.1 2.4-5.1h1.3l-3.6 7.2v4.8h-1.2v-4.8z"></path> </svg> <span>HN</span> </a> <a href="mailto:?subject=Engineering%20Multi-Agent%20Systems%20-%20A%20Retail%20Banking%20Case%20Study&amp;body=Check%20out%20this%20article:%20https://subhadipmitra.com/blog/2024/retail-bank-multi-agent-system/" class="share-link-featured" title="Share via Email"> <svg viewbox="0 0 24 24" fill="currentColor"> <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"></path> </svg> <span>Email</span> </a> <button onclick="copyLinkFeatured('https://subhadipmitra.com/blog/2024/retail-bank-multi-agent-system/')" class="share-link-featured" title="Copy link to clipboard"> <svg class="copy-icon" viewbox="0 0 24 24" fill="currentColor"> <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path> </svg> <svg class="check-icon" style="display: none" viewbox="0 0 24 24" fill="currentColor"> <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"></path> </svg> <span class="copy-text">Copy</span> <span class="copied-text" style="display: none">Copied!</span> </button> </div> </div> <div class="related-posts-section"> <h3>Continue Reading</h3> </div> </div> <script>
  function copyLinkFeatured(url) {
    navigator.clipboard
      .writeText(url)
      .then(() => {
        const btn = event.target.closest("button");
        const copyText = btn.querySelector(".copy-text");
        const copiedText = btn.querySelector(".copied-text");
        const copyIcon = btn.querySelector(".copy-icon");
        const checkIcon = btn.querySelector(".check-icon");

        copyText.style.display = "none";
        copiedText.style.display = "inline";
        copyIcon.style.display = "none";
        checkIcon.style.display = "inline";

        setTimeout(() => {
          copyText.style.display = "inline";
          copiedText.style.display = "none";
          copyIcon.style.display = "inline";
          checkIcon.style.display = "none";
        }, 2000);
      })
      .catch((err) => {
        console.error("Failed to copy:", err);
        alert("Could not copy link. Please copy manually: " + url);
      });
  }

  // Newsletter form handler
  (function () {
    const form = document.querySelector(".newsletter-form-featured");
    if (!form) return;

    form.addEventListener("submit", function (event) {
      event.preventDefault();

      const emailInput = form.querySelector('input[name="email"]');
      const submitBtn = form.querySelector('button[type="submit"]');
      const email = emailInput.value;

      // Disable submit button and show loading state
      submitBtn.disabled = true;
      const originalText = submitBtn.textContent;
      submitBtn.textContent = "Subscribing...";

      // Submit to Loops.so
      const formBody = "userGroup=&email=" + encodeURIComponent(email);
      fetch(form.action, {
        method: "POST",
        body: formBody,
        headers: {
          "Content-Type": "application/x-www-form-urlencoded",
        },
      })
        .then((res) => res.json().then((data) => ({ ok: res.ok, data })))
        .then(({ ok, data }) => {
          if (ok) {
            // Success - show confirmation message
            submitBtn.textContent = "✓ Subscribed!";
            submitBtn.style.background = "#22c55e";
            emailInput.value = "";

            // Reset after 3 seconds
            setTimeout(() => {
              submitBtn.textContent = originalText;
              submitBtn.style.background = "";
              submitBtn.disabled = false;
            }, 3000);
          } else {
            // Error from API
            throw new Error(data.message || "Subscription failed");
          }
        })
        .catch((error) => {
          // Show error
          submitBtn.textContent = "✗ Failed";
          submitBtn.style.background = "#ef4444";
          console.error("Newsletter subscription error:", error);

          // Reset after 3 seconds
          setTimeout(() => {
            submitBtn.textContent = originalText;
            submitBtn.style.background = "";
            submitBtn.disabled = false;
          }, 3000);
        });
    });
  })();
</script> <style>.related-posts-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:1.5rem}.related-post-card{background:var(--global-card-bg-color,#fff);border:1px solid var(--global-divider-color,#e5e5e5);border-radius:16px;padding:2rem;transition:all .3s cubic-bezier(0.4,0,0.2,1);position:relative;display:flex;flex-direction:column}.related-post-card:hover{transform:translateY(-4px);box-shadow:0 12px 32px rgba(0,0,0,0.1);border-color:var(--global-theme-color,#b509ac)}.related-post-title{font-size:1.25rem;font-weight:700;line-height:1.3;margin:0 0 .75rem 0;color:var(--global-text-color,#000)}.related-post-title a{color:inherit;text-decoration:none;transition:color .3s}.related-post-title a:hover{color:var(--global-theme-color,#b509ac)}.related-post-meta{font-size:.875rem;color:var(--global-text-color-light,#666);margin-bottom:.75rem}.related-post-excerpt{font-size:.95rem;line-height:1.6;color:var(--global-text-color-light,#666);margin-bottom:1rem;flex-grow:1}.related-post-link{display:inline-flex;align-items:center;gap:.5rem;font-weight:700;color:var(--global-theme-color,#b509ac);text-decoration:none;font-size:.95rem;transition:gap .3s;margin-top:auto}.related-post-link:hover{gap:1rem}.related-post-link svg{width:16px;height:16px;transition:transform .3s}.related-post-link:hover svg{transform:translateX(4px)}.external-link-icon{width:14px;height:14px;opacity:.6;margin-left:.25rem}.no-related-posts{text-align:center;padding:3rem;color:var(--global-text-color-light,#666);font-style:italic}@media(max-width:768px){.related-posts-grid{grid-template-columns:1fr;gap:1rem}.related-post-card{padding:1.5rem}.related-post-title{font-size:1.125rem}}</style> <div class="related-posts-container"> <div class="related-posts-grid"> <article class="related-post-card"> <h4 class="related-post-title"> <a href="/blog/2025/detecting-ai-sandbagging/">I Trained Probes to Catch AI Models Sandbagging</a> </h4> <div class="related-post-meta"> December 20, 2025 • sandbagging </div> <p class="related-post-excerpt">First empirical demonstration of activation-level sandbagging detection. Linear probes achieve 90-96% accuracy across Mistral, Gemma, and Qwen models. Key finding - sandbagging representations are model-specific,...</p> <a href="/blog/2025/detecting-ai-sandbagging/" class="related-post-link"> Read More <svg viewbox="0 0 24 24" fill="currentColor"> <path d="M13.025 1l-2.847 2.828 6.176 6.176h-16.354v3.992h16.354l-6.176 6.176 2.847 2.828 10.975-11z"></path> </svg> </a> </article> <article class="related-post-card"> <h4 class="related-post-title"> <a href="/blog/2025/steering-vectors-agents/">Why Steering Vectors Beat Prompting (And When They Don't)</a> </h4> <div class="related-post-meta"> December 18, 2025 • machine-learning </div> <p class="related-post-excerpt">I tested activation steering on 4 agent behaviors across 3 models. The results surprised me.</p> <a href="/blog/2025/steering-vectors-agents/" class="related-post-link"> Read More <svg viewbox="0 0 24 24" fill="currentColor"> <path d="M13.025 1l-2.847 2.828 6.176 6.176h-16.354v3.992h16.354l-6.176 6.176 2.847 2.828 10.975-11z"></path> </svg> </a> </article> <article class="related-post-card"> <h4 class="related-post-title"> <a href="/blog/2025/building-spark-llm-eval/">Why I Built a Spark-Native LLM Evaluation Framework (And What I Learned)</a> </h4> <div class="related-post-meta"> December 15, 2025 • llm-evaluation </div> <p class="related-post-excerpt">A deep dive into building distributed LLM evaluation infrastructure that actually scales - architectural decisions, trade-offs, and lessons learned.</p> <a href="/blog/2025/building-spark-llm-eval/" class="related-post-link"> Read More <svg viewbox="0 0 24 24" fill="currentColor"> <path d="M13.025 1l-2.847 2.828 6.176 6.176h-16.354v3.992h16.354l-6.176 6.176 2.847 2.828 10.975-11z"></path> </svg> </a> </article> <article class="related-post-card"> <h4 class="related-post-title"> <a href="/blog/2025/mcp-maturity-model/">The MCP Maturity Model: Evaluating Your Multi-Agent Context Strategy</a> </h4> <div class="related-post-meta"> November 19, 2025 • MCP </div> <p class="related-post-excerpt">A practical framework for evaluating your multi-agent context management strategy. From ad-hoc string concatenation to self-evolving context systems - where does your architecture stand?</p> <a href="/blog/2025/mcp-maturity-model/" class="related-post-link"> Read More <svg viewbox="0 0 24 24" fill="currentColor"> <path d="M13.025 1l-2.847 2.828 6.176 6.176h-16.354v3.992h16.354l-6.176 6.176 2.847 2.828 10.975-11z"></path> </svg> </a> </article> </div> </div> <br> <br> <div class="hyvor-talk-container"> <style>.hyvor-talk-container{margin-top:4rem;padding-top:3rem;border-top:2px solid var(--global-divider-color,#e5e5e5)}.hyvor-talk-header{margin-bottom:2rem;text-align:center}.hyvor-talk-header h3{font-size:1.75rem;font-weight:800;margin-bottom:.5rem;color:var(--global-text-color,#000)}.hyvor-talk-header p{font-size:1rem;color:var(--global-text-color-light,#666);margin:0}</style> <div class="hyvor-talk-header"> <h3>Join the Discussion</h3> <p>Share your thoughts, ask questions, or provide feedback on this article</p> </div> <div id="hyvor-talk-view"></div> <script type="application/javascript">
    var HYVOR_TALK_WEBSITE = 14339;
    var HYVOR_TALK_CONFIG = {
      url: 'https://subhadipmitra.com/blog/2024/retail-bank-multi-agent-system/',
      id: '/blog/2024/retail-bank-multi-agent-system/',
      
      title: 'Engineering Multi-Agent Systems - A Retail Banking Case Study',
      
      
      palette: {
        accent: '#b509ac',
        accentText: '#ffffff',
        footerHeader: 'var(--global-text-color)',
        footerHeaderText: 'var(--global-text-color-light)',
        box: 'var(--global-card-bg-color)',
        boxText: 'var(--global-text-color)',
        boxLightText: 'var(--global-text-color-light)',
        backgroundText: 'var(--global-text-color)'
      }
      
    };
  </script> <script async type="application/javascript" src="//talk.hyvor.com/web-api/embed.js"></script> </div> </div> </div> </div> </div> <footer class="modern-footer" role="contentinfo"> <div class="footer-container"> <div class="footer-grid"> <div class="footer-brand"> <h3>Subhadip Mitra</h3> <p> Technical Leader, Inventor, and Researcher building the future of Data &amp; Applied AI. <br>Leading Google Cloud's D&amp;A practice across Southeast Asia. </p> <br> <p><a href="mailto:contact@subhadipmitra.com">contact@subhadipmitra.com</a></p> </div> <div class="footer-section"> <h4>Explore</h4> <ul class="footer-links"> <li><a href="/">About</a></li> <li><a href="/now/">What I'm Doing Now</a></li> <li><a href="/blog/">Blog</a></li> <li><a href="/publications/">Publications</a></li> <li><a href="/repositories/">Repositories</a></li> </ul> </div> <div class="footer-section"> <h4>Connect</h4> <ul class="footer-links"> <li><a href="/contact/">Contact</a></li> <li><a href="mailto:contact@subhadipmitra.com">Email</a></li> <li><a href="https://calendly.com/contact-x9nm/30min" target="_blank" rel="external nofollow noopener">Schedule a Call</a></li> <li><a href="https://linkedin.com/in/subhadip-mitra" target="_blank" rel="external nofollow noopener">LinkedIn</a></li> <li><a href="https://github.com/bassrehab" target="_blank" rel="external nofollow noopener">GitHub</a></li> </ul> </div> </div> <div class="footer-bottom"> <div class="footer-copyright"> © 2025 Subhadip Mitra. Some Rights Reserved. Last updated: December 28, 2025. <span class="footer-utility-links"> <a href="/privacy/" title="Privacy Policy">Privacy</a> · <a href="/license/" title="Licenses">Licenses</a> · <a href="/sitemap.xml" title="Sitemap">Sitemap</a> · <a href="/feed.xml" title="RSS Feed">RSS</a> · <a href="/llms.txt" title="AI Agent Information">LLMs</a> </span> </div> <div class="footer-social"> <a href="https://linkedin.com/in/subhadip-mitra" target="_blank" aria-label="LinkedIn" rel="external nofollow noopener"> <i class="fab fa-linkedin-in"></i> </a> <a href="https://github.com/bassrehab" target="_blank" aria-label="GitHub" rel="external nofollow noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/bassrehab" target="_blank" aria-label="Twitter" rel="external nofollow noopener"> <i class="fab fa-twitter"></i> </a> <a href="mailto:contact@subhadipmitra.com" aria-label="Email"> <i class="fas fa-envelope"></i> </a> </div> </div> </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js?a0db7e5d5c70cc3252b3138b0c91dcaf" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script defer src="/assets/js/bootstrap-toc.min.js?c82ff4de8b0955d6ff14f5b05eed7eb6"></script> <script defer src="/assets/js/toc-toggle.js?9c8277d11f423c45ff70df63cbe75108"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?8e03581f97e30ec91fff7c9869d3c6cb"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?a5bb4e6a542c546dd929b24b8b236dfd"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-TW7YQ5XPC6"></script> <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
      dataLayer.push(arguments);
    }
    gtag('js', new Date());

    gtag('config', 'G-TW7YQ5XPC6');
  </script> <script defer src="/assets/js/google-analytics-setup.js?12374742c4b1801ba82226e617af7e2d"></script> <script defer src="/assets/js/progress-bar.js?2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> <script type="module" src="/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script src="/assets/js/search-setup.js?6c304f7b1992d4b60f7a07956e52f04a"></script> <script src="/assets/js/search-data.js"></script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> <script defer src="/assets/js/newsletter.js?c3d0931971ee96e9df74ba70526c3130"></script> </body> </html>